jQuery(document).ready(function(a){if(BP_SEARCH.cache=[],"yes"==BP_SEARCH.enable_ajax_search){var b=a(document).height();a("form[role='search'], form.search-form, form.searchform, form#adminbarsearch").each(function(){var c=a(this);if($search_field=c.find("input[name='s']"),$search_field.length>0){currentType="";var d={},e=$search_field.offset(),f=e.top+$search_field.outerHeight(),g=b-f;g<400&&e.top>g&&(d={collision:"flip flip"}),a($search_field).autocomplete({source:function(b,c){var d=b.term;if(d in BP_SEARCH.cache)return void c(BP_SEARCH.cache[d]);var e={action:BP_SEARCH.action,nonce:BP_SEARCH.nonce,search_term:b.term,per_page:BP_SEARCH.per_page};c({value:'<div class="loading-msg"><span class="bb_global_search_spinner"></span>'+BP_SEARCH.loading_msg+"</div>"}),searchXHR=a.ajax({url:BP_SEARCH.ajaxurl,dataType:"json",data:e,success:function(a){BP_SEARCH.cache[d]=a,c(a)}})},minLength:2,delay:500,select:function(b,c){return window.location=a(c.item.value).find("a").attr("href"),!1},focus:function(b,c){return a(".ui-autocomplete li").removeClass("ui-state-hover"),a(".ui-autocomplete").find("li:has(a.ui-state-focus)").addClass("ui-state-hover"),!1},open:function(){a(".bb-global-search-ac").outerWidth(a(this).outerWidth())},position:d}).data("ui-autocomplete")._renderItem=function(b,c){return b.addClass("bb-global-search-ac"),""!=c.type_label?(a(b).data("current_cat",c.type),a("<li>").attr("class","bbls-"+c.type+"-type bbls-category").append("<span>"+c.value+"</span>").appendTo(b)):a("<li>").attr("class","bbls-"+c.type+"-type bbls-sub-item").append("<a class='x'>"+c.value+"</a>").appendTo(b)}}}),a("#bbp-search-form, #bbp-search-index-form").each(function(){var c=a(this);if($search_field=c.find("#bbp_search"),$search_field.length>0){currentType="";var d={},e=$search_field.offset(),f=e.top+$search_field.outerHeight(),g=b-f;g<400&&e.top>g&&(d={collision:"flip flip"}),a($search_field).autocomplete({source:function(b,c){var d=b.term;if(d in BP_SEARCH.cache)return void c(BP_SEARCH.cache[d]);var e={action:BP_SEARCH.action,nonce:BP_SEARCH.nonce,search_term:b.term,forum_search_term:!0,per_page:15};c({value:'<div class="loading-msg"><span class="bb_global_search_spinner"></span>'+BP_SEARCH.loading_msg+"</div>"}),a.ajax({url:BP_SEARCH.ajaxurl,dataType:"json",data:e,success:function(a){BP_SEARCH.cache[d]=a,c(a)}})},minLength:2,select:function(b,c){return window.location=a(c.item.value).find("a").attr("href"),!1},focus:function(b,c){return a(".ui-autocomplete li").removeClass("ui-state-hover"),a(".ui-autocomplete").find("li:has(a.ui-state-focus)").addClass("ui-state-hover"),!1},open:function(){a(".bb-global-search-ac").outerWidth(a(this).outerWidth())},position:d}).data("ui-autocomplete")._renderItem=function(b,c){return b.addClass("bb-global-search-ac"),""!=c.type_label?(a(b).data("current_cat",c.type),a("<li>").attr("class","bbls-"+c.type+"-type bbls-category").append("<span>"+c.value+"</span>").appendTo(b)):a("<li>").attr("class","bbls-"+c.type+"-type bbls-sub-item").append("<a class='x'>"+c.value+"</a>").appendTo(b)}}})}a(document).on("click",".bboss_search_results_wrapper .item-list-tabs li a",function(b){return b.preventDefault(),_this=this,a(this).addClass("loading"),get_page=a.post(BP_SEARCH.ajaxurl,{action:BP_SEARCH.action,nonce:BP_SEARCH.nonce,subset:a(this).parent().data("item"),s:BP_SEARCH.search_term,view:"content"}),get_page.done(function(b){a(_this).removeClass("loading"),""!=b&&(present=a(".bboss_search_page"),present.after(b),present.remove())}),get_page.fail(function(){a(_this).removeClass("loading")}),!1}),a(document).on("click",".bboss_search_results_wrapper .pagination-links a",function(b){b.preventDefault(),_this=this,a(this).addClass("loading");var c={action:BP_SEARCH.action,nonce:BP_SEARCH.nonce,subset:a(this).parent().data("item"),s:BP_SEARCH.search_term,view:"content",list:a(this).data("pagenumber")},d=a(".bboss_search_results_wrapper .item-list-tabs li.active").data("item");return c.subset=d,get_page=a.post(BP_SEARCH.ajaxurl,c),get_page.done(function(b){a(_this).removeClass("loading"),""!=b&&(present=a(".bboss_search_page"),present.after(b),present.remove())}),get_page.fail(function(){a(_this).removeClass("loading")}),!1}),a("body.bp-nouveau").on("click",".bboss_search_page button.friendship-button, .bboss_search_page button.group-button",function(a){window.location=this.getAttribute("data-bp-nonce")})});
