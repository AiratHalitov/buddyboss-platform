window.wp=window.wp||{},window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(_.extend(bp,_.pick(wp,"Backbone","ajax","template")),bp.Models=bp.Models||{},bp.Collections=bp.Collections||{},bp.Views=bp.Views||{},bp.Nouveau=bp.Nouveau||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.GroupInvites={start:function(){this.views=new Backbone.Collection;var e=t("body").find("#group-invites-send-to-input"),a=1;this.addSelect2(e);t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback");var i=t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback"),s=t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback p"),n=(t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback"),t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback")),o=t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback p"),r=t(".group-invites-members-listing #members-list"),u=t(".group-invites-members-listing .last");n.attr("class","bp-feedback"),n.addClass("loading"),o.html(BP_Nouveau.group_invites.loading),i.attr("class","bp-feedback"),i.addClass("help"),s.html(""),s.html(BP_Nouveau.group_invites.invites_form),t("#item-body #group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field").prop("disabled",!0),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field",function(){t(this).prop("disabled",!0)}),e.on("select2:unselect",function(e){var a=e.params.data;t('#group-invites-send-to-input option[value="'+a.id+'"]').each(function(){t(this).remove()}),t("#item-body #group-invites-container .bb-groups-invites-left #members-list li."+a.id).removeClass("selected"),t("#item-body #group-invites-container .bb-groups-invites-left #members-list li."+a.id+" .action button").attr("data-bp-tooltip",BP_Nouveau.group_invites.add_recipient)});var c={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"members"};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:c,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),a=e.data.page,n.attr("class","bp-feedback"),n.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),n.attr("class","bp-feedback"),n.addClass(e.data.type),o.html(e.data.feedback))}}),t(".group-invites-select-members-dropdown").on("change",function(){n.attr("class","bp-feedback"),n.addClass("loading"),o.html(BP_Nouveau.group_invites.loading);var e=this.value;if(e){var i={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:e};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:i,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),a=e.data.page,n.attr("class","bp-feedback"),n.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),n.attr("class","bp-feedback"),n.addClass(e.data.type),o.html(e.data.feedback))}})}}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left #members-list li .action .group-add-remove-invite-button",function(){var a=t(this).attr("data-bp-user-id"),i=t(this).attr("data-bp-user-name"),s={id:a,text:i};if(t(this).closest("li").hasClass("selected")){t(this).closest("li").removeClass("selected");var n=[];t.grep(e.select2("data"),function(e){return e.id!=a}).forEach(function(e){n.push(+e.id)}),e.val(n).trigger("change"),t('#group-invites-send-to-input option[value="'+a+'"]').each(function(){t(this).remove()}),t(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.add_recipient)}else{if(t(this).closest("li").addClass("selected"),!e.find("option[value='"+s.id+"']").length){var o=new Option(s.text,s.id,!0,!0);e.append(o).trigger("change")}t(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.remove_recipient)}}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left .last #bp-group-invites-next-page",function(){n.attr("class","bp-feedback"),n.addClass("loading"),o.html(BP_Nouveau.group_invites.loading);var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:a,search_terms:t("#item-body #group-invites-container .bb-groups-invites-left #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),a=e.data.page,n.attr("class","bp-feedback"),n.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),n.attr("class","bp-feedback"),n.addClass(e.data.type),o.html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left .last #bp-group-invites-prev-page",function(){t("#item-body #group-invites-container .bb-groups-invites-left .bp-invites-feedback").show(),t("#item-body #group-invites-container .bb-groups-invites-left .bp-invites-feedback .bp-feedback").addClass("info"),o.html(BP_Nouveau.group_invites.loading),a-=2;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:a,search_terms:t("#item-body #group-invites-container .bb-groups-invites-left #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),a=e.data.page,n.attr("class","bp-feedback"),n.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),n.attr("class","bp-feedback"),n.addClass(e.data.type),o.html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left #group_invites_search",function(){var e=t("#item-body #group-invites-container .bb-groups-invites-left #group_invites_search").val();if(""===e)return!1;var i={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:1,search_terms:e};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),a=e.data.page,n.attr("class","bp-feedback"),n.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),n.attr("class","bp-feedback"),n.addClass(e.data.type),o.html(""),o.html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left .group-invites-members-listing #members-list li .item .action .group-remove-invite-button",function(a){a.preventDefault(),console.log("removed");var n={action:"groups_delete_group_invite",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.send_invites,group_id:BP_Nouveau.group_invites.group_id,user:users_list};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(a){a.success?(i.attr("class","bp-feedback"),i.addClass(a.data.type),s.html(""),s.html(a.data.feedback),e.find("option").remove(),t("textarea#send-invites-control").val("")):(i.attr("class","bp-feedback"),i.addClass(a.data.type),s.html(""),s.html(a.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-bottom #send_group_invite_button",function(a){a.preventDefault();var n=[];t.grep(e.select2("data"),function(e){return 0!=e.id}).forEach(function(e){n.push(+e.id)});var o={action:"groups_send_group_invites",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.send_invites,group_id:BP_Nouveau.group_invites.group_id,message:t("textarea#send-invites-control").val(),users:n};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(a){a.success?(i.attr("class","bp-feedback"),i.addClass(a.data.type),s.html(""),s.html(a.data.feedback),e.find("option").remove(),t("textarea#send-invites-control").val("")):(i.attr("class","bp-feedback"),i.addClass(a.data.type),s.html(""),s.html(a.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-bottom #bp_invites_reset",function(i){i.preventDefault(),e.find("option").remove(),t("textarea#send-invites-control").val("");var s={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"members",page:1};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:s,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),a=e.data.page,n.attr("class","bp-feedback"),n.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),n.attr("class","bp-feedback"),n.addClass(e.data.type),o.html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left #group_invites_search_submit",function(e){e.preventDefault();var i=t("#item-body #group-invites-container .bb-groups-invites-left #group_invites_search").val();if(""===i)return!1;var s={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:1,search_terms:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),a=e.data.page,n.attr("class","bp-feedback"),n.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),n.attr("class","bp-feedback"),n.addClass(e.data.type),o.html(e.data.feedback))}})})},addSelect2:function(e){var a=[];e.select2({placeholder:"",minimumInputLength:1,ajax:{url:bp.ajax.settings.url,dataType:"json",delay:250,data:function(e){return t.extend({},e,{nonce:BP_Nouveau.group_invites.nonces.retrieve_group_members,action:"groups_get_group_potential_user_send_invites",group:BP_Nouveau.group_invites.group_id})},cache:!0,processResults:function(e){return!1===jQuery.isEmptyObject(a)&&t.each(a,function(t,a){for(var i=0;i<e.data.results.length;i++)e.data.results[i].id===a&&e.data.results.splice(i,1)}),{results:e&&e.success?e.data.results:[]}}}}),e.on("select2:select",function(e){var t=e.params.data;a.push(t.id)}),e.on("select2:unselect",function(e){var t=e.params.data;a=jQuery.grep(a,function(e){return e!==t.id})})}},bp.Nouveau.GroupInvites.start())}(bp,jQuery);