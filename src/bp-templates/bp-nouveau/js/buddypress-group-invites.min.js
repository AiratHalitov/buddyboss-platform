window.wp=window.wp||{},window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(_.extend(bp,_.pick(wp,"Backbone","ajax","template")),bp.Models=bp.Models||{},bp.Collections=bp.Collections||{},bp.Views=bp.Views||{},bp.Nouveau=bp.Nouveau||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.GroupInvites={start:function(){this.views=new Backbone.Collection;var e=t("body").find("#group-invites-send-to-input"),a=1;this.addSelect2(e);var i=t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback"),s=t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback p"),n=t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback");n.hide();var o=t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback"),r=t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p"),u=t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback"),p=t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback p"),c=t(".group-invites-members-listing #members-list"),l=t(".group-invites-members-listing .last"),d=t(".members.bp-invites-content #members-list"),v=t("#group-invites-container .group-invites-column .subnav-filters div .last");u.attr("class","bp-feedback"),u.addClass("loading"),p.html(BP_Nouveau.group_invites.loading),i.attr("class","bp-feedback"),i.addClass("help"),s.html(""),s.html(BP_Nouveau.group_invites.invites_form),t("#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field").prop("disabled",!0),t(document).on("click","#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field",function(){t(this).prop("disabled",!0)}),e.on("select2:unselect",function(e){var a=e.params.data;t('#group-invites-send-to-input option[value="'+a.id+'"]').each(function(){t(this).remove()}),t("#group-invites-container .bb-groups-invites-left #members-list li."+a.id).removeClass("selected"),t("#group-invites-container .bb-groups-invites-left #members-list li."+a.id+" .action button").attr("data-bp-tooltip",BP_Nouveau.group_invites.add_recipient)});var g=t(".groups.group-invites.pending-invites");if(g.length){var b=0;t(window).scroll(function(){var e=t(".groups.group-invites.pending-invites #group-invites-container .group-invites-column .bp-invites-content #members-list li.load-more");if(e.length){var a=t(window).scrollTop(),i=a+t(window).height(),s=t(e).offset().top;(s+t(e).height()<=i&&s>=a||t(window).scrollTop()+t(window).height()>=t(document).height())&&0==b&&(t("#group-invites-container .last #bp-group-invites-next-page").trigger("click"),b=1)}})}if(g.length){t(".groups.group-invites.pending-invites .subnav #pending-invites-groups-li").addClass("current selected");var _={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:_,success:function(e){e.success?(d.html(""),d.html(e.data.html),v.html(""),v.html(e.data.pagination),o.attr("class","bp-feedback"),o.addClass("info"),r.html(e.data.feedback),a+=1):(d.html(""),o.attr("class","bp-feedback"),o.addClass(e.data.type),r.html(e.data.feedback))}}),t(document).on("click","#group-invites-container .last #bp-group-invites-next-page",function(){u.attr("class","bp-feedback"),u.addClass("loading"),p.html(BP_Nouveau.group_invites.loading),a+=1;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a,search_terms:t("#group-invites-container .group-invites-column #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){b=0,e.success?(d.html(""),d.html(e.data.html),v.html(""),v.html(e.data.pagination),o.attr("class","bp-feedback"),o.addClass("info"),r.html(e.data.feedback)):(d.html(""),o.attr("class","bp-feedback"),o.addClass(e.data.type),r.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container .last #bp-group-invites-prev-page",function(){t("#group-invites-container .bp-invites-feedback").show(),t("#group-invites-container .bp-invites-feedback .bp-feedback").addClass("info"),r.html(BP_Nouveau.group_invites.loading),a-=1;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a,search_terms:t("#group-invites-container .group-invites-column #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(d.html(""),d.html(e.data.html),v.html(""),v.html(e.data.pagination),o.attr("class","bp-feedback"),o.addClass("info"),r.html(e.data.feedback)):(d.html(""),o.attr("class","bp-feedback"),o.addClass(e.data.type),r.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container #group_invites_search_submit",function(e){e.preventDefault();var i=t("#group-invites-container #group_invites_search").val();if(""===i)return!1;a=1;var s={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a,search_terms:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){e.success?(d.html(""),d.html(e.data.html),v.html(""),v.html(e.data.pagination),o.attr("class","bp-feedback"),o.addClass("info"),r.html(e.data.feedback)):(d.html(""),o.attr("class","bp-feedback"),o.addClass(e.data.type),r.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container #members-list li .item .action .group-remove-invite-button",function(e){e.preventDefault(),o.attr("class","bp-feedback"),o.addClass("loading"),r.html(""),r.html(BP_Nouveau.group_invites.removing);var i=t(this).closest("li"),s={action:"groups_delete_group_invite",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.uninvite,group_id:BP_Nouveau.group_invites.group_id,user:t(this).attr("data-bp-user-id")};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){if(e.success){i.remove(),e.data.has_invites||(o.attr("class","bp-feedback"),o.addClass(e.data.type),r.html(""),r.html(e.data.feedback)),t("#group-invites-container .group-invites-column .bp-invites-content #members-list").html(""),a=1;var s={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:a};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:s,success:function(e){e.success?(d.html(""),d.html(e.data.html),v.html(""),v.html(e.data.pagination),o.attr("class","bp-feedback"),o.addClass("info"),r.html(e.data.feedback)):(d.html(""),o.attr("class","bp-feedback"),o.addClass(e.data.type),r.html(e.data.feedback))}})}else o.attr("class","bp-feedback"),o.addClass(e.data.type),r.html(""),r.html(e.data.feedback)}})})}else{c.scroll(this.loadMoreInvitesMembers),t(".groups.group-invites.send-invites .subnav #send-invites-groups-li").addClass("current selected");var m={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"members",page:a};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:m,success:function(e){e.success?(c.html(""),c.html(e.data.html),l.html(""),l.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback)):(c.html(""),l.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback))}})}t(".group-invites-select-members-dropdown").on("change",function(){t("#group-invites-container .bb-groups-invites-left #bp-invites-dropdown-options-loader").removeClass("bp-invites-dropdown-options-loader-hide");var e=this.value;if(e){a=1;var i={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:e,page:a};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){e.success?(c.html(""),c.html(e.data.html),l.html(""),l.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback)):(c.html(""),l.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback)),t("#group-invites-container .bb-groups-invites-left #bp-invites-dropdown-options-loader").addClass("bp-invites-dropdown-options-loader-hide")}})}}),t(document).on("click","#group-invites-container .bb-groups-invites-left #members-list li .action .group-add-remove-invite-button",function(){var a=t(this).attr("data-bp-user-id"),i=t(this).attr("data-bp-user-name"),s={id:a,text:i};if(t(this).closest("li").hasClass("selected")){t(this).closest("li").removeClass("selected");var n=[];t.grep(e.select2("data"),function(e){return e.id!=a}).forEach(function(e){n.push(+e.id)}),e.val(n).trigger("change"),t('#group-invites-send-to-input option[value="'+a+'"]').each(function(){t(this).remove()}),t(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.add_recipient)}else{if(t(this).closest("li").addClass("selected"),!e.find("option[value='"+s.id+"']").length){var o=new Option(s.text,s.id,!0,!0);e.append(o).trigger("change")}t(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.remove_recipient)}}),t(document).on("click","#group-invites-container .bb-groups-invites-left .last #bp-group-invites-next-page",function(){a+=1;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:a,search_terms:t("#group-invites-container .bb-groups-invites-left #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(t("#group-invites-container .group-invites-members-listing #members-list li.load-more").remove(),c.append(e.data.html),l.html(""),l.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback)):(u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container .bb-groups-invites-left #group_invites_search",function(){var e=t("#group-invites-container .bb-groups-invites-left #group_invites_search").val();if(""===e)return!1;var i={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:1,search_terms:e};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(e){e.success?(c.html(""),c.html(e.data.html),l.html(""),l.html(e.data.pagination),a=e.data.page,u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback)):(c.html(""),l.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(""),p.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-bottom #send_group_invite_button",function(o){o.preventDefault();var r=[];t.grep(e.select2("data"),function(e){return 0!=e.id}).forEach(function(e){r.push(+e.id)});var d={action:"groups_send_group_invites",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.send_invites,group_id:BP_Nouveau.group_invites.group_id,message:t("textarea#send-invites-control").val(),users:r};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,success:function(o){if(o.success){n.show(),i.attr("class","bp-feedback"),i.addClass(o.data.type),s.html(""),s.html(o.data.feedback),e.find("option").remove(),t("textarea#send-invites-control").val(""),a=1;var r={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t("#group-invites-container .bb-groups-invites-left .group-invites-select-members-dropdown").val(),page:a};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:r,success:function(e){e.success?(c.html(""),c.html(e.data.html),l.html(""),l.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback)):(c.html(""),l.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback))}})}else n.show(),i.attr("class","bp-feedback"),i.addClass(o.data.type),s.html(""),s.html(o.data.feedback)}})}),t(document).on("click","#group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-bottom #bp_invites_reset",function(i){i.preventDefault(),n.hide(),e.find("option").remove(),t("textarea#send-invites-control").val(""),a=1;var s={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t("#group-invites-container .bb-groups-invites-left .group-invites-select-members-dropdown").val(),page:a};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:s,success:function(e){e.success?(c.html(""),c.html(e.data.html),l.html(""),l.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback)):(c.html(""),l.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback))}})}),t(document).on("click","#group-invites-container .bb-groups-invites-left #group_invites_search_submit",function(e){e.preventDefault();var i=t("#group-invites-container .bb-groups-invites-left #group_invites_search").val();if(""===i)return!1;a=1;var s={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:a,search_terms:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){e.success?(c.html(""),c.html(e.data.html),l.html(""),l.html(e.data.pagination),u.attr("class","bp-feedback"),u.addClass("info"),p.html(e.data.feedback)):(c.html(""),l.html(""),u.attr("class","bp-feedback"),u.addClass(e.data.type),p.html(e.data.feedback))}})})},addSelect2:function(e){var a=[];e.select2({placeholder:"",minimumInputLength:1,ajax:{url:bp.ajax.settings.url,dataType:"json",delay:250,data:function(e){return t.extend({},e,{nonce:BP_Nouveau.group_invites.nonces.retrieve_group_members,action:"groups_get_group_potential_user_send_invites",group:BP_Nouveau.group_invites.group_id})},cache:!0,processResults:function(e){return!1===jQuery.isEmptyObject(a)&&t.each(a,function(t,a){for(var i=0;i<e.data.results.length;i++)e.data.results[i].id===a&&e.data.results.splice(i,1)}),{results:e&&e.success?e.data.results:[]}}}}),e.on("select2:select",function(e){var t=e.params.data;a.push(t.id)}),e.on("select2:unselect",function(e){var t=e.params.data;a=jQuery.grep(a,function(e){return e!==t.id})})},isScrolledIntoView:function(e){var a=t(window).scrollTop(),i=a+t(window).height(),s=t(e).offset().top;return s+t(e).height()<=i&&s>=a},loadMoreInvitesMembers:function(e){var a=t(e.currentTarget);a[0].scrollHeight-a.scrollTop()===a.innerHeight()&&t("#group-invites-container .group-invites-members-listing #members-list li.load-more").length&&t("#group-invites-container .group-invites-members-listing .last #bp-group-invites-next-page").trigger("click")}},bp.Nouveau.GroupInvites.start())}(bp,jQuery);