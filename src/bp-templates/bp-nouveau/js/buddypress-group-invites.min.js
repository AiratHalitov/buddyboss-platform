window.wp=window.wp||{},window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(_.extend(bp,_.pick(wp,"Backbone","ajax","template")),bp.Models=bp.Models||{},bp.Collections=bp.Collections||{},bp.Views=bp.Views||{},bp.Nouveau=bp.Nouveau||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.GroupInvites={start:function(){this.views=new Backbone.Collection;var e=t("body").find("#group-invites-send-to-input"),i=1;this.addSelect2(e);var n=t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback"),a=t("#group-invites-container .bb-groups-invites-right .bp-invites-feedback .bp-feedback p"),s=t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback"),o=t("#group-invites-container .bb-groups-invites-left .group-invites-members-listing .bp-invites-feedback .bp-feedback p"),r=t(".group-invites-members-listing #members-list"),u=t(".group-invites-members-listing .last");s.attr("class","bp-feedback"),s.addClass("loading"),o.html(BP_Nouveau.group_invites.loading),n.attr("class","bp-feedback"),n.addClass("help"),a.html(""),a.html(BP_Nouveau.group_invites.invites_form),t("#item-body #group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field").prop("disabled",!0),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-top .select2-container .selection .select2-selection--multiple .select2-selection__rendered .select2-search--inline .select2-search__field",function(){t(this).prop("disabled",!0)}),e.on("select2:unselect",function(e){var i=e.params.data;t('#group-invites-send-to-input option[value="'+i.id+'"]').each(function(){t(this).remove()}),t("#item-body #group-invites-container .bb-groups-invites-left #members-list li."+i.id).removeClass("selected"),t("#item-body #group-invites-container .bb-groups-invites-left #members-list li."+i.id+" .action button").attr("data-bp-tooltip",BP_Nouveau.group_invites.add_recipient)});var c=t(".groups.group-invites.pending-invites");if(c.length){var p=0;t(window).scroll(function(){var e=t(".groups.group-invites.pending-invites #item-body #group-invites-container .group-invites-column .bp-invites-content #members-list li.load-more");if(e.length){var i=t(window).scrollTop(),n=i+t(window).height(),a=t(e).offset().top;(a+t(e).height()<=n&&a>=i||t(window).scrollTop()+t(window).height()>=t(document).height())&&0==p&&(t("#item-body #group-invites-container .last #bp-group-invites-next-page").trigger("click"),p=1)}})}if(c.length){t(".groups.group-invites.pending-invites .subnav #pending-invites-groups-li").addClass("current selected");var d={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited"};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:d,success:function(e){e.success?(t(".members.bp-invites-content #members-list").html(""),t(".members.bp-invites-content #members-list").html(e.data.html),t("#group-invites-container .group-invites-column .subnav-filters div .last").html(""),t("#group-invites-container .group-invites-column .subnav-filters div .last").html(e.data.pagination),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass("info"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback)):(t(".members.bp-invites-content #members-list").html(""),t(".members.bp-invites-content #members-list").html(""),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass(e.data.type),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback))}}),t(document).on("click","#item-body #group-invites-container .last #bp-group-invites-next-page",function(){s.attr("class","bp-feedback"),s.addClass("loading"),o.html(BP_Nouveau.group_invites.loading),i+=1;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:i,search_terms:t("#item-body #group-invites-container .group-invites-column #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){p=0,e.success?(t(".members.bp-invites-content #members-list").html(""),t(".members.bp-invites-content #members-list").html(e.data.html),t("#group-invites-container .group-invites-column .subnav-filters div .last").html(""),t("#group-invites-container .group-invites-column .subnav-filters div .last").html(e.data.pagination),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass("info"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback)):(t(".members.bp-invites-content #members-list").html(""),t(".members.bp-invites-content #members-list").html(""),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass(e.data.type),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .last #bp-group-invites-prev-page",function(){t("#item-body #group-invites-container .bp-invites-feedback").show(),t("#item-body #group-invites-container .bp-invites-feedback .bp-feedback").addClass("info"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(BP_Nouveau.group_invites.loading),i-=1;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:i,search_terms:t("#item-body #group-invites-container .group-invites-column #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(t(".members.bp-invites-content #members-list").html(""),t(".members.bp-invites-content #members-list").html(e.data.html),t("#group-invites-container .group-invites-column .subnav-filters div .last").html(""),t("#group-invites-container .group-invites-column .subnav-filters div .last").html(e.data.pagination),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass("info"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback)):(t(".members.bp-invites-content #members-list").html(""),t(".members.bp-invites-content #members-list").html(""),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass(e.data.type),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container #group_invites_search_submit",function(e){e.preventDefault();var n=t("#item-body #group-invites-container #group_invites_search").val();if(""===n)return!1;var a={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:1,search_terms:n};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:a,success:function(e){e.success?(t(".members.bp-invites-content #members-list").html(""),t(".members.bp-invites-content #members-list").html(e.data.html),t("#group-invites-container .group-invites-column .subnav-filters div .last").html(""),t("#group-invites-container .group-invites-column .subnav-filters div .last").html(e.data.pagination),i=e.data.page,t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass("info"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback)):(t(".members.bp-invites-content #members-list").html(""),t(".members.bp-invites-content #members-list").html(""),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass(e.data.type),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container #members-list li .item .action .group-remove-invite-button",function(e){e.preventDefault(),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass("loading"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(""),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(BP_Nouveau.group_invites.removing);var n=t(this).closest("li"),a={action:"groups_delete_group_invite",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.uninvite,group_id:BP_Nouveau.group_invites.group_id,user:t(this).attr("data-bp-user-id")};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:a,success:function(e){if(e.success){n.remove(),e.data.has_invites||(t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass(e.data.type),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(""),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback)),t("#group-invites-container .group-invites-column .bp-invites-content #members-list").html(""),i=1;var a={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"invited",page:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:a,success:function(e){e.success?(t(".members.bp-invites-content #members-list").html(""),t(".members.bp-invites-content #members-list").html(e.data.html),t("#group-invites-container .group-invites-column .subnav-filters div .last").html(""),t("#group-invites-container .group-invites-column .subnav-filters div .last").html(e.data.pagination),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass("info"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback)):(t(".members.bp-invites-content #members-list").html(""),t(".members.bp-invites-content #members-list").html(""),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass(e.data.type),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback))}})}else t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").attr("class","bp-feedback"),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback").addClass(e.data.type),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(""),t("#group-invites-container .group-invites-column .bp-invites-feedback .bp-feedback p").html(e.data.feedback)}})})}else{t(".groups.group-invites.send-invites .subnav #send-invites-groups-li").addClass("current selected");var l={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"members"};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:l,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),o.html(e.data.feedback))}})}t(".group-invites-select-members-dropdown").on("change",function(){s.attr("class","bp-feedback"),s.addClass("loading"),o.html(BP_Nouveau.group_invites.loading);var e=this.value;if(e){var i={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:e};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:i,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),o.html(e.data.feedback))}})}}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left #members-list li .action .group-add-remove-invite-button",function(){var i=t(this).attr("data-bp-user-id"),n=t(this).attr("data-bp-user-name"),a={id:i,text:n};if(t(this).closest("li").hasClass("selected")){t(this).closest("li").removeClass("selected");var s=[];t.grep(e.select2("data"),function(e){return e.id!=i}).forEach(function(e){s.push(+e.id)}),e.val(s).trigger("change"),t('#group-invites-send-to-input option[value="'+i+'"]').each(function(){t(this).remove()}),t(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.add_recipient)}else{if(t(this).closest("li").addClass("selected"),!e.find("option[value='"+a.id+"']").length){var o=new Option(a.text,a.id,!0,!0);e.append(o).trigger("change")}t(this).attr("data-bp-tooltip",BP_Nouveau.group_invites.remove_recipient)}}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left .last #bp-group-invites-next-page",function(){i+=1,s.attr("class","bp-feedback"),s.addClass("loading"),o.html(BP_Nouveau.group_invites.loading);var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:i,search_terms:t("#item-body #group-invites-container .bb-groups-invites-left #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),o.html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left .last #bp-group-invites-prev-page",function(){t("#item-body #group-invites-container .bb-groups-invites-left .bp-invites-feedback").show(),t("#item-body #group-invites-container .bb-groups-invites-left .bp-invites-feedback .bp-feedback").addClass("info"),o.html(BP_Nouveau.group_invites.loading),i-=1;var e={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:i,search_terms:t("#item-body #group-invites-container .bb-groups-invites-left #group_invites_search").val()};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),o.html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left #group_invites_search",function(){var e=t("#item-body #group-invites-container .bb-groups-invites-left #group_invites_search").val();if(""===e)return!1;var n={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:1,search_terms:e};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),i=e.data.page,s.attr("class","bp-feedback"),s.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),o.html(""),o.html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-bottom #send_group_invite_button",function(i){i.preventDefault();var s=[];t.grep(e.select2("data"),function(e){return 0!=e.id}).forEach(function(e){s.push(+e.id)});var o={action:"groups_send_group_invites",nonce:BP_Nouveau.nonces.groups,_wpnonce:BP_Nouveau.group_invites.nonces.send_invites,group_id:BP_Nouveau.group_invites.group_id,message:t("textarea#send-invites-control").val(),users:s};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(i){i.success?(n.attr("class","bp-feedback"),n.addClass(i.data.type),a.html(""),a.html(i.data.feedback),e.find("option").remove(),t("textarea#send-invites-control").val("")):(n.attr("class","bp-feedback"),n.addClass(i.data.type),a.html(""),a.html(i.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-right #send_group_invite_form .bb-groups-invites-right-bottom #bp_invites_reset",function(n){n.preventDefault(),e.find("option").remove(),t("textarea#send-invites-control").val(""),i=1;var a={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:"members",page:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,async:!1,data:a,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),o.html(e.data.feedback))}})}),t(document).on("click","#item-body #group-invites-container .bb-groups-invites-left #group_invites_search_submit",function(e){e.preventDefault();var n=t("#item-body #group-invites-container .bb-groups-invites-left #group_invites_search").val();if(""===n)return!1;i=1;var a={action:"groups_get_group_potential_invites",nonce:BP_Nouveau.nonces.groups,group_id:BP_Nouveau.group_invites.group_id,scope:t(".group-invites-select-members-dropdown :selected").val(),page:i,search_terms:n};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:a,success:function(e){e.success?(r.html(""),r.html(e.data.html),u.html(""),u.html(e.data.pagination),s.attr("class","bp-feedback"),s.addClass("info"),o.html(e.data.feedback)):(r.html(""),u.html(""),s.attr("class","bp-feedback"),s.addClass(e.data.type),o.html(e.data.feedback))}})})},addSelect2:function(e){var i=[];e.select2({placeholder:"",minimumInputLength:1,ajax:{url:bp.ajax.settings.url,dataType:"json",delay:250,data:function(e){return t.extend({},e,{nonce:BP_Nouveau.group_invites.nonces.retrieve_group_members,action:"groups_get_group_potential_user_send_invites",group:BP_Nouveau.group_invites.group_id})},cache:!0,processResults:function(e){return!1===jQuery.isEmptyObject(i)&&t.each(i,function(t,i){for(var n=0;n<e.data.results.length;n++)e.data.results[n].id===i&&e.data.results.splice(n,1)}),{results:e&&e.success?e.data.results:[]}}}}),e.on("select2:select",function(e){var t=e.params.data;i.push(t.id)}),e.on("select2:unselect",function(e){var t=e.params.data;i=jQuery.grep(i,function(e){return e!==t.id})})},isScrolledIntoView:function(e){var i=t(window).scrollTop(),n=i+t(window).height(),a=t(e).offset().top;return a+t(e).height()<=n&&a>=i}},bp.Nouveau.GroupInvites.start())}(bp,jQuery);