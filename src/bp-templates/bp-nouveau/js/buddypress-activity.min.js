window.bp=window.bp||{},function(x){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Models=bp.Models||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.Activity={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.just_posted=[],this.current_page=1,this.mentions_count=Number(x(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0,this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:x(document).prop("title")},void 0!==window.Dropzone&&void 0!==BP_Nouveau.media&&(window.Dropzone.autoDiscover=!1,this.dropzone_options={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},void 0!==BP_Nouveau.media.dropzone_options&&Object.assign(this.dropzone_options,BP_Nouveau.media.dropzone_options)),this.dropzone_obj=null,this.dropzone_media=[],this.dropzone_document_obj=null,this.dropzone_document=[],this.models=[]},addListeners:function(){x("body").hasClass("activity-singular")||x("#buddypress").on("bp_heartbeat_send",this.heartbeatSend.bind(this)),x("#buddypress").on("bp_heartbeat_tick",this.heartbeatTick.bind(this)),x('#buddypress [data-bp-list="activity"]').on("click","li.load-newest, li.load-more",this.injectActivities.bind(this)),x("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this)),x('#buddypress [data-bp-list="activity"]').on("bp_ajax_append",this.hideComments),x('#buddypress [data-bp-list="activity"]').on("click",".show-all",this.showComments),x('#buddypress [data-bp-list="activity"]').on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),x('#buddypress [data-bp-list="activity"]').on("click",".activity-privacy>li",bp.Nouveau,this.activityPrivacyChange.bind(this)),x('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),x("#bb-media-model-container .activity-list").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),x(document).keydown(this.commentFormAction),x(document).click(this.togglePopupDropdown),x('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-media-button",this.openCommentsMediaUploader.bind(this)),x('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-document-button",this.openCommentsDocumentUploader.bind(this)),x('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-gif-button",this.openGifPicker.bind(this)),_.isUndefined(BP_Nouveau.activity.params.autoload)||x(window).scroll(this.loadMoreActivities)},heartbeatSend:function(e,t){this.heartbeat_data.first_recorded=x("#buddypress [data-bp-list] [data-bp-activity-id]").first().data("bp-timestamp")||0,(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded)&&(this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded),t.bp_activity_last_recorded=this.heartbeat_data.last_recorded,x("#buddypress .dir-search input[type=search]").length&&(t.bp_activity_last_recorded_search_terms=x("#buddypress .dir-search input[type=search]").val()),x.extend(t,{bp_heartbeat:bp.Nouveau.getStorage("bp-activity")})},heartbeatTick:function(e,t){var a,i,o,d,s=bp.Nouveau.objects,n=bp.Nouveau.getStorage("bp-activity","scope"),r=this;void 0!==t&&t.bp_activity_newest_activities&&(this.heartbeat_data.newest=x.trim(t.bp_activity_newest_activities.activities)+this.heartbeat_data.newest,this.heartbeat_data.last_recorded=Number(t.bp_activity_newest_activities.last_recorded),i=x(this.heartbeat_data.newest).filter(".activity-item"),a=Number(i.length),s.push("mentions"),"all"===n?(x.each(i,function(e,a){a=x(a),x.each(s,function(e,t){-1!==x.inArray("bp-my-"+t,a.get(0).classList)&&(void 0===r.heartbeat_data.highlights[t]?r.heartbeat_data.highlights[t]=[a.data("bp-activity-id")]:-1===x.inArray(a.data("bp-activity-id"),r.heartbeat_data.highlights[t])&&r.heartbeat_data.highlights[t].push(a.data("bp-activity-id")))})}),o=new RegExp("bp-my-("+s.join("|")+")","g"),this.heartbeat_data.newest=this.heartbeat_data.newest.replace(o,""),x(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(a)):(this.heartbeat_data.highlights[n]=[],x.each(i,function(e,t){r.heartbeat_data.highlights[n].push(x(t).data("bp-activity-id"))})),x.each(s,function(e,t){var a;void 0!==r.heartbeat_data.highlights[t]&&r.heartbeat_data.highlights[t].length&&(a=0,"mentions"===t&&(a=r.mentions_count),x(bp.Nouveau.objectNavParent+' [data-bp-scope="'+t+'"]').find("a span").html(Number(r.heartbeat_data.highlights[t].length)+a))}),s.pop(),x(document).prop("title","("+a+") "+this.heartbeat_data.document_title),x('#buddypress [data-bp-list="activity"] li').first().hasClass("load-newest")?(d=x('#buddypress [data-bp-list="activity"] .load-newest a').html(),x('#buddypress [data-bp-list="activity"] .load-newest a').html(d.replace(/([0-9]+)/,a))):x('#buddypress [data-bp-list="activity"] ul.activity-list').prepend('<li class="load-newest"><a href="#newest">'+BP_Nouveau.newest+" ("+a+")</a></li>"),x('#buddypress [data-bp-list="activity"] li.load-newest').trigger("click"),x('#buddypress [data-bp-list="activity"]').trigger("bp_heartbeat_pending",this.heartbeat_data))},injectActivities:function(e){var t,a,i,o,d,s=bp.Nouveau.getStorage("bp-activity"),n=s.scope||null,r=s.filter||null;x(e.currentTarget).hasClass("load-newest")?(e.preventDefault(),x(e.currentTarget).remove(),t=x.parseHTML(this.heartbeat_data.newest),x.each(t,function(e,t){"LI"===t.nodeName&&x(t).hasClass("just-posted")&&x("#"+x(t).prop("id")).length&&x("#"+x(t).prop("id")).remove()}),x(e.delegateTarget).find(".activity-list").prepend(this.heartbeat_data.newest).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data),this.heartbeat_data.newest="","all"===n&&x(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(""),"mentions"===n&&(bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity"),this.mentions_count=0),x(bp.Nouveau.objectNavParent+' [data-bp-scope="'+n+'"]').find("a span").html(""),void 0!==this.heartbeat_data.highlights[n]&&(this.heartbeat_data.highlights[n]=[]),setTimeout(function(){x(e.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+n+"_activity")},3e3),x(document).prop("title",this.heartbeat_data.document_title)):x(e.currentTarget).hasClass("load-more")&&(a=+Number(this.current_page)+1,i=this,o="",e.preventDefault(),(d=x(e.currentTarget)).find("a").first().addClass("loading"),this.just_posted=[],x(e.delegateTarget).children(".just-posted").each(function(){i.just_posted.push(x(this).data("bp-activity-id"))}),x("#buddypress .dir-search input[type=search]").length&&(o=x("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"activity",scope:n,filter:r,search_terms:o,page:a,method:"append",exclude_just_posted:this.just_posted.join(","),target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(d.remove(),i.current_page=a,jQuery(window).scroll())}))},hideComments:function(e){var a,i,o,t=x(e.target).find(".activity-comments");t.length&&t.each(function(e,t){o=x(t).children("ul"),(i=x(o).find("li")).length&&(a=x(t).closest(".activity-item"),x("#acomment-comment-"+a.data("bp-activity-id")+" span.comment-count").html(),i.each(function(e,t){e<i.length-4&&(x(t).addClass("bp-hidden").hide(),e||x(t).before('<li class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+a.prop("id")+'/show-all/">'+BP_Nouveau.show_x_comments+"</button></li>"))}),x(o).children(".bp-hidden").length===x(o).children("li").length-1&&x(o).find("li.show-all").length&&x(o).children("li:not(.show-all)").removeClass("bp-hidden").toggle())})},showComments:function(e){e.preventDefault(),x(e.target).addClass("loading"),setTimeout(function(){x(e.target).closest("ul").find("li").removeClass("bp-hidden").fadeIn(300,function(){x(e.target).parent("li").remove()})},600)},scopeLoaded:function(e,a){this.hideComments(e),this.current_page=1,"mentions"===a.scope&&void 0!==a.response.new_mentions?(x.each(a.response.new_mentions,function(e,t){x("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').addClass("newest_mentions_activity")}),this.mentions_count=0):void 0!==this.heartbeat_data.highlights[a.scope]&&this.heartbeat_data.highlights[a.scope].length&&x.each(this.heartbeat_data.highlights[a.scope],function(e,t){x("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').length&&x("#buddypress #activity-stream").find('[data-bp-activity-id="'+t+'"]').addClass("newest_"+a.scope+"_activity")}),this.heartbeat_data.newest="",x.each(x(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(e,t){0===parseInt(x(t).html(),10)&&x(t).html("")}),void 0!==this.heartbeat_data.highlights[a.scope]&&(this.heartbeat_data.highlights[a.scope]=[]),x(document).prop("title",this.heartbeat_data.document_title),setTimeout(function(){x("#buddypress #activity-stream .activity-item").removeClass("newest_"+a.scope+"_activity")},3e3),void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse()},activityPrivacyChange:function(e){var t=e.data,a=x(e.target),i=x(e.currentTarget).closest(".activity-item"),o=i.data("bp-activity-id");if(e.preventDefault(),void 0===a.data("value")||""==x.trim(a.data("value")))return!1;i.find(".privacy").addClass("loading"),t.ajax({action:"activity_update_privacy",id:o,privacy:a.data("value")},"activity").done(function(e){i.find(".privacy").removeClass("loading"),!0===e.success&&(i.find(".activity-privacy li").removeClass("selected"),i.find(".privacy-wrap").attr("data-bp-tooltip",a.text()),a.addClass("selected"),i.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends"),i.find(".privacy").addClass(a.data("value")))})},togglePrivacyDropdown:function(e){e.data,x(e.target);var t=x(e.currentTarget).closest(".activity-item");t.data("bp-activity-id");e.preventDefault(),x("ul.activity-privacy").not(t.find(".activity-privacy")).removeClass("bb-open"),t.find(".activity-privacy").toggleClass("bb-open")},activityActions:function(e){var s,a,n,t,r,i,o,d=e.data,c=x(e.target),l=x(e.currentTarget),p=l.data("bp-activity-id"),u=x(e.delegateTarget),m=l.find(".activity-state"),v=l.find(".comments-count"),h=l.find(".like-text"),b=this;if(x(c).is("span")&&(c=x(c).closest("a")),(c.hasClass("fav")||c.hasClass("unfav"))&&(a=c.hasClass("fav")?"fav":"unfav",e.preventDefault(),c.addClass("loading"),d.ajax({action:"activity_mark_"+a,id:p},"activity").done(function(t){var e;c.removeClass("loading"),!1!==t.success&&(c.fadeOut(200,function(){var e;x(this).find("span").first().length?x(this).find("span").first().html(t.data.content):x(this).html(t.data.content),"false"===x(this).attr("aria-pressed")?x(this).attr("aria-pressed","true"):x(this).attr("aria-pressed","false"),h.length&&(t.data.like_count?h.text(t.data.like_count)&&m.addClass("has-likes"):h.empty()&&m.removeClass("has-likes"),e=x("<textarea/>").html(t.data.tooltip).text(),h.attr("data-hint",e)),x(this).find(".like-count").length&&x(this).find(".like-count").html(t.data.content),x(this).fadeIn(200)}),"fav"==a?(void 0!==t.data.directory_tab&&(x(d.objectNavParent+' [data-bp-scope="favorites"]').length||x(d.objectNavParent+' [data-bp-scope="all"]').after(t.data.directory_tab)),c.removeClass("fav"),c.addClass("unfav")):"unfav"==a&&((e=x('[data-bp-user-scope="favorites"]').hasClass("selected")||x(d.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected"))&&l.remove(),void 0!==t.data.no_favorite&&(x(d.objectNavParent+' [data-bp-scope="all"]').length&&x(d.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")?x(d.objectNavParent+' [data-bp-scope="favorites"]').remove():e&&u.append(t.data.no_favorite)),c.removeClass("unfav"),c.addClass("fav")))})),c.hasClass("delete-activity")||c.hasClass("acomment-delete")||c.hasClass("spam-activity")||c.hasClass("spam-activity-comment")){var f,y,g,w,C=c.closest("[data-bp-activity-comment-id]"),N=C.data("bp-activity-comment-id"),j=0;if(e.preventDefault(),void 0!==BP_Nouveau.confirm&&!1===window.confirm(BP_Nouveau.confirm))return!1;c.addClass("loading");var z={action:"delete_activity",id:p,_wpnonce:d.getLinkParams(c.prop("href"),"_wpnonce"),is_single:c.closest("[data-bp-single]").length};(c.hasClass("spam-activity")||c.hasClass("spam-activity-comment"))&&(z.action="bp_spam_activity"),f=l,N&&(delete z.is_single,z.id=N,z.is_comment=!0,f=C),d.ajax(z,"activity").done(function(e){if(c.removeClass("loading"),!1===e.success)f.prepend(e.data.feedback),f.find(".bp-feedback").hide().fadeIn(300);else{if(e.data.redirect)return window.location.href=e.data.redirect;var t;N&&(j=1,l.append(C.find("form")),x.each(C.find("li"),function(){j+=1}),y=m.find("span.comments-count"),g=y.text().length?y.text().match(/\d+/)[0]:0,g=Number(g-j),v.length&&(t=1<g?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel,v.text(t.replace("%d",g))),(w=l.find("li.show-all a")).length&&w.html(BP_Nouveau.show_x_comments.replace("%d",g)),0===g&&(l.removeClass("has-comments"),m.removeClass("has-comments"),v.empty())),f.slideUp(300,function(){f.remove()}),N||l.data("bp-timestamp")!==d.Activity.heartbeat_data.last_recorded||(d.Activity.heartbeat_data.newest="",d.Activity.heartbeat_data.last_recorded=0),x(document).trigger("bp_activity_ajax_delete_request",x.extend(z,{response:e}))}})}if(c.closest("span").hasClass("activity-read-more")){var P=c.closest("div"),B=c.closest("span"),k=null;if(x(P).hasClass("activity-inner")?k=p:x(P).hasClass("acomment-content")&&(k=c.closest("li").data("bp-activity-comment-id")),!k)return e;e.preventDefault(),x(B).addClass("loading"),d.ajax({action:"get_single_activity_content",id:k},"activity").done(function(e){"object"!=typeof e&&0<c.closest("div").find(".bb-activity-media-wrap").length&&(e=JSON.parse(e)),x(B).removeClass("loading"),P.parent().find(".bp-feedback").length&&P.parent().find(".bp-feedback").remove(),!1===e.success?(P.after(e.data.feedback),P.parent().find(".bp-feedback").hide().fadeIn(300)):(x(P).html(e.data.contents).slideDown(300),jQuery(window).scroll(),l.hasClass("wp-link-embed")&&(void 0!==window.instgrm&&window.instgrm.Embeds.process(),void 0!==window.FB&&void 0!==window.FB.XFBML&&window.FB.XFBML.parse(document.getElementById("activity-"+k))))})}(c.hasClass("activity-state-comments")||c.hasClass("acomment-reply")||c.parent().hasClass("acomment-reply"))&&(n=x("#ac-form-"+p),t=x('[data-bp-activity-id="'+(k=p)+'"] .activity-comments'),e.preventDefault(),c.parent().hasClass("acomment-reply")&&c.parent(),c.closest("li").data("bp-activity-comment-id")&&(k=c.closest("li").data("bp-activity-comment-id")),this.toggleMultiMediaOptions(n,c),n.removeClass("root"),x(".ac-form").hide(),x.each(n.children("div"),function(e,t){x(t).hasClass("error")&&x(t).remove()}),k===p?(t.append(n),n.addClass("root")):x('[data-bp-activity-comment-id="'+k+'"]').append(n),n.slideDown(200),c.attr("aria-expanded","true"),x.scrollTo(n,500,{offset:-100,easing:"swing"}),x("#ac-form-"+p+" #ac-input-"+p).focus(),_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.emoji)||void 0!==x("#ac-input-"+p).data("emojioneArea")||x("#ac-input-"+p).emojioneArea({standalone:!0,hideSource:!1,container:"#ac-reply-emoji-button-"+p,autocomplete:!1,pickerPosition:"bottom",hidePickerOnBlur:!0,useInternalCDN:!1,events:{emojibtn_click:function(){x("#ac-input-"+p)[0].emojioneArea.hidePicker()}}})),c.hasClass("ac-reply-cancel")&&(x(c).closest(".ac-form").slideUp(200),x(".acomment-reply").attr("aria-expanded","false"),b.destroyCommentMediaUploader(p),b.destroyCommentDocumentUploader(p),e.preventDefault()),"ac_form_submit"===c.prop("name")&&(n=c.closest("form"),k=p,e.preventDefault(),c.closest("li").data("bp-activity-comment-id")&&(k=c.closest("li").data("bp-activity-comment-id")),(r=x(n).find(".ac-input").first()).find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),c.addClass("loading").prop("disabled",!0),r.addClass("loading").prop("disabled",!0),i=r[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,""),o={action:"new_activity_comment",_wpnonce_new_activity_comment:x("#_wpnonce_new_activity_comment").val(),comment_id:k,form_id:p,content:i},x("#_bp_as_nonce_"+p).val()&&(o["_bp_as_nonce_"+p]=x("#_bp_as_nonce_"+p).val()),this.dropzone_media.length&&(o.media=this.dropzone_media,_.isEmpty(o.content)&&(o.content="&#8203;")),this.dropzone_document.length&&(o.document=this.dropzone_document,_.isEmpty(o.content)&&(o.content="&#8203;")),_.isUndefined(this.models[p])||(s=this.models[p],o.gif_data=this.models[p].get("gif_data"),_.isEmpty(o.content)&&(o.content="&#8203;")),d.ajax(o,"activity").done(function(e){if(c.removeClass("loading"),r.removeClass("loading"),x(".acomment-reply").attr("aria-expanded","false"),!1===e.success)n.append(x(e.data.feedback).hide().fadeIn(200));else{var t,a=n.parent(),i=x.trim(e.data.contents);if(n.fadeOut(200,function(){0===a.children("ul").length&&(a.hasClass("activity-comments")?a.prepend("<ul></ul>"):a.append("<ul></ul>")),a.children("ul").append(x(i).hide().fadeIn(200)),x(n).find(".ac-input").first().html(""),a.parent().addClass("has-comments"),a.parent().addClass("comments-loaded"),m.addClass("has-comments"),jQuery(window).scroll()}),y=m.find("span.comments-count"),g=y.text().length?y.text().match(/\d+/)[0]:0,g=Number(g)+1,v.length&&(t=1<g?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel,v.text(t.replace("%d",g||1))),(w=x(l).find(".show-all a"))&&w.html(BP_Nouveau.show_x_comments.replace("%d",g)),b.dropzone_media.length)for(var o=0;o<b.dropzone_media.length;o++)b.dropzone_media[o].saved=!0;if(b.dropzone_document.length)for(var d=0;d<b.dropzone_document.length;d++)b.dropzone_document[d].saved=!0}_.isUndefined(s)||(s.set("gif_data",{}),x("#ac-reply-post-gif-"+p).find(".activity-attached-gif-container").removeAttr("style")),b.destroyCommentMediaUploader(p),b.destroyCommentDocumentUploader(p),c.prop("disabled",!1),r.prop("disabled",!1)}))},commentFormAction:function(e){var t,a;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0!==e.altKey&&!0!==e.metaKey&&"TEXTAREA"===t.tagName&&x(t).hasClass("ac-input")?void(27===(a=e.keyCode?e.keyCode:e.which)&&!1===e.ctrlKey?"TEXTAREA"===t.tagName&&x(t).closest("form").slideUp(200):e.ctrlKey&&13===a&&x(t).val()&&x(t).closest("form").find("[type=submit]").first().trigger("click")):e},togglePopupDropdown:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||x(t).hasClass("privacy-wrap")||x(t).parent().hasClass("privacy-wrap")?e:void x("ul.activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var e,t=x(".load-more:visible").last(),a=x(window);t.closest(".activity-list").length&&t.get(0)&&!t.data("bp-autoloaded")&&(e=t.offset().top-50,a.scrollTop()+a.height()>e&&(t.data("bp-autoloaded",1),t.find("a").text(BP_Nouveau.activity.strings.loadingMore),t.find("a").trigger("click")))},destroyCommentMediaUploader:function(e){_.isNull(this.dropzone_obj)||(this.dropzone_obj.destroy(),x("#ac-reply-post-media-uploader-"+e).html("")),this.dropzone_media=[],x("#ac-reply-post-media-uploader-"+e).removeClass("open").addClass("closed")},destroyCommentDocumentUploader:function(e){_.isNull(this.dropzone_document_obj)||(this.dropzone_document_obj.destroy(),x("#ac-reply-post-document-uploader-"+e).html("")),this.dropzone_document=[],x("#ac-reply-post-document-uploader-"+e).removeClass("open").addClass("closed")},openCommentsMediaUploader:function(e){var a=this,t=x(e.currentTarget).closest(".ac-reply-content").find(".dropzone");e.preventDefault(),void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(a.dropzone_obj=new Dropzone("#ac-reply-post-media-uploader-"+x(e.currentTarget).data("ac-id"),a.dropzone_options),a.dropzone_obj.on("sending",function(e,t,a){a.append("action","media_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media)}),a.dropzone_obj.on("success",function(e,t){t.data.id&&(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=x(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,t.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,t.data.saved=!1,a.dropzone_media.push(t.data))}),a.dropzone_obj.on("error",function(e,t){e.accepted&&void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&x(e.previewElement).find(".dz-error-message span").text(t.data.feedback)}),a.dropzone_obj.on("removedfile",function(e){if(a.dropzone_media.length)for(var t in a.dropzone_media)if(e.upload.uuid==a.dropzone_media[t].uuid){void 0===a.dropzone_media[t].saved||a.dropzone_media[t].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_media[t].id),a.dropzone_media.splice(t,1);break}}),t.removeClass("closed").addClass("open")):(a.dropzone_obj&&a.dropzone_obj.destroy(),a.dropzone_media=[],t.html(""),t.addClass("closed").removeClass("open")));var i=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentDocumentUploader(i);var o=x(e.currentTarget).data("ac-id");x("#ac-reply-gif-button-"+o).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open"),_.isUndefined(this.models[o])||(this.models[o].set("gif_data",{}),x("#ac-reply-post-gif-"+o).find(".activity-attached-gif-container").removeAttr("style"))},openCommentsDocumentUploader:function(e){var t,a=this,i=x(e.currentTarget).closest(".ac-reply-content").find(".dropzone");e.preventDefault(),void 0!==window.Dropzone&&i.length&&(i.hasClass("closed")?(t={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:BP_Nouveau.media.document_type,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,init:function(){this.on("error",function(e){e.accepted||this.removeFile(e)})},accept:function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()},success:function(e,t){if(t.success)return e.previewElement.classList.add("dz-success");var a,i,o,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],i=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;i<o;i++)a=d[i],s.push(a.textContent=n);return s}},a.dropzone_document_obj=new Dropzone("#ac-reply-post-document-uploader-"+x(e.currentTarget).data("ac-id"),t),a.dropzone_document_obj.on("sending",function(e,t,a){a.append("action","document_document_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media)}),a.dropzone_document_obj.on("success",function(e,t){t.data.id&&(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=x(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,t.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,t.data.saved=!1,a.dropzone_document.push(t.data))}),a.dropzone_document_obj.on("error",function(e,t){e.accepted&&void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&x(e.previewElement).find(".dz-error-message span").text(t.data.feedback)}),a.dropzone_document_obj.on("removedfile",function(e){if(a.dropzone_document.length)for(var t in a.dropzone_document)if(e.upload.uuid==a.dropzone_document[t].uuid){void 0===a.dropzone_document[t].saved||a.dropzone_document[t].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_document[t].id),a.dropzone_document.splice(t,1);break}}),i.removeClass("closed").addClass("open")):(a.dropzone_document_obj&&a.dropzone_document_obj.destroy(),a.dropzone_document=[],i.html(""),i.addClass("closed").removeClass("open")));var o=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(o);var d=x(e.currentTarget).data("ac-id");x("#ac-reply-gif-button-"+d).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open"),_.isUndefined(this.models[d])||(this.models[d].set("gif_data",{}),x("#ac-reply-post-gif-"+d).find(".activity-attached-gif-container").removeAttr("style"))},openGifPicker:function(e){e.preventDefault();var t,a,i,o=e.currentTarget,d=x(o).next(),s=o.id.match(/\d+$/)[0],n=x("#ac-reply-post-gif-"+s);d.is(":empty")&&(t=new bp.Models.ACReply,a=new bp.Views.GifMediaSearchDropdown({model:t}),i=new bp.Views.ActivityAttachedGifPreview({model:t}),d.html(a.render().el),n.html(i.render().el),this.models[s]=t),d.toggleClass("open"),this.destroyCommentMediaUploader(s),this.destroyCommentDocumentUploader(s)},toggleMultiMediaOptions:function(e,t){_.isUndefined(BP_Nouveau.media)||(t.closest("li").hasClass("groups")?(!1===BP_Nouveau.media.group_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"),!1===BP_Nouveau.media.group_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"),!1===BP_Nouveau.media.gif.groups?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.groups?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")):(!1===BP_Nouveau.media.profile_media?e.find(".ac-reply-toolbar .post-media.media-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.media-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"),!1===BP_Nouveau.media.profile_document?e.find(".ac-reply-toolbar .post-media.document-support").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media.document-support").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"),!1===BP_Nouveau.media.gif.profile?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.profile?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")))}},bp.Nouveau.Activity.start())}((bp,jQuery));