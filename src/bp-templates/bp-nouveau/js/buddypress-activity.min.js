window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Models=bp.Models||{},bp.Models.ACReply=Backbone.Model.extend({defaults:{gif_data:{}}}),bp.Nouveau.Activity={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.just_posted=[],this.current_page=1,this.mentions_count=Number(t(bp.Nouveau.objectNavParent+' [data-bp-scope="mentions"]').find("a span").html())||0,this.heartbeat_data={newest:"",highlights:{},last_recorded:0,first_recorded:0,document_title:t(document).prop("title")},void 0!==window.Dropzone&&void 0!==BP_Nouveau.media&&(window.Dropzone.autoDiscover=!1,this.dropzone_options={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},void 0!==BP_Nouveau.media.dropzone_options&&Object.assign(this.dropzone_options,BP_Nouveau.media.dropzone_options)),this.dropzone_obj=null,this.dropzone_media=[],this.dropzone_document_obj=null,this.dropzone_document=[],this.models=[]},addListeners:function(){t("body").hasClass("activity-singular")||t("#buddypress").on("bp_heartbeat_send",this.heartbeatSend.bind(this)),t("#buddypress").on("bp_heartbeat_tick",this.heartbeatTick.bind(this)),t('#buddypress [data-bp-list="activity"]').on("click","li.load-newest, li.load-more",this.injectActivities.bind(this)),t("#buddypress").on("bp_ajax_request",'[data-bp-list="activity"]',this.scopeLoaded.bind(this)),t('#buddypress [data-bp-list="activity"]').on("bp_ajax_append",this.hideComments),t('#buddypress [data-bp-list="activity"]').on("click",".show-all",this.showComments),t('#buddypress [data-bp-list="activity"]').on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),t('#buddypress [data-bp-list="activity"]').on("click",".activity-privacy>li",bp.Nouveau,this.activityPrivacyChange.bind(this)),t('#buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click","span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),t("#bb-media-model-container .activity-list").on("click",".activity-item",bp.Nouveau,this.activityActions.bind(this)),t(document).keydown(this.commentFormAction),t(document).click(this.togglePopupDropdown),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-media-button",this.openCommentsMediaUploader.bind(this)),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-document-button",this.openCommentsDocumentUploader.bind(this)),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list').on("click",".ac-reply-gif-button",this.openGifPicker.bind(this)),_.isUndefined(BP_Nouveau.activity.params.autoload)||t(window).scroll(this.loadMoreActivities)},heartbeatSend:function(e,a){this.heartbeat_data.first_recorded=t("#buddypress [data-bp-list] [data-bp-activity-id]").first().data("bp-timestamp")||0,(0===this.heartbeat_data.last_recorded||this.heartbeat_data.first_recorded>this.heartbeat_data.last_recorded)&&(this.heartbeat_data.last_recorded=this.heartbeat_data.first_recorded),a.bp_activity_last_recorded=this.heartbeat_data.last_recorded,t("#buddypress .dir-search input[type=search]").length&&(a.bp_activity_last_recorded_search_terms=t("#buddypress .dir-search input[type=search]").val()),t.extend(a,{bp_heartbeat:bp.Nouveau.getStorage("bp-activity")})},heartbeatTick:function(e,a){var i,o,d=bp.Nouveau.objects,s=bp.Nouveau.getStorage("bp-activity","scope"),n=this;if(void 0!==a&&a.bp_activity_newest_activities){if(this.heartbeat_data.newest=t.trim(a.bp_activity_newest_activities.activities)+this.heartbeat_data.newest,this.heartbeat_data.last_recorded=Number(a.bp_activity_newest_activities.last_recorded),o=t(this.heartbeat_data.newest).filter(".activity-item"),i=Number(o.length),d.push("mentions"),"all"===s){t.each(o,function(e,a){a=t(a),t.each(d,function(e,i){-1!==t.inArray("bp-my-"+i,a.get(0).classList)&&(void 0===n.heartbeat_data.highlights[i]?n.heartbeat_data.highlights[i]=[a.data("bp-activity-id")]:-1===t.inArray(a.data("bp-activity-id"),n.heartbeat_data.highlights[i])&&n.heartbeat_data.highlights[i].push(a.data("bp-activity-id")))})});var r=new RegExp("bp-my-("+d.join("|")+")","g");this.heartbeat_data.newest=this.heartbeat_data.newest.replace(r,""),t(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(i)}else this.heartbeat_data.highlights[s]=[],t.each(o,function(e,a){n.heartbeat_data.highlights[s].push(t(a).data("bp-activity-id"))});if(t.each(d,function(e,a){if(void 0!==n.heartbeat_data.highlights[a]&&n.heartbeat_data.highlights[a].length){var i=0;"mentions"===a&&(i=n.mentions_count),t(bp.Nouveau.objectNavParent+' [data-bp-scope="'+a+'"]').find("a span").html(Number(n.heartbeat_data.highlights[a].length)+i)}}),d.pop(),t(document).prop("title","("+i+") "+this.heartbeat_data.document_title),t('#buddypress [data-bp-list="activity"] li').first().hasClass("load-newest")){var c=t('#buddypress [data-bp-list="activity"] .load-newest a').html();t('#buddypress [data-bp-list="activity"] .load-newest a').html(c.replace(/([0-9]+)/,i))}else t('#buddypress [data-bp-list="activity"] ul.activity-list').prepend('<li class="load-newest"><a href="#newest">'+BP_Nouveau.newest+" ("+i+")</a></li>");t('#buddypress [data-bp-list="activity"] li.load-newest').trigger("click"),t('#buddypress [data-bp-list="activity"]').trigger("bp_heartbeat_pending",this.heartbeat_data)}},injectActivities:function(e){var a=bp.Nouveau.getStorage("bp-activity"),i=a.scope||null,o=a.filter||null;if(t(e.currentTarget).hasClass("load-newest")){e.preventDefault(),t(e.currentTarget).remove();var d=t.parseHTML(this.heartbeat_data.newest);t.each(d,function(e,a){"LI"===a.nodeName&&t(a).hasClass("just-posted")&&t("#"+t(a).prop("id")).length&&t("#"+t(a).prop("id")).remove()}),t(e.delegateTarget).find(".activity-list").prepend(this.heartbeat_data.newest).find("li.activity-item").each(bp.Nouveau.hideSingleUrl).trigger("bp_heartbeat_prepend",this.heartbeat_data),this.heartbeat_data.newest="","all"===i&&t(bp.Nouveau.objectNavParent+' [data-bp-scope="all"]').find("a span").html(""),"mentions"===i&&(bp.Nouveau.ajax({action:"activity_clear_new_mentions"},"activity"),this.mentions_count=0),t(bp.Nouveau.objectNavParent+' [data-bp-scope="'+i+'"]').find("a span").html(""),void 0!==this.heartbeat_data.highlights[i]&&(this.heartbeat_data.highlights[i]=[]),setTimeout(function(){t(e.delegateTarget).find("[data-bp-activity-id]").removeClass("newest_"+i+"_activity")},3e3),t(document).prop("title",this.heartbeat_data.document_title)}else if(t(e.currentTarget).hasClass("load-more")){var s=1*Number(this.current_page)+1,n=this,r="";e.preventDefault();var c=t(e.currentTarget);c.find("a").first().addClass("loading"),this.just_posted=[],t(e.delegateTarget).children(".just-posted").each(function(){n.just_posted.push(t(this).data("bp-activity-id"))}),t("#buddypress .dir-search input[type=search]").length&&(r=t("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"activity",scope:i,filter:o,search_terms:r,page:s,method:"append",exclude_just_posted:this.just_posted.join(","),target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(c.remove(),n.current_page=s,jQuery(window).scroll())})}},hideComments:function(e){var a,i,o,d,s=t(e.target).find(".activity-comments");s.length&&s.each(function(e,s){d=t(s).children("ul"),(i=t(d).find("li")).length&&(a=t(s).closest(".activity-item"),o=t("#acomment-comment-"+a.data("bp-activity-id")+" span.comment-count").html()||" ",i.each(function(e,o){e<i.length-4&&(t(o).addClass("bp-hidden").hide(),e||t(o).before('<li class="show-all"><button class="text-button" type="button" data-bp-show-comments-id="#'+a.prop("id")+'/show-all/">'+BP_Nouveau.show_x_comments+"</button></li>"))}),t(d).children(".bp-hidden").length===t(d).children("li").length-1&&t(d).find("li.show-all").length&&t(d).children("li:not(.show-all)").removeClass("bp-hidden").toggle())})},showComments:function(e){e.preventDefault(),t(e.target).addClass("loading"),setTimeout(function(){t(e.target).closest("ul").find("li").removeClass("bp-hidden").fadeIn(300,function(){t(e.target).parent("li").remove()})},600)},scopeLoaded:function(e,a){this.hideComments(e),this.current_page=1,"mentions"===a.scope&&void 0!==a.response.new_mentions?(t.each(a.response.new_mentions,function(e,a){t("#buddypress #activity-stream").find('[data-bp-activity-id="'+a+'"]').addClass("newest_mentions_activity")}),this.mentions_count=0):void 0!==this.heartbeat_data.highlights[a.scope]&&this.heartbeat_data.highlights[a.scope].length&&t.each(this.heartbeat_data.highlights[a.scope],function(e,i){t("#buddypress #activity-stream").find('[data-bp-activity-id="'+i+'"]').length&&t("#buddypress #activity-stream").find('[data-bp-activity-id="'+i+'"]').addClass("newest_"+a.scope+"_activity")}),this.heartbeat_data.newest="",t.each(t(bp.Nouveau.objectNavParent+" [data-bp-scope]").find("a span"),function(e,a){0===parseInt(t(a).html(),10)&&t(a).html("")}),void 0!==this.heartbeat_data.highlights[a.scope]&&(this.heartbeat_data.highlights[a.scope]=[]),t(document).prop("title",this.heartbeat_data.document_title),setTimeout(function(){t("#buddypress #activity-stream .activity-item").removeClass("newest_"+a.scope+"_activity")},3e3)},activityPrivacyChange:function(e){var a=e.data,i=t(e.target),o=t(e.currentTarget).closest(".activity-item"),d=o.data("bp-activity-id");if(e.preventDefault(),void 0===i.data("value")||""==t.trim(i.data("value")))return!1;o.find(".privacy").addClass("loading"),a.ajax({action:"activity_update_privacy",id:d,privacy:i.data("value")},"activity").done(function(e){o.find(".privacy").removeClass("loading"),!0===e.success&&(o.find(".activity-privacy li").removeClass("selected"),o.find(".privacy-wrap").attr("data-bp-tooltip",i.text()),i.addClass("selected"),o.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends"),o.find(".privacy").addClass(i.data("value")))})},togglePrivacyDropdown:function(e){e.data,t(e.target);var a=t(e.currentTarget).closest(".activity-item");a.data("bp-activity-id");e.preventDefault(),t("ul.activity-privacy").not(a.find(".activity-privacy")).removeClass("bb-open"),a.find(".activity-privacy").toggleClass("bb-open")},activityActions:function(e){var a,i,o,d=e.data,s=t(e.target),n=t(e.currentTarget),r=n.data("bp-activity-id"),c=t(e.delegateTarget),l=n.find(".activity-state"),p=n.find(".comments-count"),u=n.find(".like-text"),m=this;if(t(s).is("span")&&(s=t(s).closest("a")),s.hasClass("fav")||s.hasClass("unfav")){var v=s.hasClass("fav")?"fav":"unfav";e.preventDefault(),s.addClass("loading"),d.ajax({action:"activity_mark_"+v,id:r},"activity").done(function(e){if(s.removeClass("loading"),!1!==e.success)if(s.fadeOut(200,function(){if(t(this).find("span").first().length?t(this).find("span").first().html(e.data.content):t(this).html(e.data.content),"false"===t(this).attr("aria-pressed")?t(this).attr("aria-pressed","true"):t(this).attr("aria-pressed","false"),u.length){e.data.like_count?u.text(e.data.like_count)&&l.addClass("has-likes"):u.empty()&&l.removeClass("has-likes");var a=t("<textarea/>").html(e.data.tooltip).text();u.attr("data-hint",a)}t(this).find(".like-count").length&&t(this).find(".like-count").html(e.data.content),t(this).fadeIn(200)}),"fav"===v)void 0!==e.data.directory_tab&&(t(d.objectNavParent+' [data-bp-scope="favorites"]').length||t(d.objectNavParent+' [data-bp-scope="all"]').after(e.data.directory_tab)),s.removeClass("fav"),s.addClass("unfav");else if("unfav"===v){var a=t('[data-bp-user-scope="favorites"]').hasClass("selected")||t(d.objectNavParent+' [data-bp-scope="favorites"]').hasClass("selected");a&&n.remove(),void 0!==e.data.no_favorite&&(t(d.objectNavParent+' [data-bp-scope="all"]').length&&t(d.objectNavParent+' [data-bp-scope="all"]').hasClass("selected")?t(d.objectNavParent+' [data-bp-scope="favorites"]').remove():a&&c.append(e.data.no_favorite)),s.removeClass("unfav"),s.addClass("fav")}})}if(s.hasClass("delete-activity")||s.hasClass("acomment-delete")||s.hasClass("spam-activity")||s.hasClass("spam-activity-comment")){var h,b,f,y,g=s.closest("[data-bp-activity-comment-id]"),C=g.data("bp-activity-comment-id"),w=0;if(e.preventDefault(),void 0!==BP_Nouveau.confirm&&!1===window.confirm(BP_Nouveau.confirm))return!1;s.addClass("loading");var N={action:"delete_activity",id:r,_wpnonce:d.getLinkParams(s.prop("href"),"_wpnonce"),is_single:s.closest("[data-bp-single]").length};(s.hasClass("spam-activity")||s.hasClass("spam-activity-comment"))&&(N.action="bp_spam_activity"),h=n,C&&(delete N.is_single,N.id=C,N.is_comment=!0,h=g),d.ajax(N,"activity").done(function(e){if(s.removeClass("loading"),!1===e.success)h.prepend(e.data.feedback),h.find(".bp-feedback").hide().fadeIn(300);else{if(e.data.redirect)return window.location.href=e.data.redirect;if(C){if(w=1,n.append(g.find("form")),t.each(g.find("li"),function(){w+=1}),b=l.find("span.comments-count"),f=b.text().length?b.text().match(/\d+/)[0]:0,f=Number(f-w),p.length){var a=f>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;p.text(a.replace("%d",f))}(y=n.find("li.show-all a")).length&&y.html(BP_Nouveau.show_x_comments.replace("%d",f)),0===f&&(n.removeClass("has-comments"),l.removeClass("has-comments"),p.empty())}h.slideUp(300,function(){h.remove()}),C||n.data("bp-timestamp")!==d.Activity.heartbeat_data.last_recorded||(d.Activity.heartbeat_data.newest="",d.Activity.heartbeat_data.last_recorded=0),t(document).trigger("bp_activity_ajax_delete_request",t.extend(N,{response:e}))}})}if(s.closest("span").hasClass("activity-read-more")){var j=s.closest("div"),z=s.closest("span");if(a=null,t(j).hasClass("activity-inner")?a=r:t(j).hasClass("acomment-content")&&(a=s.closest("li").data("bp-activity-comment-id")),!a)return e;e.preventDefault(),t(z).addClass("loading"),d.ajax({action:"get_single_activity_content",id:a},"activity").done(function(e){"object"!=typeof e&&s.closest("div").find(".bb-activity-media-wrap").length>0&&(e=JSON.parse(e)),t(z).removeClass("loading"),j.parent().find(".bp-feedback").length&&j.parent().find(".bp-feedback").remove(),!1===e.success?(j.after(e.data.feedback),j.parent().find(".bp-feedback").hide().fadeIn(300)):(t(j).html(e.data.contents).slideDown(300),jQuery(window).scroll())})}if(s.hasClass("activity-state-comments")||s.hasClass("acomment-reply")||s.parent().hasClass("acomment-reply")){i=t("#ac-form-"+r);var P=t('[data-bp-activity-id="'+(a=r)+'"] .activity-comments');e.preventDefault(),s.parent().hasClass("acomment-reply")&&s.parent(),s.closest("li").data("bp-activity-comment-id")&&(a=s.closest("li").data("bp-activity-comment-id")),this.toggleMultiMediaOptions(i,s),i.removeClass("root"),t(".ac-form").hide(),t.each(i.children("div"),function(e,a){t(a).hasClass("error")&&t(a).remove()}),a===r?(P.append(i),i.addClass("root")):t('[data-bp-activity-comment-id="'+a+'"]').append(i),i.slideDown(200),s.attr("aria-expanded","true"),t.scrollTo(i,500,{offset:-100,easing:"swing"}),t("#ac-form-"+r+" #ac-input-"+r).focus(),_.isUndefined(BP_Nouveau.media)||_.isUndefined(BP_Nouveau.media.emoji)||void 0!==t("#ac-input-"+r).data("emojioneArea")||t("#ac-input-"+r).emojioneArea({standalone:!0,hideSource:!1,container:"#ac-reply-emoji-button-"+r,autocomplete:!1,pickerPosition:"bottom",hidePickerOnBlur:!0,useInternalCDN:!1,events:{emojibtn_click:function(){t("#ac-input-"+r)[0].emojioneArea.hidePicker()}}})}if(s.hasClass("ac-reply-cancel")&&(t(s).closest(".ac-form").slideUp(200),t(".acomment-reply").attr("aria-expanded","false"),m.destroyCommentMediaUploader(r),m.destroyCommentDocumentUploader(r),e.preventDefault()),"ac_form_submit"===s.prop("name")){var k,B;i=s.closest("form"),a=r,e.preventDefault(),s.closest("li").data("bp-activity-comment-id")&&(a=s.closest("li").data("bp-activity-comment-id")),(k=t(i).find(".ac-input").first()).find("img.emojioneemoji").replaceWith(function(){return this.dataset.emojiChar}),s.addClass("loading").prop("disabled",!0),k.addClass("loading").prop("disabled",!0);var x=k[0].innerHTML.replace(/<div>/gi,"\n").replace(/<\/div>/gi,"");B={action:"new_activity_comment",_wpnonce_new_activity_comment:t("#_wpnonce_new_activity_comment").val(),comment_id:a,form_id:r,content:x},t("#_bp_as_nonce_"+r).val()&&(B["_bp_as_nonce_"+r]=t("#_bp_as_nonce_"+r).val()),this.dropzone_media.length&&(B.media=this.dropzone_media,_.isEmpty(B.content)&&(B.content="&#8203;")),this.dropzone_document.length&&(B.document=this.dropzone_document,_.isEmpty(B.content)&&(B.content="&#8203;")),_.isUndefined(this.models[r])||(o=this.models[r],B.gif_data=this.models[r].get("gif_data"),_.isEmpty(B.content)&&(B.content="&#8203;")),d.ajax(B,"activity").done(function(e){if(s.removeClass("loading"),k.removeClass("loading"),t(".acomment-reply").attr("aria-expanded","false"),!1===e.success)i.append(t(e.data.feedback).hide().fadeIn(200));else{var a=i.parent(),d=t.trim(e.data.contents);if(i.fadeOut(200,function(){0===a.children("ul").length&&(a.hasClass("activity-comments")?a.prepend("<ul></ul>"):a.append("<ul></ul>")),a.children("ul").append(t(d).hide().fadeIn(200)),t(i).find(".ac-input").first().html(""),a.parent().addClass("has-comments"),a.parent().addClass("comments-loaded"),l.addClass("has-comments"),jQuery(window).scroll()}),b=l.find("span.comments-count"),f=b.text().length?b.text().match(/\d+/)[0]:0,f=Number(f)+1,p.length){var c=f>1?BP_Nouveau.activity.strings.commentsLabel:BP_Nouveau.activity.strings.commentLabel;p.text(c.replace("%d",f||1))}if((y=t(n).find(".show-all a"))&&y.html(BP_Nouveau.show_x_comments.replace("%d",f)),m.dropzone_media.length)for(var u=0;u<m.dropzone_media.length;u++)m.dropzone_media[u].saved=!0;if(m.dropzone_document.length)for(var v=0;v<m.dropzone_document.length;v++)m.dropzone_document[v].saved=!0}_.isUndefined(o)||(o.set("gif_data",{}),t("#ac-reply-post-gif-"+r).find(".activity-attached-gif-container").removeAttr("style")),m.destroyCommentMediaUploader(r),m.destroyCommentDocumentUploader(r),s.prop("disabled",!1),k.prop("disabled",!1)})}},commentFormAction:function(e){var a,i;return(e=e||window.event).target?a=e.target:e.srcElement&&(a=e.srcElement),3===a.nodeType&&(a=a.parentNode),!0===e.altKey||!0===e.metaKey?e:"TEXTAREA"===a.tagName&&t(a).hasClass("ac-input")?void(27===(i=e.keyCode?e.keyCode:e.which)&&!1===e.ctrlKey?"TEXTAREA"===a.tagName&&t(a).closest("form").slideUp(200):e.ctrlKey&&13===i&&t(a).val()&&t(a).closest("form").find("[type=submit]").first().trigger("click")):e},togglePopupDropdown:function(e){var a;return(e=e||window.event).target?a=e.target:e.srcElement&&(a=e.srcElement),3===a.nodeType&&(a=a.parentNode),!0===e.altKey||!0===e.metaKey?e:t(a).hasClass("privacy-wrap")||t(a).parent().hasClass("privacy-wrap")?e:void t("ul.activity-privacy").removeClass("bb-open")},loadMoreActivities:function(){var e=t(".load-more:visible").last(),a=t(window);if(e.closest(".activity-list").length&&e.get(0)&&!e.data("bp-autoloaded")){var i=e.offset().top-50;a.scrollTop()+a.height()>i&&(e.data("bp-autoloaded",1),e.find("a").text(BP_Nouveau.activity.strings.loadingMore),e.find("a").trigger("click"))}},destroyCommentMediaUploader:function(e){var a=this;_.isNull(a.dropzone_obj)||(a.dropzone_obj.destroy(),t("#ac-reply-post-media-uploader-"+e).html("")),a.dropzone_media=[],t("#ac-reply-post-media-uploader-"+e).removeClass("open").addClass("closed")},destroyCommentDocumentUploader:function(e){var a=this;_.isNull(a.dropzone_document_obj)||(a.dropzone_document_obj.destroy(),t("#ac-reply-post-document-uploader-"+e).html("")),a.dropzone_document=[],t("#ac-reply-post-document-uploader-"+e).removeClass("open").addClass("closed")},openCommentsMediaUploader:function(e){var a=this,i=t(e.currentTarget).closest(".ac-reply-content").find(".dropzone");e.preventDefault(),void 0!==window.Dropzone&&i.length&&(i.hasClass("closed")?(a.dropzone_obj=new Dropzone("#ac-reply-post-media-uploader-"+t(e.currentTarget).data("ac-id"),a.dropzone_options),a.dropzone_obj.on("sending",function(e,t,a){a.append("action","media_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media)}),a.dropzone_obj.on("success",function(e,i){i.data.id&&(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,i.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,i.data.saved=!1,a.dropzone_media.push(i.data))}),a.dropzone_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(i.data.feedback):a.dropzone_obj.removeFile(e)}),a.dropzone_obj.on("removedfile",function(e){if(a.dropzone_media.length)for(var t in a.dropzone_media)if(e.upload.uuid==a.dropzone_media[t].uuid){void 0===a.dropzone_media[t].saved||a.dropzone_media[t].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_media[t].id),a.dropzone_media.splice(t,1);break}}),i.removeClass("closed").addClass("open")):(a.dropzone_obj&&a.dropzone_obj.destroy(),a.dropzone_media=[],i.html(""),i.addClass("closed").removeClass("open")));var o=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentDocumentUploader(o);var d=t(e.currentTarget).data("ac-id");t("#ac-reply-gif-button-"+d).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open"),_.isUndefined(this.models[d])||(this.models[d].set("gif_data",{}),t("#ac-reply-post-gif-"+d).find(".activity-attached-gif-container").removeAttr("style"))},openCommentsDocumentUploader:function(e){var a=this,i=t(e.currentTarget).closest(".ac-reply-content").find(".dropzone");if(e.preventDefault(),void 0!==window.Dropzone&&i.length)if(i.hasClass("closed")){var o={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:BP_Nouveau.media.document_type,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2};a.dropzone_document_obj=new Dropzone("#ac-reply-post-document-uploader-"+t(e.currentTarget).data("ac-id"),o),a.dropzone_document_obj.on("sending",function(e,t,a){a.append("action","document_document_upload"),a.append("_wpnonce",BP_Nouveau.nonces.media)}),a.dropzone_document_obj.on("success",function(e,i){i.data.id&&(e.id=i.id,i.data.uuid=e.upload.uuid,i.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,i.data.album_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,i.data.group_id=void 0!==BP_Nouveau.media&&void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,i.data.saved=!1,a.dropzone_document.push(i.data))}),a.dropzone_document_obj.on("error",function(e,i){e.accepted?void 0!==i&&void 0!==i.data&&void 0!==i.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(i.data.feedback):a.dropzone_document_obj.removeFile(e)}),a.dropzone_document_obj.on("removedfile",function(e){if(a.dropzone_document.length)for(var t in a.dropzone_document)if(e.upload.uuid==a.dropzone_document[t].uuid){void 0===a.dropzone_document[t].saved||a.dropzone_document[t].saved||bp.Nouveau.Media.removeAttachment(a.dropzone_document[t].id),a.dropzone_document.splice(t,1);break}}),i.removeClass("closed").addClass("open")}else a.dropzone_document_obj&&a.dropzone_document_obj.destroy(),a.dropzone_document=[],i.html(""),i.addClass("closed").removeClass("open");var d=e.currentTarget.id.match(/\d+$/)[0];this.destroyCommentMediaUploader(d);var s=t(e.currentTarget).data("ac-id");t("#ac-reply-gif-button-"+s).closest(".post-gif").find(".gif-media-search-dropdown").removeClass("open"),_.isUndefined(this.models[s])||(this.models[s].set("gif_data",{}),t("#ac-reply-post-gif-"+s).find(".activity-attached-gif-container").removeAttr("style"))},openGifPicker:function(e){e.preventDefault();var a=e.currentTarget,i=t(a).next(),o=a.id.match(/\d+$/)[0],d=t("#ac-reply-post-gif-"+o);if(i.is(":empty")){var s=new bp.Models.ACReply,n=new bp.Views.GifMediaSearchDropdown({model:s}),r=new bp.Views.ActivityAttachedGifPreview({model:s});i.html(n.render().el),d.html(r.render().el),this.models[o]=s}i.toggleClass("open"),this.destroyCommentMediaUploader(o),this.destroyCommentDocumentUploader(o)},toggleMultiMediaOptions:function(e,t){_.isUndefined(BP_Nouveau.media)||(t.closest("li").hasClass("groups")?(!1===BP_Nouveau.media.group_media?e.find(".ac-reply-toolbar .post-media").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"),!1===BP_Nouveau.media.gif.groups?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.groups?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")):(!1===BP_Nouveau.media.profile_media?e.find(".ac-reply-toolbar .post-media").hide().parent(".ac-reply-toolbar").addClass("post-media-disabled"):e.find(".ac-reply-toolbar .post-media").show().parent(".ac-reply-toolbar").removeClass("post-media-disabled"),!1===BP_Nouveau.media.gif.profile?e.find(".ac-reply-toolbar .post-gif").hide().parent(".ac-reply-toolbar").addClass("post-gif-disabled"):e.find(".ac-reply-toolbar .post-gif").show().parent(".ac-reply-toolbar").removeClass("post-gif-disabled"),!1===BP_Nouveau.media.emoji.profile?e.find(".ac-reply-toolbar .post-emoji").hide().parent(".ac-reply-toolbar").addClass("post-emoji-disabled"):e.find(".ac-reply-toolbar .post-emoji").show().parent(".ac-reply-toolbar").removeClass("post-emoji-disabled")))}},bp.Nouveau.Activity.start())}(bp,jQuery);