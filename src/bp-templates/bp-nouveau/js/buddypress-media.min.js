window.bp=window.bp||{},function(e,i){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Media={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.current_page=1,this.current_page_existing_media=1,this.current_page_albums=1,this.current_tab=!i("body").hasClass("single-topic")&&!i("body").hasClass("single-forum")&&"bp-dropzone-content",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1),this.documentOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:BP_Nouveau.media.document_type,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},i("#bp-media-uploader").hasClass("bp-media-document-uploader")?this.options={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:BP_Nouveau.media.document_type,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2}:this.options={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},this.dropzone_obj=[],this.dropzone_media=[],this.album_id=void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,this.group_id=void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,this.bbp_is_reply_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_reply_edit&&window.BP_Forums_Nouveau.media.bbp_is_reply_edit,this.bbp_is_topic_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_topic_edit&&window.BP_Forums_Nouveau.media.bbp_is_topic_edit,this.bbp_is_forum_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_forum_edit&&window.BP_Forums_Nouveau.media.bbp_is_forum_edit,this.bbp_reply_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_media?window.BP_Forums_Nouveau.media.reply_edit_media:[],this.bbp_reply_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_document?window.BP_Forums_Nouveau.media.reply_edit_document:[],this.bbp_topic_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_media?window.BP_Forums_Nouveau.media.topic_edit_media:[],this.bbp_topic_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_document?window.BP_Forums_Nouveau.media.topic_edit_document:[],this.bbp_forum_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_media?window.BP_Forums_Nouveau.media.forum_edit_media:[],this.bbp_forum_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_document?window.BP_Forums_Nouveau.media.forum_edit_document:[],this.bbp_reply_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_gif_data?window.BP_Forums_Nouveau.media.reply_edit_gif_data:[],this.bbp_topic_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_gif_data?window.BP_Forums_Nouveau.media.topic_edit_gif_data:[],this.bbp_forum_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_gif_data?window.BP_Forums_Nouveau.media.forum_edit_gif_data:[],this.giphy=null,this.gif_offset=0,this.gif_q=null,this.gif_limit=20,this.gif_requests=[],this.gif_data=[],this.gif_container_key=!1},addListeners:function(){i(".bp-nouveau").on("click","#bp-add-media",this.openUploader.bind(this)),i(".bp-nouveau").on("click","#bp-add-document",this.openDocumentUploader.bind(this)),i(".bp-nouveau").on("click","#bp-media-submit",this.submitMedia.bind(this)),i(".bp-nouveau").on("click","#bp-media-document-submit",this.submitDocumentMedia.bind(this)),i(".bp-nouveau").on("click","#bp-media-uploader-close",this.closeUploader.bind(this)),i(".bp-nouveau").on("click","#bb-delete-media",this.deleteMedia.bind(this)),i(".bp-nouveau").on("click","#bb-select-deselect-all-media",this.toggleSelectAllMedia.bind(this)),i('#buddypress [data-bp-list="media"]').on("bp_ajax_request",this.bp_ajax_media_request),i(".bp-nouveau").on("click","#bb-create-album",this.openCreateAlbumModal.bind(this)),i(".bp-nouveau").on("click","#bb-create-folder",this.openCreateFolderModal.bind(this)),i(".bp-nouveau").on("click","#bb-create-folder-child",this.openCreateFolderChildModal.bind(this)),i(".bp-nouveau").on("click","#bp-edit-folder-open",this.openEditFolderChildModal.bind(this)),i(".bp-nouveau").on("click","#bp-media-create-album-submit",this.saveAlbum.bind(this)),i(".bp-nouveau").on("click","#bp-media-create-folder-submit",this.saveFolder.bind(this)),i(".bp-nouveau").on("click","#bp-media-create-child-folder-submit",this.saveChildFolder.bind(this)),i(".bp-nouveau").on("click","#bp-media-create-album-close",this.closeCreateAlbumModal.bind(this)),i(".bp-nouveau").on("click","#bp-media-create-folder-close",this.closeCreateFolderModal.bind(this)),i(".bp-nouveau").on("click","#bp-media-edit-folder-close",this.closeEditFolderModal.bind(this)),i(".bp-nouveau").on("click","#bp-media-add-more",this.triggerDropzoneSelectFileDialog.bind(this)),i(".bp-nouveau").on("click","#bp-media-document-add-more",this.triggerDropzoneSelectFileDialog.bind(this)),i("#bp-media-uploader").on("click",".bp-media-upload-tab",this.changeUploadModalTab.bind(this)),i('.bp-nouveau [data-bp-list="media"]').on("click","li.load-more",this.injectMedias.bind(this)),i(".bp-nouveau #albums-dir-list").on("click","li.load-more",this.appendAlbums.bind(this)),i(".bp-existing-media-wrap").on("click","li.load-more",this.appendMedia.bind(this)),i(".bp-nouveau").on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.addSelectedClassToWrapper.bind(this)),i(".bp-existing-media-wrap").on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.toggleSubmitMediaButton.bind(this)),i(".bp-nouveau").on("click","#bp-edit-album-title",this.editAlbumTitle.bind(this)),i(".bp-nouveau").on("click","#bp-edit-folder-title",this.editFolderTitle.bind(this)),i(".bp-nouveau").on("click","#bp-cancel-edit-album-title",this.cancelEditAlbumTitle.bind(this)),i(".bp-nouveau").on("click","#bp-save-album-title",this.saveAlbum.bind(this)),i(".bp-nouveau").on("click","#bp-save-folder-title",this.saveFolder.bind(this)),i(".bp-nouveau").on("change","#bp-media-single-album select#bb-album-privacy",this.saveAlbum.bind(this)),i(".bp-nouveau").on("change","#bp-media-single-folder select#bb-folder-privacy",this.saveFolder.bind(this)),i(".bp-nouveau").on("click","#bb-delete-album",this.deleteAlbum.bind(this)),i(".bp-nouveau").on("click","#bb-delete-folder",this.deleteFolder.bind(this)),i(document).on("click","#forums-media-button",this.openForumsUploader.bind(this)),i(document).on("click","#forums-document-button",this.openForumsDocumentUploader.bind(this)),i(document).on("click","#forums-gif-button",this.toggleGifSelector.bind(this)),i(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("keyup",".search-query-input",this.searchGif.bind(this)),i(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),i(document).find("form #whats-new-toolbar .gif-search-results, .forum form #whats-new-toolbar .gif-search-results").scroll(this.loadMoreGif.bind(this)),i(document).find("form #whats-new-attachments .forums-attached-gif-container, .forum form #whats-new-attachments .forums-attached-gif-container").on("click",".gif-image-remove",this.removeSelectedGif.bind(this)),i(document).on("click",".gif-image-container",this.playVideo.bind(this)),i(document).on("click",".bb-media-container .media-folder_action__anchor, .bb-media-container  .media-folder_action__list li a",this.fileActionButton.bind(this)),i(document).on("click",".bb-activity-media-elem.document-activity .document-action-wrap .document-action_more, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_list li a",this.fileActivityActionButton.bind(this)),i(document).click(this.toggleFileActivityActionButton),i(document).on("click",".bb-activity-media-elem.document-activity .document-expand .document-expand-anchor",this.expandCodePreview.bind(this)),i(document).on("click",".bb-activity-media-elem.document-activity .document-action-wrap .document-action_collapse",this.collapseCodePreview.bind(this)),i(document).on("click",".activity .bp-document-move-activity, #media-stream .bp-document-move-activity",this.moveDocumentIntoFolder.bind(this)),i(document).on("click",'.bp-nouveau [data-bp-list="document"] .pager .dt-more-container.load-more',this.injectDocuments.bind(this)),i(document).on("click",'.bp-nouveau [data-bp-list="document"] .data-head',this.sortDocuments.bind(this)),i(document).on("click",".modal-container .bb-field-steps-actions",this.createFolderNavigate.bind(this)),i(document).on("click",".modal-container .bb-field-uploader-actions",this.uploadDocumentNavigate.bind(this)),_.isUndefined(BP_Nouveau.media.gif_api_key)||(window.addEventListener("scroll",this.autoPlayGifVideos,!1),window.addEventListener("resize",this.autoPlayGifVideos,!1)),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&i("#forums-media-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&i("#forums-document-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(Object.keys(this.bbp_reply_edit_gif_data).length||Object.keys(this.bbp_topic_edit_gif_data).length||Object.keys(this.bbp_forum_edit_gif_data).length)&&this.editGifPreview()},bp_ajax_media_request:function(e,t){void 0!==t&&void 0!==t.response.scopes.personal&&0===t.response.scopes.personal&&i(".bb-photos-actions").hide()},addSelectedClassToWrapper:function(e){var t=e.currentTarget;i(t).is(":checked")?(i(t).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),i(t).closest(".bb-photo-thumb").addClass("selected")):(i(t).closest(".bb-photo-thumb").removeClass("selected"),i(t).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select),i(".bp-nouveau #bb-select-deselect-all-media").hasClass("selected")&&i(".bp-nouveau #bb-select-deselect-all-media").removeClass("selected"))},moveDocumentIntoFolder:function(e){var t=i(e.currentTarget);e.preventDefault();var a=t.attr("id"),o=t.closest(".bp-media-move-file").find(".bb-folder-selected-id").val();if(""===a||""===o)return t.closest(".modal-container").find(".location-folder-list").addClass("has-error"),!1;t.closest(".modal-container").find(".location-folder-list").removeClass("has-error"),t.addClass("loading");var d={action:"document_folder_move",_wpnonce:BP_Nouveau.nonces.media,document_id:a,folder_id:o};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,success:function(e){e.success&&t.closest(".bp-media-move-file").find(".ac-document-close-button").trigger("click")}})},deleteMedia:function(e){var t=i(e.currentTarget);e.preventDefault();var a=[];if(i("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){i(this).closest(".bb-photo-thumb").addClass("loading deleting"),a.push(i(this).val())}),0==a.length)return!1;t.prop("disabled",!0),i("#buddypress .media-list .bp-feedback").remove();var o={action:"media_delete",_wpnonce:BP_Nouveau.nonces.media,media:a};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(e){if(setTimeout(function(){t.prop("disabled",!1)},500),e.success){if(i("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){i(this).closest("li").remove()}),0==i("#buddypress").find(".media-list:not(.existing-media-list)").find("li:not(.load-more)").length){i(".bb-photos-actions").hide();var a='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.media.i18n_strings.no_photos_found+"</p>\n\t</aside>";i('#buddypress [data-bp-list="media"]').html(a)}}else i("#buddypress .media-list").prepend(e.data.feedback)}})},toggleSelectAllMedia:function(e){e.preventDefault(),i(e.currentTarget).hasClass("selected")?(i(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllMedia(e)):(i(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllMedia(e)),i(e.currentTarget).toggleClass("selected")},selectAllMedia:function(e){e.preventDefault(),i("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){i(this).prop("checked",!0),i(this).closest(".bb-photo-thumb").addClass("selected"),i(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllMedia:function(e){e.preventDefault(),i("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){i(this).prop("checked",!1),i(this).closest(".bb-photo-thumb").removeClass("selected"),i(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},editAlbumTitle:function(e){e.preventDefault(),i("#bb-album-title").show(),i("#bp-save-album-title").show(),i("#bp-cancel-edit-album-title").show(),i("#bp-edit-album-title").hide(),i("#bp-media-single-album #bp-single-album-title").hide()},editFolderTitle:function(e){e.preventDefault(),i("#bb-album-title").show(),i("#bp-save-folder-title").show(),i("#bp-cancel-edit-album-title").show(),i("#bp-edit-folder-title").hide(),i("#bp-media-single-album #bp-single-album-title").hide()},cancelEditAlbumTitle:function(e){e.preventDefault(),i("#bb-album-title").hide(),i("#bp-save-album-title,#bp-save-folder-title").hide(),i("#bp-cancel-edit-album-title").hide(),i("#bp-edit-album-title,#bp-edit-folder-title").show(),i("#bp-media-single-album #bp-single-album-title").show()},triggerDropzoneSelectFileDialog:function(){this.dropzone_obj.hiddenFileInput.click()},closeUploader:function(e){e.preventDefault(),i("#bp-media-uploader").hide(),i("#bp-media-add-more").hide(),i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload),i("#bp-media-uploader-modal-status-text").text(""),this.dropzone_obj.destroy(),this.dropzone_media=[];var t=i(e.currentTarget).closest("#bp-media-uploader");t.find(".bb-field-steps").length&&(t.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),t.find("#bp-media-document-prev, #bp-media-document-submit").hide()),this.clearFolderLocationUI(e)},loadMoreGif:function(e){var t=e.target,a=this,o=i(e.target).closest("form").find(".forums-attached-gif-container"),d=o.data("key");if(a.gif_container_key=d,t.scrollTop+t.offsetHeight>=t.scrollHeight&&!o.hasClass("loading")&&a.gif_data[d].total_count>0&&a.gif_data[d].offset<=a.gif_data[d].total_count){var n={offset:a.gif_data[d].offset,fmt:"json",limit:a.gif_data[d].limit};o.addClass("loading");var s=null;s=_.isNull(a.gif_data[d].q)?a.giphy.trending(n,_.bind(a.loadMoreGifResponse,a)):a.giphy.search(_.extend({q:a.gif_data[d].q},n),_.bind(a.loadMoreGifResponse,a)),a.gif_data[d].requests.push(s),a.gif_data[d].offset=a.gif_data[d].offset+a.gif_data[d].limit}},loadMoreGifResponse:function(e){var t=this,a=0;if(i('div.forums-attached-gif-container[data-key="'+t.gif_container_key+'"]').removeClass("loading"),void 0!==e.data&&e.data.length){var o="";for(a=0;a<e.data.length;a++)o+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[a].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[a].images.original.url+'" data-id="'+e.data[a].id+'">\n\t\t<img src="'+e.data[a].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[a].saved=!1,t.gif_data[t.gif_container_key].data.push(e.data[a]);i('div.forums-attached-gif-container[data-key="'+t.gif_container_key+'"]').closest("form").find(".gif-search-results-list").append(o)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(t.gif_data[t.gif_container_key].total_count=e.pagination.total_count)},editGifPreview:function(){var e=this,t={};if(e.bbp_is_reply_edit&&Object.keys(e.bbp_reply_edit_gif_data).length?t=e.bbp_reply_edit_gif_data.gif_raw_data:e.bbp_is_topic_edit&&Object.keys(e.bbp_topic_edit_gif_data).length?t=e.bbp_topic_edit_gif_data.gif_raw_data:e.bbp_is_forum_edit&&Object.keys(e.bbp_forum_edit_gif_data).length&&(t=e.bbp_forum_edit_gif_data.gif_raw_data),void 0===t.images)return!1;i("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+t.images.fixed_width.url+")",i("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",i("#whats-new-attachments .forums-attached-gif-container")[0].style.height=t.images.original.height+"px",i("#whats-new-attachments .forums-attached-gif-container")[0].style.width=t.images.original.width+"px",i("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",t.images.original.url),i("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),i("#bbp_media_gif").length&&i("#bbp_media_gif").val(JSON.stringify(t))},selectGif:function(e){var t=this,a=0,o=i(e.currentTarget),d=o.closest("form").find(".forums-attached-gif-container");e.preventDefault(),d.closest("form").find(".gif-media-search-dropdown").removeClass("open");var n=d.data("key");if(void 0!==t.gif_data[n]&&void 0!==t.gif_data[n].data&&t.gif_data[n].data.length)for(a=0;a<t.gif_data[n].data.length;a++)if(t.gif_data[n].data[a].id==e.currentTarget.dataset.id){o.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+t.gif_data[n].data[a].images.fixed_width.url+")",o.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",o.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.height=t.gif_data[n].data[a].images.original.height+"px",o.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.width=t.gif_data[n].data[a].images.original.width+"px",o.closest("form").find("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",t.gif_data[n].data[a].images.original.url),o.closest("form").find("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),o.closest("form").find("#bbp_media_gif").length&&o.closest("form").find("#bbp_media_gif").val(JSON.stringify(t.gif_data[n].data[a]));break}},removeSelectedGif:function(e){e.preventDefault(),this.resetForumsGifComponent(e)},resetForumsGifComponent:function(e){var t=i(e.target);t.closest("form").find(".gif-media-search-dropdown").removeClass("open"),t.closest("form").find("#whats-new-toolbar #forums-gif-button").removeClass("active");var a=t.closest("form").find("#whats-new-attachments .forums-attached-gif-container");a&&(a.addClass("closed"),a.find(".gif-image-container img").attr("src",""),a[0].style=""),t.closest("form").find("#bbp_media_gif").length&&t.closest("form").find("#bbp_media_gif").val("")},searchGif:function(e){var i=this;null!=i.gif_timeout&&clearTimeout(this.gif_timeout),i.gif_timeout=setTimeout(function(){i.gif_timeout=null,i.searchGifRequest(e,e.target.value)},1e3)},searchGifRequest:function(e){var t=this,a=0,o=i(e.target).closest("form").find(".forums-attached-gif-container");o.addClass("loading");var d=o.data("key");t.clearGifRequests(d),t.gif_data[d].q=e.target.value,t.gif_data[d].offset=0;var n=t.giphy.search({q:t.gif_data[d].q,offset:t.gif_data[d].offset,fmt:"json",limit:t.gif_data[d].limit},function(n){if(void 0!==n.data&&n.data.length){var s="";for(a=0;a<n.data.length;a++)s+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+n.data[a].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+n.data[a].images.original.url+'" data-id="'+n.data[a].id+'">\n\t\t<img src="'+n.data[a].images.fixed_width.url+'">\n\t</a>\n</li>',n.data[a].saved=!1,t.gif_data[d].data.push(n.data[a]);i(e.target).closest(".gif-search-content").find(".gif-search-results-list").append(s)}void 0!==n.pagination&&void 0!==n.pagination.total_count&&(t.gif_data[d].total_count=n.pagination.total_count),o.removeClass("loading")});t.gif_data[d].requests.push(n),t.gif_data[d].offset=t.gif_data[d].offset+t.gif_data[d].limit},clearGifRequests:function(e){var t=this;if(void 0!==t.gif_data[e]&&void 0!==t.gif_data[e].requests){for(var a=0;a<t.gif_data[e].requests.length;a++)t.gif_data[e].requests[a].abort();i('[data-key="'+e+'"]').closest("form").find(".gif-search-results-list li").remove(),t.gif_data[e].requests=[],t.gif_data[e].data=[],t.gif_data.splice(e,1)}},toggleGifSelector:function(e){var t=this,a=i(e.currentTarget),o=a.closest("form").find(".gif-media-search-dropdown"),d=0;if(e.preventDefault(),void 0!==window.Giphy&&void 0!==BP_Nouveau.media.gif_api_key){t.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key);var n=a.closest("form").find(".forums-attached-gif-container");n.addClass("loading");var s=n.data("key");t.clearGifRequests(s),t.gif_data[s]={q:null,offset:0,limit:20,requests:[],total_count:0,data:[]};var r=t.giphy.trending({offset:t.gif_data[s].offset,fmt:"json",limit:t.gif_data[s].limit},function(e){if(void 0!==e.data&&e.data.length){var i="";for(d=0;d<e.data.length;d++)i+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[d].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[d].images.original.url+'" data-id="'+e.data[d].id+'">\n\t\t<img src="'+e.data[d].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[d].saved=!1,t.gif_data[s].data.push(e.data[d]);a.closest("form").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(t.gif_data[s].total_count=e.pagination.total_count),n.removeClass("loading")});t.gif_data[s].requests.push(r),t.gif_data[s].offset=t.gif_data[s].offset+t.gif_data[s].limit}o.toggleClass("open"),a.toggleClass("active");var l=a.closest("form").find("#forums-post-media-uploader");l.length&&t.resetForumsMediaComponent(l.data("key"))},resetForumsMediaComponent:function(e){var t=this;void 0!==e&&(void 0!==t.dropzone_obj[e]&&(t.dropzone_obj[e].destroy(),t.dropzone_obj.splice(e,1),t.dropzone_media.splice(e,1)),i('div#forums-post-media-uploader[data-key="'+e+'"]').html(""),i('div#forums-post-media-uploader[data-key="'+e+'"]').addClass("closed").removeClass("open"))},resetForumsDocumentComponent:function(e){var t=this;void 0!==e&&(void 0!==t.dropzone_obj[e]&&(t.dropzone_obj[e].destroy(),t.dropzone_obj.splice(e,1),t.dropzone_media.splice(e,1)),i('div#forums-post-document-uploader[data-key="'+e+'"]').html(""),i('div#forums-post-document-uploader[data-key="'+e+'"]').addClass("closed").removeClass("open"))},openForumsUploader:function(e){var t=this,a=i(e.currentTarget).closest("form").find("#forums-post-media-uploader"),o=[];if(e.preventDefault(),void 0!==window.Dropzone&&a.length){var d=a.data("key");if(a.hasClass("closed")){if(t.dropzone_obj[d]=new Dropzone(a[0],t.options),t.dropzone_media[d]=[],t.dropzone_obj[d].on("sending",function(e,i,t){t.append("action","media_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),t.dropzone_obj[d].on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&i(e.previewElement).find(".dz-error-message span").text(a.data.feedback):t.dropzone_obj[d].removeFile(e)}),t.dropzone_obj[d].on("success",function(e,o){o.data.id&&(e.id=o.id,o.data.uuid=e.upload.uuid,o.data.menu_order=i(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,o.data.album_id=t.album_id,o.data.group_id=t.group_id,o.data.saved=!1,t.dropzone_media[d].push(o.data),t.addMediaIdsToForumsForm(a))}),t.dropzone_obj[d].on("removedfile",function(e){if(t.dropzone_media[d].length)for(var i in t.dropzone_media[d])if(e.upload.uuid==t.dropzone_media[d][i].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===t.dropzone_media[d][i].saved||t.dropzone_media[d][i].saved||t.removeAttachment(t.dropzone_media[d][i].id),t.dropzone_media[d].splice(i,1),t.addMediaIdsToForumsForm(a);break}}),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&(this.bbp_reply_edit_media.length?o=this.bbp_reply_edit_media:this.bbp_topic_edit_media.length?o=this.bbp_topic_edit_media:this.bbp_forum_edit_media.length&&(o=this.bbp_forum_edit_media),o.length)){for(var n=!1,s=0;s<o.length;s++)n=!1,t.dropzone_media[d].push({id:o[s].attachment_id,media_id:o[s].id,name:o[s].title,thumb:o[s].thumb,url:o[s].full,uuid:o[s].id,menu_order:s,saved:!0}),n={name:o[s].title,accepted:!0,kind:"image",upload:{filename:o[s].title,uuid:o[s].id},dataURL:o[s].url,id:o[s].id},t.dropzone_obj[d].files.push(n),t.dropzone_obj[d].emit("addedfile",n),t.createThumbnailFromUrl(n,a);t.addMediaIdsToForumsForm(a)}a.removeClass("closed").addClass("open"),t.resetForumsGifComponent(e)}else t.resetForumsMediaComponent(d)}},openForumsDocumentUploader:function(e){var t=this,a=i(e.currentTarget).closest("form").find("#forums-post-document-uploader"),o=[];if(e.preventDefault(),void 0!==window.Dropzone&&a.length){var d=a.data("key");if(a.hasClass("closed")){if(t.dropzone_obj[d]=new Dropzone(a[0],t.documentOptions),t.dropzone_media[d]=[],t.dropzone_obj[d].on("sending",function(e,i,t){t.append("action","document_document_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),t.dropzone_obj[d].on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&i(e.previewElement).find(".dz-error-message span").text(a.data.feedback):t.dropzone_obj[d].removeFile(e)}),t.dropzone_obj[d].on("success",function(e,o){o.data.id&&(e.id=o.id,o.data.uuid=e.upload.uuid,o.data.menu_order=i(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,o.data.album_id=t.album_id,o.data.group_id=t.group_id,o.data.saved=!1,t.dropzone_media[d].push(o.data),t.addDocumentIdsToForumsForm(a))}),t.dropzone_obj[d].on("removedfile",function(e){if(t.dropzone_media[d].length)for(var i in t.dropzone_media[d])if(e.upload.uuid==t.dropzone_media[d][i].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===t.dropzone_media[d][i].saved||t.dropzone_media[d][i].saved||t.removeAttachment(t.dropzone_media[d][i].id),t.dropzone_media[d].splice(i,1),t.addDocumentIdsToForumsForm(a);break}}),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&(this.bbp_reply_edit_document.length?o=this.bbp_reply_edit_document:this.bbp_topic_edit_document.length?o=this.bbp_topic_edit_document:this.bbp_forum_edit_document.length&&(o=this.bbp_forum_edit_document),o.length)){for(var n=!1,s=0;s<o.length;s++)n=!1,t.dropzone_media[d].push({id:o[s].attachment_id,media_id:o[s].id,name:o[s].name,title:o[s].name,size:o[s].size,url:o[s].url,uuid:o[s].id,menu_order:s,saved:!0}),n={name:o[s].name,size:o[s].size,accepted:!0,kind:"document",upload:{name:o[s].name,title:o[s].name,size:o[s].size,uuid:o[s].id},dataURL:o[s].url,id:o[s].id},t.dropzone_obj[d].files.push(n),t.dropzone_obj[d].emit("addedfile",n),t.dropzone_obj[d].emit("complete",n);t.addDocumentIdsToForumsForm(a)}a.removeClass("closed").addClass("open"),t.resetForumsGifComponent(e)}else t.resetForumsDocumentComponent(d)}},addMediaIdsToForumsForm:function(e){var i=this,t=e.data("key");e.closest("#whats-new-attachments").find("#bbp_media").length&&e.closest("#whats-new-attachments").find("#bbp_media").val(JSON.stringify(i.dropzone_media[t]))},addDocumentIdsToForumsForm:function(e){var i=this,t=e.data("key");e.closest("#whats-new-attachments").find("#bbp_document").length&&e.closest("#whats-new-attachments").find("#bbp_document").val(JSON.stringify(i.dropzone_media[t]))},createThumbnailFromUrl:function(e,i){var t=this,a=i.data("key");t.dropzone_obj[a].createThumbnailFromUrl(e,t.dropzone_obj[a].options.thumbnailWidth,t.dropzone_obj[a].options.thumbnailHeight,t.dropzone_obj[a].options.thumbnailMethod,!0,function(i){t.dropzone_obj[a].emit("thumbnail",e,i),t.dropzone_obj[a].emit("complete",e)})},openUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&i("div#media-uploader").length&&(i("#bp-media-uploader").show(),t.dropzone_obj=new Dropzone("div#media-uploader",t.options),t.dropzone_obj.on("sending",function(e,i,t){t.append("action","media_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),t.dropzone_obj.on("addedfile",function(){setTimeout(function(){t.dropzone_obj.getAcceptedFiles().length&&i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&i(e.previewElement).find(".dz-error-message span").text(a.data.feedback):t.dropzone_obj.removeFile(e)}),t.dropzone_obj.on("queuecomplete",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),t.dropzone_obj.on("processing",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),t.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=t.dropzone_media.length,a.data.album_id=t.album_id,a.data.group_id=t.group_id,a.data.saved=!1,t.dropzone_media.push(a.data)),i("#bp-media-add-more").show(),i("#bp-media-submit").show(),i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()}),t.dropzone_obj.on("removedfile",function(e){if(t.dropzone_media.length)for(var a in t.dropzone_media)if(e.upload.uuid==t.dropzone_media[a].uuid){void 0===t.dropzone_media[a].saved||t.dropzone_media[a].saved||t.removeAttachment(t.dropzone_media[a].id),t.dropzone_media.splice(a,1);break}t.dropzone_obj.getAcceptedFiles().length?i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show():(i("#bp-media-uploader-modal-status-text").text(""),i("#bp-media-add-more").hide(),i("#bp-media-submit").hide())}))},openDocumentUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&i("div#media-uploader").length&&(i("#bp-media-uploader").hasClass("bp-media-document-uploader")&&this.folderLocationUI("#bp-media-uploader"),i("#bp-media-uploader").show(),t.dropzone_obj=new Dropzone("div#media-uploader",t.options),t.dropzone_obj.on("sending",function(e,i,t){t.append("action","document_document_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),t.dropzone_obj.on("addedfile",function(){setTimeout(function(){t.dropzone_obj.getAcceptedFiles().length&&i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&i(e.previewElement).find(".dz-error-message span").text(a.data.feedback):t.dropzone_obj.removeFile(e)}),t.dropzone_obj.on("queuecomplete",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),t.dropzone_obj.on("processing",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),t.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=t.dropzone_media.length,a.data.folder_id=t.album_id,a.data.group_id=t.group_id,a.data.saved=!1,t.dropzone_media.push(a.data)),i("#bp-media-document-add-more").show(),i("#bp-media-document-next").show(),i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()}),t.dropzone_obj.on("removedfile",function(e){if(t.dropzone_media.length)for(var a in t.dropzone_media)if(e.upload.uuid==t.dropzone_media[a].uuid){void 0===t.dropzone_media[a].saved||t.dropzone_media[a].saved||t.removeAttachment(t.dropzone_media[a].id),t.dropzone_media.splice(a,1);break}t.dropzone_obj.getAcceptedFiles().length?i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show():(i("#bp-media-uploader-modal-status-text").text(""),i("#bp-media-document-add-more").hide(),i("#bp-media-document-next").hide())}))},openDocumentFolderUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&i("div#bp-media-create-folder").length&&(i("#bp-media-create-folder").show(),t.dropzone_obj=new Dropzone("div#media-uploader-folder",t.options),t.dropzone_obj.on("sending",function(e,i,t){t.append("action","document_document_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),t.dropzone_obj.on("addedfile",function(){setTimeout(function(){t.dropzone_obj.getAcceptedFiles().length&&i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&i(e.previewElement).find(".dz-error-message span").text(a.data.feedback):t.dropzone_obj.removeFile(e)}),t.dropzone_obj.on("queuecomplete",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),t.dropzone_obj.on("processing",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),t.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=t.dropzone_media.length,a.data.folder_id=t.album_id,a.data.group_id=t.group_id,a.data.saved=!1,t.dropzone_media.push(a.data)),i("#bp-media-document-add-more").show(),i("#bp-media-document-submit").show(),i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()}),t.dropzone_obj.on("removedfile",function(e){if(t.dropzone_media.length)for(var a in t.dropzone_media)if(e.upload.uuid==t.dropzone_media[a].uuid){void 0===t.dropzone_media[a].saved||t.dropzone_media[a].saved||t.removeAttachment(t.dropzone_media[a].id),t.dropzone_media.splice(a,1);break}t.dropzone_obj.getAcceptedFiles().length?i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show():(i("#bp-media-uploader-modal-status-text").text(""),i("#bp-media-document-add-more").hide(),i("#bp-media-document-submit").hide())}))},openDocumentFolderChildUploader:function(e){var t=this;e.preventDefault(),void 0!==window.Dropzone&&i("div#bp-media-create-child-folder").length&&(i("#bp-media-create-child-folder").show(),t.dropzone_obj=new Dropzone("div#media-uploader-child-folder",t.options),t.dropzone_obj.on("sending",function(e,i,t){t.append("action","document_document_upload"),t.append("_wpnonce",BP_Nouveau.nonces.media)}),t.dropzone_obj.on("addedfile",function(){setTimeout(function(){t.dropzone_obj.getAcceptedFiles().length&&i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),t.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&i(e.previewElement).find(".dz-error-message span").text(a.data.feedback):t.dropzone_obj.removeFile(e)}),t.dropzone_obj.on("queuecomplete",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),t.dropzone_obj.on("processing",function(){i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),t.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=t.dropzone_media.length,a.data.folder_id=t.album_id,a.data.group_id=t.group_id,a.data.saved=!1,t.dropzone_media.push(a.data)),i("#bp-media-document-add-more").show(),i("#bp-media-document-submit").show(),i("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show()}),t.dropzone_obj.on("removedfile",function(e){if(t.dropzone_media.length)for(var a in t.dropzone_media)if(e.upload.uuid==t.dropzone_media[a].uuid){void 0===t.dropzone_media[a].saved||t.dropzone_media[a].saved||t.removeAttachment(t.dropzone_media[a].id),t.dropzone_media.splice(a,1);break}t.dropzone_obj.getAcceptedFiles().length?i("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,t.dropzone_media.length,t.dropzone_obj.getAcceptedFiles().length)).show():(i("#bp-media-uploader-modal-status-text").text(""),i("#bp-media-document-add-more").hide(),i("#bp-media-document-submit").hide())}))},removeAttachment:function(e){var t={action:"media_delete_attachment",_wpnonce:BP_Nouveau.nonces.media,id:e};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t})},changeUploadModalTab:function(e){e.preventDefault();var t=i(e.currentTarget).data("content");i(".bp-media-upload-tab-content").hide(),i("#"+t).show(),this.current_tab=t,i(e.currentTarget).closest("#bp-media-uploader").find(".bp-media-upload-tab").removeClass("selected"),i(e.currentTarget).addClass("selected"),this.toggleSubmitMediaButton(),jQuery(window).scroll()},openCreateAlbumModal:function(e){e.preventDefault(),this.openUploader(e),i("#bp-media-create-album").show()},openCreateFolderModal:function(e){e.preventDefault(),this.openDocumentFolderUploader(e),this.folderLocationUI("#bp-media-create-folder"),i("#bp-media-create-folder").show()},openCreateFolderChildModal:function(e){e.preventDefault(),this.openDocumentFolderChildUploader(e),this.folderLocationUI("#bp-media-create-child-folder"),i("#bp-media-create-child-folder").show()},openEditFolderChildModal:function(e){e.preventDefault(),this.folderLocationUI("#bp-media-edit-child-folder"),i("#bp-media-edit-child-folder").show()},folderLocationUI:function(e){i(e).find(".bb-folder-destination").length>0&&(i(e).find(".location-folder-list-wrap").hasClass("is_loaded")||(i(document).on("click",e+" .bb-folder-destination",function(){i(this).parent().find(".location-folder-list-wrap").slideToggle()}),i(e).find(".location-folder-list-wrap").addClass("is_loaded"),i(e).find(".location-folder-list li").each(function(){i(this).children("ul").parent().addClass("has-ul").append('<i class="bb-icon-angle-right sub-menu-anchor"></i>')}),i(document).on("click",e+" .location-folder-list li i",function(){i(this).closest(".location-folder-list-wrap").find(".location-folder-title").text(i(this).siblings("span").text()).siblings(".location-folder-back").css("display","inline-block"),i(this).siblings("ul").show().siblings("span, i").hide().parent().siblings().hide(),i(this).closest(".is_active").removeClass("is_active"),i(this).parent().addClass("is_active")}),i(document).on("click",e+" .location-folder-back",function(){i(this).siblings(".location-folder-list").find("li.is_active").parent().hasClass("location-folder-list")?(i(this).siblings(".location-folder-list").find("li.is_active").find("ul").hide().siblings("span, i").show().parent().removeClass("is_active").siblings().show(),i(this).siblings(".location-folder-title").text("Documents"),i(this).hide()):(i(this).siblings(".location-folder-list").find("li.is_active").find("ul").hide().siblings("span, i").show().parent().removeClass("is_active").addClass("is_active_old").parent().parent().closest(".has-ul").addClass("is_active"),i(this).siblings(".location-folder-list").find("li.is_active_old").siblings().show(),i(this).siblings(".location-folder-list").find("li.is_active.is_active_old").removeClass("is_active is_active_old"),i(this).siblings(".location-folder-title").text(i(this).parent().find("li.is_active>span").text())),i(this).closest(".has-folderlocationUI").find(".ac_document_search_folder").val("").trigger("change")}),i(document).on("click",e+" .location-folder-list li span",function(){i(this).hasClass("selected")?(i(this).removeClass("selected"),i(this).closest(".has-folderlocationUI").find(".bb-model-header h4 span.target_folder").text("..."),i(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(""),i(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val("")):(i(this).closest(".location-folder-list-wrap-main").find(".location-folder-list li span").removeClass("selected"),i(this).addClass("selected"),i(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(i(this).text()),i(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val(i(this).parent().attr("data-id")),i(this).closest(".has-folderlocationUI").find(".bb-model-header h4 span.target_folder").text(" "+i(this).text()))}),i(document).on("keyup change",e+" .ac_document_search_folder",function(){var e=i(this).val();if(""==e)i(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap .location-folder-list").show().parent().siblings(".ac_document_search_folder_list").hide();else{i(this).closest(".has-folderlocationUI").find(".ac_document_search_folder_list ul").html(" ");var t="";i(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap ul.location-folder-list li.is_active").length>0&&(t=".is_active li"),i(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap ul.location-folder-list li"+t).each(function(){i(this).children("span").text().search(new RegExp(e,"i"))>=0&&i(this).closest(".has-folderlocationUI").find(".ac_document_search_folder_list ul").append('<li data-id="'+i(this).attr("data-id")+'"><span>'+i(this).children("span").text()+"</span></li>")}),i(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap .location-folder-list").hide().parent().siblings(".ac_document_search_folder_list").show(),e=""}})))},clearFolderLocationUI:function(e){var i=jQuery(e.currentTarget).closest(".has-folderlocationUI");i.length>0&&(i.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected").removeClass("selected"),jQuery(this).find("ul").hide()}),i.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").show().children("span, i").show(),i.find(".location-folder-title").text("Documents"),i.find(".location-folder-back").hide().closest(".has-folderlocationUI").find(".bb-folder-selected-id").val(""),i.find(".ac_document_search_folder").val(""),i.find(".bb-model-header h4 span").text("..."),i.find(".ac_document_search_folder_list ul").html("").parent().hide().siblings(".location-folder-list-wrap").find(".location-folder-list").show())},closeCreateAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),i("#bp-media-create-album").hide(),i("#bb-album-title").val("")},closeCreateFolderModal:function(e){e.preventDefault(),this.closeUploader(e),i("#bp-media-create-folder, #bp-media-create-child-folder").hide(),i("#bb-album-title, #bb-album-child-title").val(""),i("#bp-media-create-folder .bb-folder-selected-id").val(""),i("#bp-media-create-folder .bb-field-steps-1, #bp-media-create-child-folder .bb-field-steps-1").show().siblings(".bb-field-steps").hide()},closeEditFolderModal:function(e){e.preventDefault(),i("#bp-media-edit-child-folder").hide(),this.clearFolderLocationUI(e)},submitMedia:function(e){var t,a=this,o=i(e.currentTarget),d=i("#bb-media-privacy");if(e.preventDefault(),o.hasClass("saving"))return!1;if(o.addClass("saving"),"bp-dropzone-content"===a.current_tab){var n=i("#bp-media-post-content").val();t={action:"media_save",_wpnonce:BP_Nouveau.nonces.media,medias:a.dropzone_media,content:n,album_id:a.album_id,group_id:a.group_id,privacy:d.val()},i("#bp-dropzone-content .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){if(t.success){i("#media-stream ul.media-list").length||(i("#media-stream").html(i("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),i(".bb-photos-actions").show()),bp.Nouveau.inject("#media-stream ul.media-list",t.data.media,"prepend");for(var d=0;d<a.dropzone_media.length;d++)a.dropzone_media[d].saved=!0;a.closeUploader(e),jQuery(window).scroll()}else i("#bp-dropzone-content").prepend(t.data.feedback);o.removeClass("saving")}})}else if("bp-existing-media-content"===a.current_tab){var s=[];i('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){s.push(i(this).val())}),t={action:"media_move_to_album",_wpnonce:BP_Nouveau.nonces.media,medias:s,album_id:a.album_id,group_id:a.group_id},i("#bp-existing-media-content .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){t.success?(i("#media-stream ul.media-list").length||(i("#media-stream").html(i("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),i(".bb-photos-actions").show()),bp.Nouveau.inject("#media-stream ul.media-list",t.data.media,"prepend"),i('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){i(this).closest("li").data("id")===i(this).val()&&i(this).closest("li").remove()}),jQuery(window).scroll(),a.closeUploader(e)):i("#bp-existing-media-content").prepend(t.data.feedback),o.removeClass("saving")}})}else a.current_tab||(a.closeUploader(e),o.removeClass("saving"))},submitDocumentMedia:function(e){var t,a=this,o=i(e.currentTarget);if(e.preventDefault(),o.hasClass("saving"))return!1;if(o.addClass("saving"),"bp-dropzone-content"===a.current_tab){var d=i("#bp-media-post-content").val();t={action:"document_document_save",_wpnonce:BP_Nouveau.nonces.media,medias:a.dropzone_media,content:d,folder_id:a.album_id,group_id:a.group_id},i("#bp-dropzone-content .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){if(t.success){i("#media-stream div#media-folder-document-data-table").length||(i("#media-stream").html(i("<div></div>").addClass("display")),i("#media-stream div").attr("id","media-folder-document-data-table"),i(".bb-photos-actions").show()),bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",t.data.media,"prepend");for(var d=0;d<a.dropzone_media.length;d++)a.dropzone_media[d].saved=!0;a.closeUploader(e),jQuery(window).scroll()}else i("#bp-dropzone-content").prepend(t.data.feedback);o.removeClass("saving")}})}else if("bp-existing-media-content"===a.current_tab){var n=[];i('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){n.push(i(this).val())}),t={action:"media_move_to_album",_wpnonce:BP_Nouveau.nonces.media,medias:n,album_id:a.album_id,group_id:a.group_id},i("#bp-existing-media-content .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){t.success?(i("#media-stream ul.media-list").length||(i("#media-stream").html(i("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),i(".bb-photos-actions").show()),bp.Nouveau.inject("#media-stream ul.media-list",t.data.media,"prepend"),i('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){i(this).closest("li").data("id")===i(this).val()&&i(this).closest("li").remove()}),jQuery(window).scroll(),a.closeUploader(e)):i("#bp-existing-media-content").prepend(t.data.feedback),o.removeClass("saving")}})}else a.current_tab||(a.closeUploader(e),o.removeClass("saving"))},saveAlbum:function(e){var t=i(e.currentTarget),a=this,o=i("#bb-album-title"),d=i("#bb-album-privacy");if(e.preventDefault(),""===i.trim(o.val()))return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===i.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),t.prop("disabled",!0);var n={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val(),medias:a.dropzone_media,privacy:d.val()};a.album_id&&(n.album_id=a.album_id),a.group_id&&(n.group_id=a.group_id),i(".bb-single-album-header .bp-feedback").remove(),i("#boss-media-create-album-popup .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(n){setTimeout(function(){t.prop("disabled",!1)},500),n.success?a.album_id?(i("#bp-single-album-title").text(o.val()),i("#bb-album-privacy").val(d.val()),a.cancelEditAlbumTitle(e)):(i("#buddypress .bb-albums-list").prepend(n.data.album),window.location.href=n.data.redirect_url):a.album_id?i("#bp-media-single-album").prepend(n.data.feedback):i("#boss-media-create-album-popup .bb-model-header").after(n.data.feedback)}})},saveFolder:function(e){var t=i(e.currentTarget),a=this,o=i("#bb-album-title"),d=i("#bb-folder-privacy");if(e.preventDefault(),""===i.trim(o.val()))return o.addClass("error"),!1;o.removeClass("error");var n=i("#boss-media-create-album-popup .bb-folder-selected-id").val();if(!a.group_id&&""===i.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),t.prop("disabled",!0).addClass("loading");var s={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val().trim(),medias:a.dropzone_media,privacy:d.val(),parent:n};a.album_id&&(s.album_id=a.album_id),a.group_id&&(s.group_id=a.group_id),i(".bb-single-album-header .bp-feedback").remove(),i("#boss-media-create-album-popup .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(n){setTimeout(function(){t.prop("disabled",!1)},500),n.success?a.album_id?(i("#bp-single-album-title").text(o.val()),i("#bb-folder-privacy").val(d.val()),a.cancelEditAlbumTitle(e)):(i("#buddypress .bb-albums-list").prepend(n.data.album),window.location.href=n.data.redirect_url):a.album_id?i("#bp-media-single-album").prepend(n.data.feedback):i("#boss-media-create-album-popup .bb-model-header").after(n.data.feedback)}})},saveChildFolder:function(e){var t=i(e.currentTarget),a=this,o=i("#bb-album-child-title"),d=i("#bb-folder-child-privacy"),n=i("#parent_id");if(e.preventDefault(),""===i.trim(o.val()))return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===i.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),t.prop("disabled",!0);var s={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val(),medias:a.dropzone_media,privacy:d.val(),parent:n.val()};a.album_id&&(s.folder_id=a.album_id),a.group_id&&(s.group_id=a.group_id),i(".bb-single-album-header .bp-feedback").remove(),i("#boss-media-create-album-popup .bp-feedback").remove(),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){setTimeout(function(){t.prop("disabled",!1)},500),e.success?window.location.href=e.data.redirect_url:a.album_id?i("#bp-media-single-album").prepend(e.data.feedback):i("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},deleteAlbum:function(e){if(e.preventDefault(),!this.album_id)return!1;if(!confirm(BP_Nouveau.media.i18n_strings.album_delete_confirm))return!1;i(e.currentTarget).prop("disabled",!0);var t={action:"media_album_delete",_wpnonce:BP_Nouveau.nonces.media,album_id:this.album_id,group_id:this.group_id};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){t.success?window.location.href=t.data.redirect_url:(alert(BP_Nouveau.media.i18n_strings.album_delete_error),i(e.currentTarget).prop("disabled",!1))}})},deleteFolder:function(e){if(e.preventDefault(),!this.album_id)return!1;if(!confirm(BP_Nouveau.media.i18n_strings.folder_delete_confirm))return!1;i(e.currentTarget).prop("disabled",!0);var t={action:"media_folder_delete",_wpnonce:BP_Nouveau.nonces.media,album_id:this.album_id,group_id:this.group_id};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(t){t.success?window.location.href=t.data.redirect_url:(alert(BP_Nouveau.media.i18n_strings.folder_delete_error),i(e.currentTarget).prop("disabled",!1))}})},injectMedias:function(e){var t=bp.Nouveau.getStorage("bp-media"),a=t.scope||null,o=t.filter||null;if(i(e.currentTarget).hasClass("load-more")){var d=1*Number(this.current_page)+1,n=this,s="";e.preventDefault(),i(e.currentTarget).find("a").first().addClass("loading"),i("#buddypress .dir-search input[type=search]").length&&(s=i("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:a,filter:o,search_terms:s,page:d,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(t){!0===t.success&&(i(e.currentTarget).remove(),n.current_page=d,jQuery(window).scroll())})}},injectDocuments:function(e){var t=bp.Nouveau.getStorage("bp-media"),a=t.scope||null,o=t.filter||null,d=i(e.currentTarget);if(d.hasClass("load-more")){var n=1*Number(this.current_page)+1,s=this,r="";e.preventDefault(),d.find("a").first().addClass("loading"),i("#buddypress .dir-search input[type=search]").length&&(r=i("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"document",scope:a,filter:o,search_terms:r,page:n,method:"append",target:"#buddypress [data-bp-list] div#media-folder-document-data-table"}).done(function(e){!0===e.success&&(d.parent(".pager").remove(),s.current_page=n,jQuery(window).scroll())})}},sortDocuments:function(e){var t=i(e.currentTarget);t.data("filter");t.hasClass("asce")?t.removeClass("asce"):t.addClass("asce")},createFolderNavigate:function(e){e.preventDefault();var t=i(e.currentTarget),a=t.closest(".bb-field-steps"),o=0==t.closest(".bp-document-listing").length?"#bb-album-child-title":"#bb-album-title";t.closest(".document-options").length&&(o="#bb-album-title"),t.hasClass("bb-field-steps-next")&&""==a.find(o).val().trim()?a.find(o).addClass("error"):(a.find(o).removeClass("error"),a.slideUp(200).siblings(".bb-field-steps").slideDown(200))},uploadDocumentNavigate:function(e){e.preventDefault();var t=i(e.currentTarget),a=i(t).closest("#bp-media-uploader");i(t).hasClass("bb-field-uploader-next")?(a.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),a.find("#bp-media-document-submit, #bp-media-document-prev").show(),a.find("#bp-media-document-add-more").hide()):(i(t).hide(),a.find("#bp-media-document-submit, #bp-media-document-prev").hide(),a.find("#bp-media-document-add-more").show(),a.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200))},appendMedia:function(e){var t=bp.Nouveau.getStorage("bp-media"),a=t.scope||null,o=t.filter||null;if(i(e.currentTarget).hasClass("load-more")){var d=1*Number(this.current_page_existing_media)+1,n=this,s="";e.preventDefault(),i(e.currentTarget).find("a").first().addClass("loading"),i("#buddypress .dir-search input[type=search]").length&&(s=i("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:a,filter:o,search_terms:s,page:d,method:"append",caller:"bp-existing-media",target:".bp-existing-media-wrap ul.bp-list"}).done(function(t){!0===t.success&&(i(e.currentTarget).remove(),n.current_page_existing_media=d)})}},appendAlbums:function(e){var t=1*Number(this.current_page_albums)+1,a=this;e.preventDefault(),i(e.currentTarget).find("a").first().addClass("loading");var o={action:"media_albums_loader",_wpnonce:BP_Nouveau.nonces.media,page:t};i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(o){!0===o.success&&(i(e.currentTarget).remove(),i("#albums-dir-list ul.bb-albums-list").fadeOut(100,function(){i("#albums-dir-list ul.bb-albums-list").append(o.data.albums),i(this).fadeIn(100)}),a.current_page_albums=t)}})},toggleSubmitMediaButton:function(){var e=i("#bp-media-submit"),t=i("#bp-media-add-more");"bp-dropzone-content"===this.current_tab?this.dropzone_obj.getAcceptedFiles().length?(e.show(),t.show()):(e.hide(),t.hide()):"bp-existing-media-content"===this.current_tab&&(i('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').length?e.show():e.hide(),t.hide())},playVideo:function(e){e.preventDefault();var t=i(e.currentTarget).find("video").get(0),a=i(e.currentTarget).find(".gif-play-button");1==t.paused?(t.play(),a.hide()):(t.pause(),a.show())},autoPlayGifVideos:function(){i(".gif-player").each(function(){var e=i(this).find("video").get(0),t=i(this).find(".gif-play-button");i(this).is(":in-viewport")?(e.play(),t.hide()):(e.pause(),t.show())})},fileActionButton:function(e){i(e.currentTarget).parent().hasClass("download_file")||(e.preventDefault(),i(e.currentTarget).closest(".media-folder_items").toggleClass("is-visible").siblings(".media-folder_items").removeClass("is-visible"))},fileActivityActionButton:function(e){e.preventDefault(),i(e.currentTarget).closest(".bb-activity-media-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-media-elem").removeClass("is-visible"),"a"!=e.currentTarget.tagName.toLowerCase()||i(e.currentTarget).hasClass("document-action_more")||i(e.currentTarget).closest(".bb-activity-media-elem").removeClass("is-visible")},toggleFileActivityActionButton:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey?e:i(t).hasClass("document-action_more")||i(t).parent().hasClass("document-action_more")||i(t).hasClass("media-folder_action__anchor")||i(t).parent().hasClass("media-folder_action__anchor")?e:(i(".bb-activity-media-elem.is-visible").removeClass("is-visible"),void i(".media-folder_items.is-visible").removeClass("is-visible"))},expandCodePreview:function(e){e.preventDefault(),i(e.currentTarget).closest(".document-activity").addClass("code-full-view")},collapseCodePreview:function(e){e.preventDefault(),i(e.currentTarget).closest(".document-activity").removeClass("code-full-view")}},bp.Nouveau.Media.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.medias=[],this.current_media=!1,this.current_index=0,this.is_open=!1,this.nextLink=i(".bb-next-media"),this.previousLink=i(".bb-prev-media"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id},addListeners:function(){i(document).on("click",".bb-open-media-theatre",this.openTheatre.bind(this)),i(document).on("click",".bb-close-media-theatre",this.closeTheatre.bind(this)),i(document).on("click",".bb-prev-media",this.previous.bind(this)),i(document).on("click",".bb-next-media",this.next.bind(this)),i(document).on("bp_activity_ajax_delete_request",this.activityDeleted.bind(this)),i(document).on("click","#bb-media-model-container .media-privacy>li",this.mediaPrivacyChange.bind(this)),i(document).on("click","#bb-media-model-container .bb-media-section span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),i(document).click(this.togglePopupDropdown)},documentClick:function(e){var i=this;if(i.is_open){var t=e.target,a=document.getElementById("bb-media-model-container");null!=a&&!a.contains(t)&&document.body.contains(t)&&i.closeTheatre(e)}},checkPressedKey:function(e){var i=this;switch((e=e||window.event).keyCode){case 27:i.closeTheatre(e);break;case 37:i.previous(e);break;case 39:i.next(e)}},openTheatre:function(e){e.preventDefault();var t,a=i(e.currentTarget),o=this;if(a.closest("#bp-existing-media-content").length)return!1;o.setupGlobals(),o.setMedias(a),t=a.data("id"),o.setCurrentMedia(t),o.showMedia(),o.navigationCommands(),o.getActivity(),i(".bb-media-model-wrapper").show(),o.is_open=!0,document.addEventListener("keyup",o.checkPressedKey.bind(o))},closeTheatre:function(e){e.preventDefault();var t=this;i(".bb-media-model-wrapper").hide(),t.is_open=!1,document.removeEventListener("keyup",t.checkPressedKey.bind(t))},setMedias:function(e){var t=i(".bb-open-media-theatre"),a=0,o=this;if(i("body").hasClass("activity")&&(t=i(e).closest(".bb-activity-media-wrap").find(".bb-open-media-theatre")),void 0!==t)for(o.medias=[],a=0;a<t.length;a++){var d=i(t[a]);if(!d.closest("#bp-existing-media-content").length){var n={id:d.data("id"),attachment:d.data("attachment-full"),activity_id:d.data("activity-id"),privacy:d.data("privacy"),parent_activity_id:d.data("parent-activity-id"),album_id:d.data("album-id"),group_id:d.data("group-id"),is_forum:!1};d.closest(".forums-media-wrap").length&&(n.is_forum=!0),o.medias.push(n)}}},setCurrentMedia:function(e){var i=this,t=0;for(t=0;t<i.medias.length;t++)if(e===i.medias[t].id){i.current_media=i.medias[t],i.current_index=t;break}},showMedia:function(){var e=this;if(void 0===e.current_media)return!1;i(".bb-media-model-wrapper .bb-media-section").find("img").attr("src",e.current_media.attachment+"?"+(new Date).getTime());var t=i(".bb-media-section .bb-media-privacy-wrap");if(t.length){t.show(),t.find("ul.media-privacy li").removeClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip","");var a=t.find("ul.media-privacy").find("li[data-value="+e.current_media.privacy+"]");a.addClass("selected"),t.find(".bp-tooltip").attr("data-bp-tooltip",a.text()),t.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_media.privacy),(void 0!==BP_Nouveau.activity&&void 0!==e.current_media.activity_id&&0!=e.current_media.activity_id||e.group_id||e.current_media.is_forum||e.current_media.group_id||e.current_media.album_id)&&t.hide()}e.navigationCommands()},next:function(e){e.preventDefault();var i,t=this;void 0!==t.medias[t.current_index+1]?(t.current_index=t.current_index+1,i=t.current_media.activity_id,t.current_media=t.medias[t.current_index],t.showMedia(),i!=t.current_media.activity_id&&t.getActivity()):t.nextLink.hide()},previous:function(e){e.preventDefault();var i,t=this;void 0!==t.medias[t.current_index-1]?(t.current_index=t.current_index-1,i=t.current_media.activity_id,t.current_media=t.medias[t.current_index],t.showMedia(),i!=t.current_media.activity_id&&t.getActivity()):t.previousLink.hide()},navigationCommands:function(){var e=this;0==e.current_index&&e.current_index!=e.medias.length-1?(e.previousLink.hide(),e.nextLink.show()):0==e.current_index&&e.current_index==e.medias.length-1?(e.previousLink.hide(),e.nextLink.hide()):e.current_index==e.medias.length-1?(e.previousLink.show(),e.nextLink.hide()):(e.previousLink.show(),e.nextLink.show())},getActivity:function(){var e=this;i(".bb-media-info-section .activity-list").addClass("loading").html('<i class="dashicons dashicons-update animate-spin"></i>'),void 0!==BP_Nouveau.activity&&e.current_media&&void 0!==e.current_media.activity_id&&0!=e.current_media.activity_id&&!e.current_media.is_forum?(0!=e.activity_ajax&&e.activity_ajax.abort(),e.activity_ajax=i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_activity",id:e.current_media.activity_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success&&(i(".bb-media-info-section .activity-list").removeClass("loading").html(e.data.activity),i(".bb-media-info-section").show(),jQuery(window).scroll())}})):i(".bb-media-info-section").hide()},activityDeleted:function(e,t){var a=this,o=0;if(a.is_open&&void 0!==t&&"delete_activity"===t.action&&a.current_media.activity_id==t.id){for(i(document).find('[data-bp-list="media"] .bb-open-media-theatre[data-id="'+a.current_media.id+'"]').closest("li").remove(),i(document).find('[data-bp-list="activity"] .bb-open-media-theatre[data-id="'+a.current_media.id+'"]').closest(".bb-activity-media-elem").remove(),o=0;o<a.medias.length;o++)if(a.medias[o].activity_id==t.id){a.medias.splice(o,1);break}0==a.current_index&&a.current_index!=a.medias.length?(a.current_index=-1,a.next(e)):0==a.current_index&&a.current_index==a.medias.length?a.closeTheatre(e):a.current_index==a.medias.length?a.previous(e):(a.current_index=-1,a.next(e))}},togglePopupDropdown:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey?e:i(t).hasClass("privacy-wrap")||i(t).parent().hasClass("privacy-wrap")?e:void i("ul.media-privacy").removeClass("bb-open")},togglePrivacyDropdown:function(e){var t=i(e.target);e.preventDefault(),t.closest(".bb-media-privacy-wrap").find(".media-privacy").toggleClass("bb-open")},mediaPrivacyChange:function(e){var t=i(e.target),a=this,o=t.data("value"),d="public";if(e.preventDefault(),t.hasClass("selected"))return!1;t.closest(".bb-media-privacy-wrap").find(".privacy").addClass("loading"),d=t.closest(".bb-media-privacy-wrap").find("ul.media-privacy li.selected").data("value"),t.closest(".bb-media-privacy-wrap").find("ul.media-privacy li").removeClass("selected"),t.addClass("selected"),i.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_update_privacy",id:a.current_media.id,_wpnonce:BP_Nouveau.nonces.media,privacy:o},success:function(){t.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading").removeClass(d),t.closest(".bb-media-privacy-wrap").find(".privacy").addClass(o),t.closest(".bb-media-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",t.text())},error:function(){t.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading")}})}},bp.Nouveau.Media.start(),bp.Nouveau.Media.Theatre.start())}(bp,jQuery);