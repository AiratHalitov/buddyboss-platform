window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Media={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=t("body");this.current_page=1,this.current_page_existing_media=1,this.current_page_albums=1,this.current_tab=!e.hasClass("single-topic")&&!e.hasClass("single-forum")&&"bp-dropzone-content",void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1),this.documentOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:BP_Nouveau.media.document_type,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},t("#bp-media-uploader").hasClass("bp-media-document-uploader")?this.options={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:BP_Nouveau.media.document_type,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2}:this.options={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},void 0!==BP_Nouveau.media.dropzone_options&&Object.assign(this.options,BP_Nouveau.media.dropzone_options),this.dropzone_obj=[],this.dropzone_media=[],this.album_id=void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,this.group_id=void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,this.bbp_is_reply_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_reply_edit&&window.BP_Forums_Nouveau.media.bbp_is_reply_edit,this.bbp_is_topic_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_topic_edit&&window.BP_Forums_Nouveau.media.bbp_is_topic_edit,this.bbp_is_forum_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_forum_edit&&window.BP_Forums_Nouveau.media.bbp_is_forum_edit,this.bbp_reply_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_media?window.BP_Forums_Nouveau.media.reply_edit_media:[],this.bbp_reply_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_document?window.BP_Forums_Nouveau.media.reply_edit_document:[],this.bbp_topic_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_media?window.BP_Forums_Nouveau.media.topic_edit_media:[],this.bbp_topic_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_document?window.BP_Forums_Nouveau.media.topic_edit_document:[],this.bbp_forum_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_media?window.BP_Forums_Nouveau.media.forum_edit_media:[],this.bbp_forum_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_document?window.BP_Forums_Nouveau.media.forum_edit_document:[],this.bbp_reply_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_gif_data?window.BP_Forums_Nouveau.media.reply_edit_gif_data:[],this.bbp_topic_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_gif_data?window.BP_Forums_Nouveau.media.topic_edit_gif_data:[],this.bbp_forum_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_gif_data?window.BP_Forums_Nouveau.media.forum_edit_gif_data:[],this.giphy=null,this.gif_offset=0,this.gif_q=null,this.gif_limit=20,this.gif_requests=[],this.gif_data=[],this.gif_container_key=!1,bp.Nouveau.Media.documentCodeMirror(),t(window).on("scroll resize",function(){bp.Nouveau.Media.documentCodeMirror()})},addListeners:function(){var e=t(".bp-nouveau"),i=t(".bp-existing-media-wrap");e.on("click","#bp-add-media",this.openUploader.bind(this)),e.on("click","#bp-add-document",this.openDocumentUploader.bind(this)),e.on("click","#bp-media-submit",this.submitMedia.bind(this)),e.on("click","#bp-media-document-submit",this.submitDocumentMedia.bind(this)),e.on("click","#bp-media-uploader-close",this.closeUploader.bind(this)),e.on("click","#bb-delete-media",this.deleteMedia.bind(this)),e.on("click","#bb-select-deselect-all-media",this.toggleSelectAllMedia.bind(this)),t('#buddypress [data-bp-list="media"]').on("bp_ajax_request",this.bp_ajax_media_request),e.on("click","#bb-create-album",this.openCreateAlbumModal.bind(this)),e.on("click","#bb-create-folder",this.openCreateFolderModal.bind(this)),e.on("click","#bb-create-folder-child",this.openCreateFolderChildModal.bind(this)),e.on("click","#bp-edit-folder-open",this.openEditFolderChildModal.bind(this)),e.on("click","#bp-media-create-album-submit",this.saveAlbum.bind(this)),e.on("click","#bp-media-create-folder-submit",this.saveFolder.bind(this)),e.on("click","#bp-media-create-child-folder-submit",this.saveChildFolder.bind(this)),e.on("click","#bp-media-create-album-close",this.closeCreateAlbumModal.bind(this)),e.on("click","#bp-media-create-folder-close",this.closeCreateFolderModal.bind(this)),e.on("click","#bp-media-edit-folder-close",this.closeEditFolderModal.bind(this)),e.on("click","#bp-media-add-more",this.triggerDropzoneSelectFileDialog.bind(this)),e.on("click","#bp-media-document-add-more",this.triggerDropzoneSelectFileDialog.bind(this)),t("#bp-media-uploader").on("click",".bp-media-upload-tab",this.changeUploadModalTab.bind(this)),t('.bp-nouveau [data-bp-list="media"]').on("click","li.load-more",this.injectMedias.bind(this)),t(".bp-nouveau #albums-dir-list").on("click","li.load-more",this.appendAlbums.bind(this)),i.on("click","li.load-more",this.appendMedia.bind(this)),e.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.addSelectedClassToWrapper.bind(this)),i.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.toggleSubmitMediaButton.bind(this)),e.on("click","#bp-edit-album-title",this.editAlbumTitle.bind(this)),e.on("click","#bp-edit-folder-title",this.editFolderTitle.bind(this)),e.on("click","#bp-cancel-edit-album-title",this.cancelEditAlbumTitle.bind(this)),e.on("click","#bp-save-album-title",this.saveAlbum.bind(this)),e.on("click","#bp-save-folder-title",this.saveFolder.bind(this)),e.on("change","#bp-media-single-album select#bb-album-privacy",this.saveAlbum.bind(this)),e.on("change",".bb-media-container select#bb-folder-privacy",this.savePrivacy.bind(this)),e.on("click","#bb-delete-album",this.deleteAlbum.bind(this)),e.on("click","#bb-delete-folder",this.deleteFolder.bind(this)),t(document).on("click","#forums-media-button",this.openForumsUploader.bind(this)),t(document).on("click","#forums-document-button",this.openForumsDocumentUploader.bind(this)),t(document).on("click","#forums-gif-button",this.toggleGifSelector.bind(this)),t(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("keyup",".search-query-input",this.searchGif.bind(this)),t(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),t(document).find("form #whats-new-toolbar .gif-search-results, .forum form #whats-new-toolbar .gif-search-results").scroll(this.loadMoreGif.bind(this)),t(".buddypress.groups.messages").length||t(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),t(document).find("form #whats-new-attachments .forums-attached-gif-container .gif-search-results, .forum form #whats-new-attachments .forums-attached-gif-container .gif-search-results").scroll(this.loadMoreGif.bind(this)),t(document).find("form #whats-new-attachments .forums-attached-gif-container, .forum form #whats-new-attachments .forums-attached-gif-container").on("click",".gif-image-remove",this.removeSelectedGif.bind(this)),t(document).on("click",".gif-image-container",this.playVideo.bind(this)),t(document).on("click",".directory.document  .media-folder_action__anchor, .directory.document  .media-folder_action__anchor li a, .bb-media-container .media-folder_action__anchor, .bb-media-container  .media-folder_action__list li a",this.fileActionButton.bind(this)),t(document).on("click",".media-folder_action__list .copy_download_file_url a",this.copyDownloadLink.bind(this)),t(document).on("click",".bb-activity-media-elem.document-activity .document-action-wrap .document-action_more, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_list li a",this.fileActivityActionButton.bind(this)),t(document).click(this.toggleFileActivityActionButton),t(document).on("click",".bb-activity-media-elem.document-activity .document-expand .document-expand-anchor",this.expandCodePreview.bind(this)),t(document).on("click",".bb-activity-media-elem.document-activity .document-action-wrap .document-action_collapse",this.collapseCodePreview.bind(this)),t(document).on("click",".activity .bp-document-move-activity, #media-stream .bp-document-move-activity",this.moveDocumentIntoFolder.bind(this)),t(document).on("click",'.bp-nouveau [data-bp-list="document"] .pager .dt-more-container.load-more',this.injectDocuments.bind(this)),t(document).on("click",'.bp-nouveau [data-bp-list="document"] .data-head',this.sortDocuments.bind(this)),t(document).on("click",".modal-container .bb-field-steps-actions",this.documentPopupNavigate.bind(this)),t(document).on("click",".modal-container .bb-field-uploader-actions",this.uploadDocumentNavigate.bind(this)),t(document).on("click",".modal-container #bp-media-edit-child-folder-submit",this.renameChildFolder.bind(this));var a=t("#bb-media-model-container .activity-list, #media-stream");t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream').on("click",".ac-document-move, .ac-folder-move",this.openDocumentMove.bind(this)),t('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream').on("click",".ac-document-close-button, .ac-folder-close-button",this.closeDocumentMove.bind(this)),a.on("click",".ac-document-rename",this.renameDocument.bind(this)),a.on("click",".ac-document-privacy",this.editPrivacyDocument.bind(this)),a.on("mouseup","#bb-folder-privacy",this.editPrivacyDocumentSubmit.bind(this)),a.on("keyup",".media-folder_name_edit",this.renameDocumentSubmit.bind(this)),a.on("click",".name_edit_cancel, .name_edit_save",this.renameDocumentSubmit.bind(this)),t(document).on("click",".document-file-delete",this.deleteDocument.bind(this)),t(document).on("click",".bp-folder-move",this.folderMove.bind(this));var o=t(".buddypress.groups.messages"),d=t(".buddypress.groups.messages form#send_group_message_form #whats-new-toolbar"),s=t(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container .gif-search-results"),n=t(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container");o.on("click","#bp-group-messages-media-button",this.openGroupMessagesUploader.bind(this)),o.on("click","#bp-group-messages-gif-button",this.toggleGroupMessagesGifSelector.bind(this)),d.on("keyup",".search-query-input",this.searchGroupMessagesGif.bind(this)),d.on("click",".found-media-item",this.selectGroupMessagesGif.bind(this)),s.scroll(this.loadMoreGroupMessagesGif.bind(this)),t(".groups.messages form#send_group_message_form #whats-new-toolbar .bp-group-messages-attached-gif-container .gif-search-results").scroll(this.loadMoreGroupMessagesGif.bind(this)),n.on("click",".gif-image-remove",this.removeGroupMessagesSelectedGif.bind(this)),t(document).on("click",".gif-image-container",this.playVideo.bind(this)),_.isUndefined(BP_Nouveau.media.gif_api_key)||(window.addEventListener("scroll",this.autoPlayGifVideos,!1),window.addEventListener("resize",this.autoPlayGifVideos,!1)),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&t("#forums-media-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&t("#forums-document-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(Object.keys(this.bbp_reply_edit_gif_data).length||Object.keys(this.bbp_topic_edit_gif_data).length||Object.keys(this.bbp_forum_edit_gif_data).length)&&this.editGifPreview()},savePrivacy:function(e){var i=t(e.currentTarget),a=0,o="",d="";if(e.preventDefault(),a=parseInt(i.data("item-id")),o=i.data("item-type"),d=i.val(),a>0){var s={action:"document_save_privacy",itemId:a,type:o,value:d};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){e.success}})}},folderMove:function(e){var i=t(e.currentTarget);e.preventDefault();var a=i.attr("id"),o=t("#media-folder-document-data-table #bp-media-move-folder .modal-mask .modal-wrapper #boss-media-create-album-popup .bb-field-wrap .bb-folder-selected-id").val();if(""===a||""===o)return alert(BP_Nouveau.media.i18n_strings.folder_move_error),!1;var d={action:"document_folder_move",currentFolderId:a,folderMoveToId:o};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,success:function(e){if(e.success){var i=t("#media-stream");i.html(""),i.html(e.data.html)}}})},deleteDocument:function(e){var i=t(e.currentTarget);e.preventDefault();var a=i.attr("data-type"),o=i.attr("data-item-id"),d=i.attr("data-item-attachment-id"),s=i.attr("data-item-preview-attachment-id");if("folder"===a&&!confirm(BP_Nouveau.media.i18n_strings.folder_delete_confirm))return!1;var n={action:"document_delete",id:o,preview_attachment_id:s,type:a,attachment_id:d};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(e){if(e.success){var i=t("#media-stream");i.html(""),i.html(e.data.html)}}})},bp_ajax_media_request:function(e,i){void 0!==i&&void 0!==i.response.scopes.personal&&0===i.response.scopes.personal&&t(".bb-photos-actions").hide()},addSelectedClassToWrapper:function(e){var i=e.currentTarget;if(t(i).is(":checked"))t(i).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),t(i).closest(".bb-photo-thumb").addClass("selected");else{t(i).closest(".bb-photo-thumb").removeClass("selected"),t(i).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select);var a=t(".bp-nouveau #bb-select-deselect-all-media");a.hasClass("selected")&&a.removeClass("selected")}},moveDocumentIntoFolder:function(e){var i=t(e.currentTarget);e.preventDefault();var a=i.attr("id"),o=i.closest(".bp-media-move-file").find(".bb-folder-selected-id").val();if(""===a||""===o)return i.closest(".modal-container").find(".location-folder-list").addClass("has-error"),!1;i.closest(".modal-container").find(".location-folder-list").removeClass("has-error"),i.addClass("loading");var d={action:"document_move",_wpnonce:BP_Nouveau.nonces.media,document_id:a,folder_id:o};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,success:function(e){if(e.success){var a=t("#media-stream");a.html(""),a.html(e.data.html),i.closest(".bp-media-move-file").find(".ac-document-close-button").trigger("click")}}})},deleteMedia:function(e){var i=t(e.currentTarget);e.preventDefault();var a=[],o=t("#buddypress");if(o.find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){t(this).closest(".bb-photo-thumb").addClass("loading deleting"),a.push(t(this).val())}),0==a.length)return!1;i.prop("disabled",!0),t("#buddypress .media-list .bp-feedback").remove();var d={action:"media_delete",_wpnonce:BP_Nouveau.nonces.media,media:a};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,success:function(e){if(setTimeout(function(){i.prop("disabled",!1)},500),e.success){if(o.find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){t(this).closest("li").remove()}),0==t("#buddypress").find(".media-list:not(.existing-media-list)").find("li:not(.load-more)").length){t(".bb-photos-actions").hide();var a='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.media.i18n_strings.no_photos_found+"</p>\n\t</aside>";t('#buddypress [data-bp-list="media"]').html(a)}}else t("#buddypress .media-list").prepend(e.data.feedback)}})},toggleSelectAllMedia:function(e){e.preventDefault(),t(e.currentTarget).hasClass("selected")?(t(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllMedia(e)):(t(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllMedia(e)),t(e.currentTarget).toggleClass("selected")},selectAllMedia:function(e){e.preventDefault(),t("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){t(this).prop("checked",!0),t(this).closest(".bb-photo-thumb").addClass("selected"),t(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllMedia:function(e){e.preventDefault(),t("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){t(this).prop("checked",!1),t(this).closest(".bb-photo-thumb").removeClass("selected"),t(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},editAlbumTitle:function(e){e.preventDefault(),t("#bb-album-title").show(),t("#bp-save-album-title").show(),t("#bp-cancel-edit-album-title").show(),t("#bp-edit-album-title").hide(),t("#bp-media-single-album #bp-single-album-title").hide()},editFolderTitle:function(e){e.preventDefault(),t("#bb-album-title").show(),t("#bp-save-folder-title").show(),t("#bp-cancel-edit-album-title").show(),t("#bp-edit-folder-title").hide(),t("#bp-media-single-album #bp-single-album-title").hide()},cancelEditAlbumTitle:function(e){e.preventDefault(),t("#bb-album-title").hide(),t("#bp-save-album-title,#bp-save-folder-title").hide(),t("#bp-cancel-edit-album-title").hide(),t("#bp-edit-album-title,#bp-edit-folder-title").show(),t("#bp-media-single-album #bp-single-album-title").show()},triggerDropzoneSelectFileDialog:function(){this.dropzone_obj.hiddenFileInput.click()},closeUploader:function(e){e.preventDefault(),t("#bp-media-uploader").hide(),t("#bp-media-add-more").hide(),t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload),t("#bp-media-uploader-modal-status-text").text(""),this.dropzone_obj.destroy(),this.dropzone_media=[];var i=t(e.currentTarget).closest("#bp-media-uploader");i.find(".bb-field-steps").length&&(i.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),i.find("#bp-media-document-prev, #bp-media-document-submit").hide()),this.clearFolderLocationUI(e)},loadMoreGif:function(e){var i=e.target,a=this,o=t(e.target).closest("form").find(".forums-attached-gif-container"),d=o.data("key");if(a.gif_container_key=d,i.scrollTop+i.offsetHeight>=i.scrollHeight&&!o.hasClass("loading")&&a.gif_data[d].total_count>0&&a.gif_data[d].offset<=a.gif_data[d].total_count){var s={offset:a.gif_data[d].offset,fmt:"json",limit:a.gif_data[d].limit};o.addClass("loading");var n=null;n=_.isNull(a.gif_data[d].q)?a.giphy.trending(s,_.bind(a.loadMoreGifResponse,a)):a.giphy.search(_.extend({q:a.gif_data[d].q},s),_.bind(a.loadMoreGifResponse,a)),a.gif_data[d].requests.push(n),a.gif_data[d].offset=a.gif_data[d].offset+a.gif_data[d].limit}},loadMoreGroupMessagesGif:function(e){var i=e.target,a=this,o=t(e.target).closest("form").find(".bp-group-messages-attached-gif-container").data("key");if(a.gif_container_key=o,i.scrollTop+i.offsetHeight>=i.scrollHeight&&!t(e.target).closest(".bp-group-messages-attached-gif-container").hasClass("loading")&&a.gif_total_count>0&&a.gif_offset<=a.gif_total_count){var d={offset:a.gif_offset,fmt:"json",limit:a.gif_limit};t(e.target).closest(".bp-group-messages-attached-gif-container").addClass("loading");var s=null;s=_.isNull(a.gif_q)?a.giphy.trending(d,_.bind(a.loadMoreGroupMessagesGifResponse,a)):a.giphy.search(_.extend({q:a.gif_q},d),_.bind(a.loadMoreGroupMessagesGifResponse,a)),a.gif_requests.push(s),a.gif_offset=a.gif_offset+a.gif_limit,a.gif_data[o].requests.push(s),a.gif_data[o].offset=a.gif_data[o].offset+a.gif_data[o].limit}},loadMoreGroupMessagesGifResponse:function(e){var i=this,a=0;if(t(".bp-group-messages-attached-gif-container").removeClass("loading"),void 0!==e.data&&e.data.length){var o="";for(a=0;a<e.data.length;a++)o+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[a].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[a].images.original.url+'" data-id="'+e.data[a].id+'">\n\t\t<img src="'+e.data[a].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[a].saved=!1,i.gif_data.push(e.data[a]);t(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(o)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(i.gif_total_count=e.pagination.total_count)},loadMoreGifResponse:function(e){var i=this,a=0;if(t('div.forums-attached-gif-container[data-key="'+i.gif_container_key+'"]').removeClass("loading"),void 0!==e.data&&e.data.length){var o="";for(a=0;a<e.data.length;a++)o+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[a].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[a].images.original.url+'" data-id="'+e.data[a].id+'">\n\t\t<img src="'+e.data[a].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[a].saved=!1,i.gif_data[i.gif_container_key].data.push(e.data[a]);t('div.forums-attached-gif-container[data-key="'+i.gif_container_key+'"]').closest("form").find(".gif-search-results-list").append(o)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(i.gif_data[i.gif_container_key].total_count=e.pagination.total_count)},editGifPreview:function(){var e=this,i={};if(e.bbp_is_reply_edit&&Object.keys(e.bbp_reply_edit_gif_data).length?i=e.bbp_reply_edit_gif_data.gif_raw_data:e.bbp_is_topic_edit&&Object.keys(e.bbp_topic_edit_gif_data).length?i=e.bbp_topic_edit_gif_data.gif_raw_data:e.bbp_is_forum_edit&&Object.keys(e.bbp_forum_edit_gif_data).length&&(i=e.bbp_forum_edit_gif_data.gif_raw_data),void 0===i.images)return!1;var a=t("#whats-new-attachments .forums-attached-gif-container");a[0].style.backgroundImage="url("+i.images.fixed_width.url+")",a[0].style.backgroundSize="contain",a[0].style.height=i.images.original.height+"px",a[0].style.width=i.images.original.width+"px",a.find(".gif-image-container img").attr("src",i.images.original.url),a.removeClass("closed"),t("#bbp_media_gif").length&&t("#bbp_media_gif").val(JSON.stringify(i))},selectGif:function(e){var i=this,a=0,o=t(e.currentTarget),d=o.closest("form").find(".forums-attached-gif-container");e.preventDefault(),d.closest("form").find(".gif-media-search-dropdown").removeClass("open");var s=d.data("key");if(void 0!==i.gif_data[s]&&void 0!==i.gif_data[s].data&&i.gif_data[s].data.length)for(a=0;a<i.gif_data[s].data.length;a++)if(i.gif_data[s].data[a].id==e.currentTarget.dataset.id){o.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+i.gif_data[s].data[a].images.fixed_width.url+")",o.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",o.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.height=i.gif_data[s].data[a].images.original.height+"px",o.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.width=i.gif_data[s].data[a].images.original.width+"px",o.closest("form").find("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",i.gif_data[s].data[a].images.original.url),o.closest("form").find("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),o.closest("form").find("#bbp_media_gif").length&&o.closest("form").find("#bbp_media_gif").val(JSON.stringify(i.gif_data[s].data[a]));break}},selectGroupMessagesGif:function(e){var i=this,a=0;e.preventDefault();var o=t("#whats-new-attachments .bp-group-messages-attached-gif-container"),d=t("#bp_group_messages_gif");if(t("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),i.gif_data.length)for(a=0;a<i.gif_data.length;a++)if(i.gif_data[a].id==e.currentTarget.dataset.id){o[0].style.backgroundImage="url("+i.gif_data[a].images.fixed_width.url+")",o[0].style.backgroundSize="contain",o[0].style.height=i.gif_data[a].images.original.height+"px",o[0].style.width=i.gif_data[a].images.original.width+"px",o.find(".gif-image-container img").attr("src",i.gif_data[a].images.original.url),o.removeClass("closed"),d.length&&d.val(JSON.stringify(i.gif_data[a]));break}},removeSelectedGif:function(e){e.preventDefault(),this.resetForumsGifComponent(e)},removeGroupMessagesSelectedGif:function(e){e.preventDefault(),this.resetGroupMessagesGifComponent()},resetForumsGifComponent:function(e){var i=t(e.target);i.closest("form").find(".gif-media-search-dropdown").removeClass("open"),i.closest("form").find("#whats-new-toolbar #forums-gif-button").removeClass("active");var a=i.closest("form").find("#whats-new-attachments .forums-attached-gif-container");a&&(a.addClass("closed"),a.find(".gif-image-container img").attr("src",""),a[0].style=""),i.closest("form").find("#bbp_media_gif").length&&i.closest("form").find("#bbp_media_gif").val("")},resetGroupMessagesGifComponent:function(){var e=t("#whats-new-attachments .bp-group-messages-attached-gif-container"),i=t("#bp_group_messages_gif");t("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),t("#whats-new-toolbar #bp-group-messages-gif-button").removeClass("active"),e.addClass("closed"),e.find(".gif-image-container img").attr("src",""),e[0].style="",i.length&&i.val("")},searchGif:function(e){var t=this;null!=t.gif_timeout&&clearTimeout(this.gif_timeout),t.gif_timeout=setTimeout(function(){t.gif_timeout=null,t.searchGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGif:function(e){var t=this;null!=t.gif_timeout&&clearTimeout(this.gif_timeout),t.gif_timeout=setTimeout(function(){t.gif_timeout=null,t.searchGroupMessagesGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGifRequest:function(e){var i=this;i.gif_q=e.target.value,i.gif_offset=0;var a=0;i.clearGifRequests(),t(e.target).closest(".bp-group-messages-attached-gif-container").addClass("loading");var o=i.giphy.search({q:i.gif_q,offset:i.gif_offset,fmt:"json",limit:i.gif_limit},function(o){if(void 0!==o.data&&o.data.length){var d="";for(a=0;a<o.data.length;a++)d+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+o.data[a].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+o.data[a].images.original.url+'" data-id="'+o.data[a].id+'">\n\t\t<img src="'+o.data[a].images.fixed_width.url+'">\n\t</a>\n</li>',o.data[a].saved=!1,i.gif_data.push(o.data[a]);t(e.target).closest(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(d)}void 0!==o.pagination&&void 0!==o.pagination.total_count&&(i.gif_total_count=o.pagination.total_count),t(e.target).closest(".bp-group-messages-attached-gif-container").removeClass("loading")});i.gif_requests.push(o),i.gif_offset=i.gif_offset+i.gif_limit},searchGifRequest:function(e){var i=this,a=0,o=t(e.target).closest("form").find(".forums-attached-gif-container");o.addClass("loading");var d=o.data("key");i.clearGifRequests(d),i.gif_data[d].q=e.target.value,i.gif_data[d].offset=0;var s=i.giphy.search({q:i.gif_data[d].q,offset:i.gif_data[d].offset,fmt:"json",limit:i.gif_data[d].limit},function(s){if(void 0!==s.data&&s.data.length){var n="";for(a=0;a<s.data.length;a++)n+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+s.data[a].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+s.data[a].images.original.url+'" data-id="'+s.data[a].id+'">\n\t\t<img src="'+s.data[a].images.fixed_width.url+'">\n\t</a>\n</li>',s.data[a].saved=!1,i.gif_data[d].data.push(s.data[a]);t(e.target).closest(".gif-search-content").find(".gif-search-results-list").append(n)}void 0!==s.pagination&&void 0!==s.pagination.total_count&&(i.gif_data[d].total_count=s.pagination.total_count),o.removeClass("loading")});i.gif_data[d].requests.push(s),i.gif_data[d].offset=i.gif_data[d].offset+i.gif_data[d].limit},clearGifRequests:function(e){var i=this;if(void 0!==i.gif_data[e]&&void 0!==i.gif_data[e].requests){for(var a=0;a<i.gif_data[e].requests.length;a++)i.gif_data[e].requests[a].abort();t('[data-key="'+e+'"]').closest("form").find(".gif-search-results-list li").remove(),i.gif_data[e].requests=[],i.gif_data[e].data=[],i.gif_data.splice(e,1)}},toggleGifSelector:function(e){var i=this,a=t(e.currentTarget),o=a.closest("form").find(".gif-media-search-dropdown"),d=0;if(e.preventDefault(),void 0!==window.Giphy&&void 0!==BP_Nouveau.media.gif_api_key){i.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key);var s=a.closest("form").find(".forums-attached-gif-container");s.addClass("loading");var n=s.data("key");i.clearGifRequests(n),i.gif_data[n]={q:null,offset:0,limit:20,requests:[],total_count:0,data:[]};var r=i.giphy.trending({offset:i.gif_data[n].offset,fmt:"json",limit:i.gif_data[n].limit},function(e){if(void 0!==e.data&&e.data.length){var t="";for(d=0;d<e.data.length;d++)t+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[d].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[d].images.original.url+'" data-id="'+e.data[d].id+'">\n\t\t<img src="'+e.data[d].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[d].saved=!1,i.gif_data[n].data.push(e.data[d]);a.closest("form").find(".gif-search-results-list").append(t)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(i.gif_data[n].total_count=e.pagination.total_count),s.removeClass("loading")});i.gif_data[n].requests.push(r),i.gif_data[n].offset=i.gif_data[n].offset+i.gif_data[n].limit}o.toggleClass("open"),a.toggleClass("active");var l=a.closest("form").find("#forums-post-media-uploader");l.length&&i.resetForumsMediaComponent(l.data("key"))},toggleGroupMessagesGifSelector:function(e){var i=this,a=t(e.currentTarget),o=a.closest("form").find(".gif-media-search-dropdown"),d=0;if(e.preventDefault(),void 0!==window.Giphy&&void 0!==BP_Nouveau.media.gif_api_key&&null==i.giphy){i.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key),i.gif_offset=0,i.gif_q=null,i.gif_limit=20,i.gif_requests=[],i.gif_data=[],i.clearGifRequests(),t(".gif-search-query").closest(".bp-group-messages-attached-gif-container").addClass("loading");var s=i.giphy.trending({offset:i.gif_offset,fmt:"json",limit:i.gif_limit},function(e){if(void 0!==e.data&&e.data.length){var o="";for(d=0;d<e.data.length;d++)o+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[d].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[d].images.original.url+'" data-id="'+e.data[d].id+'">\n\t\t<img src="'+e.data[d].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[d].saved=!1,i.gif_data.push(e.data[d]);a.closest("form").find(".gif-search-results-list").append(o)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(i.gif_total_count=e.pagination.total_count),t(".gif-search-query").closest(".bp-group-messages-attached-gif-container").removeClass("loading")});i.gif_requests.push(s),i.gif_offset=i.gif_offset+i.gif_limit}o.toggleClass("open"),a.toggleClass("active"),i.resetGroupMessagesMediaComponent()},resetGroupMessagesMediaComponent:function(){var e=this;e.dropzone_obj&&e.dropzone_obj.destroy(),e.dropzone_media=[],t("div#bp-group-messages-post-media-uploader").html(""),t("div#bp-group-messages-post-media-uploader").addClass("closed").removeClass("open")},resetForumsMediaComponent:function(e){var i=this;if(void 0!==e){void 0!==i.dropzone_obj[e]&&(i.dropzone_obj[e].destroy(),i.dropzone_obj.splice(e,1),i.dropzone_media.splice(e,1));var a=t('div#forums-post-media-uploader[data-key="'+e+'"]');a.html(""),a.addClass("closed").removeClass("open")}},resetForumsDocumentComponent:function(e){var i=this;if(void 0!==e){void 0!==i.dropzone_obj[e]&&(i.dropzone_obj[e].destroy(),i.dropzone_obj.splice(e,1),i.dropzone_media.splice(e,1));var a=t('div#forums-post-document-uploader[data-key="'+e+'"]');a.html(""),a.addClass("closed").removeClass("open")}},openForumsUploader:function(e){var i=this,a=t(e.currentTarget).closest("form").find("#forums-post-media-uploader"),o=[];if(e.preventDefault(),void 0!==window.Dropzone&&a.length){var d=a.data("key");if(a.hasClass("closed")){if(i.dropzone_obj[d]=new Dropzone(a[0],i.options),i.dropzone_media[d]=[],i.dropzone_obj[d].on("sending",function(e,t,i){i.append("action","media_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj[d].on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):i.dropzone_obj[d].removeFile(e)}),i.dropzone_obj[d].on("success",function(e,o){o.data.id&&(e.id=o.id,o.data.uuid=e.upload.uuid,o.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,o.data.album_id=i.album_id,o.data.group_id=i.group_id,o.data.saved=!1,i.dropzone_media[d].push(o.data),i.addMediaIdsToForumsForm(a))}),i.dropzone_obj[d].on("removedfile",function(e){if(i.dropzone_media[d].length)for(var t in i.dropzone_media[d])if(e.upload.uuid==i.dropzone_media[d][t].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===i.dropzone_media[d][t].saved||i.dropzone_media[d][t].saved||i.removeAttachment(i.dropzone_media[d][t].id),i.dropzone_media[d].splice(t,1),i.addMediaIdsToForumsForm(a);break}}),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&(this.bbp_reply_edit_media.length?o=this.bbp_reply_edit_media:this.bbp_topic_edit_media.length?o=this.bbp_topic_edit_media:this.bbp_forum_edit_media.length&&(o=this.bbp_forum_edit_media),o.length)){for(var s=!1,n=0;n<o.length;n++)s=!1,i.dropzone_media[d].push({id:o[n].attachment_id,media_id:o[n].id,name:o[n].title,thumb:o[n].thumb,url:o[n].full,uuid:o[n].id,menu_order:n,saved:!0}),s={name:o[n].title,accepted:!0,kind:"image",upload:{filename:o[n].title,uuid:o[n].id},dataURL:o[n].url,id:o[n].id},i.dropzone_obj[d].files.push(s),i.dropzone_obj[d].emit("addedfile",s),i.createThumbnailFromUrl(s,a);i.addMediaIdsToForumsForm(a)}a.removeClass("closed").addClass("open"),i.resetForumsGifComponent(e)}else i.resetForumsMediaComponent(d)}},openGroupMessagesUploader:function(e){var i=this,a=t("div#bp-group-messages-post-media-uploader"),o=[];if(e.preventDefault(),void 0!==window.Dropzone&&a.length)if(a.hasClass("closed")){if(i.dropzone_obj=new Dropzone("div#bp-group-messages-post-media-uploader",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","media_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):i.dropzone_obj.removeFile(e)}),i.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,a.data.album_id=i.album_id,a.data.group_id=i.group_id,a.data.saved=!1,i.dropzone_media.push(a.data),i.addMediaIdsToGroupMessagesForm())}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var t in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[t].uuid){void 0===i.dropzone_media[t].saved||i.dropzone_media[t].saved||i.removeAttachment(i.dropzone_media[t].id),i.dropzone_media.splice(t,1),i.addMediaIdsToGroupMessagesForm();break}}),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&(this.bbp_reply_edit_media.length?o=this.bbp_reply_edit_media:this.bbp_topic_edit_media.length?o=this.bbp_topic_edit_media:this.bbp_forum_edit_media.length&&(o=this.bbp_forum_edit_media),o.length)){for(var d=!1,s=0;s<o.length;s++)d=!1,i.dropzone_media.push({id:o[s].attachment_id,media_id:o[s].id,name:o[s].title,thumb:o[s].thumb,url:o[s].full,uuid:o[s].id,menu_order:s,saved:!0}),d={name:o[s].title,accepted:!0,kind:"image",upload:{filename:o[s].title,uuid:o[s].id},dataURL:o[s].url,id:o[s].id},i.dropzone_obj.files.push(d),i.dropzone_obj.emit("addedfile",d),i.createThumbnailFromUrl(d);i.addMediaIdsToGroupMessagesForm()}a.removeClass("closed").addClass("open"),i.resetGroupMessagesGifComponent()}else i.resetGroupMessagesMediaComponent()},openForumsDocumentUploader:function(e){var i=this,a=t(e.currentTarget).closest("form").find("#forums-post-document-uploader"),o=[];if(e.preventDefault(),void 0!==window.Dropzone&&a.length){var d=a.data("key");if(a.hasClass("closed")){if(i.dropzone_obj[d]=new Dropzone(a[0],i.documentOptions),i.dropzone_media[d]=[],i.dropzone_obj[d].on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj[d].on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):i.dropzone_obj[d].removeFile(e)}),i.dropzone_obj[d].on("success",function(e,o){o.data.id&&(e.id=o.id,o.data.uuid=e.upload.uuid,o.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,o.data.album_id=i.album_id,o.data.group_id=i.group_id,o.data.saved=!1,i.dropzone_media[d].push(o.data),i.addDocumentIdsToForumsForm(a))}),i.dropzone_obj[d].on("removedfile",function(e){if(i.dropzone_media[d].length)for(var t in i.dropzone_media[d])if(e.upload.uuid==i.dropzone_media[d][t].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===i.dropzone_media[d][t].saved||i.dropzone_media[d][t].saved||i.removeAttachment(i.dropzone_media[d][t].id),i.dropzone_media[d].splice(t,1),i.addDocumentIdsToForumsForm(a);break}}),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&(this.bbp_reply_edit_document.length?o=this.bbp_reply_edit_document:this.bbp_topic_edit_document.length?o=this.bbp_topic_edit_document:this.bbp_forum_edit_document.length&&(o=this.bbp_forum_edit_document),o.length)){for(var s=!1,n=0;n<o.length;n++)s=!1,i.dropzone_media[d].push({id:o[n].attachment_id,media_id:o[n].id,name:o[n].name,title:o[n].name,size:o[n].size,url:o[n].url,uuid:o[n].id,menu_order:n,saved:!0}),s={name:o[n].name,size:o[n].size,accepted:!0,kind:"document",upload:{name:o[n].name,title:o[n].name,size:o[n].size,uuid:o[n].id},dataURL:o[n].url,id:o[n].id},i.dropzone_obj[d].files.push(s),i.dropzone_obj[d].emit("addedfile",s),i.dropzone_obj[d].emit("complete",s);i.addDocumentIdsToForumsForm(a)}a.removeClass("closed").addClass("open"),i.resetForumsGifComponent(e)}else i.resetForumsDocumentComponent(d)}},addMediaIdsToForumsForm:function(e){var t=this,i=e.data("key");e.closest("#whats-new-attachments").find("#bbp_media").length&&e.closest("#whats-new-attachments").find("#bbp_media").val(JSON.stringify(t.dropzone_media[i]))},addDocumentIdsToForumsForm:function(e){var t=this,i=e.data("key");e.closest("#whats-new-attachments").find("#bbp_document").length&&e.closest("#whats-new-attachments").find("#bbp_document").val(JSON.stringify(t.dropzone_media[i]))},createThumbnailFromUrl:function(e,t){var i=this,a=t.data("key");i.dropzone_obj[a].createThumbnailFromUrl(e,i.dropzone_obj[a].options.thumbnailWidth,i.dropzone_obj[a].options.thumbnailHeight,i.dropzone_obj[a].options.thumbnailMethod,!0,function(t){i.dropzone_obj[a].emit("thumbnail",e,t),i.dropzone_obj[a].emit("complete",e)})},openUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&t("div#media-uploader").length&&(t("#bp-media-uploader").show(),i.dropzone_obj=new Dropzone("div#media-uploader",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","media_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("addedfile",function(){setTimeout(function(){i.dropzone_obj.getAcceptedFiles().length&&t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):i.dropzone_obj.removeFile(e)}),i.dropzone_obj.on("queuecomplete",function(){t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),i.dropzone_obj.on("processing",function(){t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),i.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i.dropzone_media.length,a.data.album_id=i.album_id,a.data.group_id=i.group_id,a.data.saved=!1,i.dropzone_media.push(a.data)),t("#bp-media-add-more").show(),t("#bp-media-submit").show(),t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var a in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[a].uuid){void 0===i.dropzone_media[a].saved||i.dropzone_media[a].saved||i.removeAttachment(i.dropzone_media[a].id),i.dropzone_media.splice(a,1);break}i.dropzone_obj.getAcceptedFiles().length?t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show():(t("#bp-media-uploader-modal-status-text").text(""),t("#bp-media-add-more").hide(),t("#bp-media-submit").hide())}))},openDocumentUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&t("div#media-uploader").length&&(t("#bp-media-uploader").hasClass("bp-media-document-uploader")&&this.folderLocationUI("#bp-media-uploader"),t("#bp-media-uploader").show(),i.dropzone_obj=new Dropzone("div#media-uploader",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("addedfile",function(){setTimeout(function(){i.dropzone_obj.getAcceptedFiles().length&&t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):i.dropzone_obj.removeFile(e)}),i.dropzone_obj.on("queuecomplete",function(){t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),i.dropzone_obj.on("processing",function(){t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),i.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i.dropzone_media.length,a.data.folder_id=i.album_id,a.data.group_id=i.group_id,a.data.saved=!1,i.dropzone_media.push(a.data)),t("#bp-media-document-add-more").show(),t("#bp-media-document-next").show(),t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var a in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[a].uuid){void 0===i.dropzone_media[a].saved||i.dropzone_media[a].saved||i.removeAttachment(i.dropzone_media[a].id),i.dropzone_media.splice(a,1);break}i.dropzone_obj.getAcceptedFiles().length?t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show():(t("#bp-media-uploader-modal-status-text").text(""),t("#bp-media-document-add-more").hide(),t("#bp-media-document-next").hide())}))},openDocumentFolderUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&t("div#bp-media-create-folder").length&&(t("#bp-media-create-folder").show(),i.dropzone_obj=new Dropzone("div#media-uploader-folder",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("addedfile",function(){setTimeout(function(){i.dropzone_obj.getAcceptedFiles().length&&t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):i.dropzone_obj.removeFile(e)}),i.dropzone_obj.on("queuecomplete",function(){t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),i.dropzone_obj.on("processing",function(){t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),i.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i.dropzone_media.length,a.data.folder_id=i.album_id,a.data.group_id=i.group_id,a.data.saved=!1,i.dropzone_media.push(a.data)),t("#bp-media-document-add-more").show(),t("#bp-media-document-submit").show(),t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var a in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[a].uuid){void 0===i.dropzone_media[a].saved||i.dropzone_media[a].saved||i.removeAttachment(i.dropzone_media[a].id),i.dropzone_media.splice(a,1);break}i.dropzone_obj.getAcceptedFiles().length?t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show():(t("#bp-media-uploader-modal-status-text").text(""),t("#bp-media-document-add-more").hide(),t("#bp-media-document-submit").hide())}))},openDocumentFolderChildUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&t("div#bp-media-create-child-folder").length&&(t("#bp-media-create-child-folder").show(),i.dropzone_obj=new Dropzone("div#media-uploader-child-folder",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("addedfile",function(){setTimeout(function(){i.dropzone_obj.getAcceptedFiles().length&&t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):i.dropzone_obj.removeFile(e)}),i.dropzone_obj.on("queuecomplete",function(){t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),i.dropzone_obj.on("processing",function(){t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),i.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i.dropzone_media.length,a.data.folder_id=i.album_id,a.data.group_id=i.group_id,a.data.saved=!1,i.dropzone_media.push(a.data)),t("#bp-media-document-add-more").show(),t("#bp-media-document-submit").show(),t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var a in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[a].uuid){void 0===i.dropzone_media[a].saved||i.dropzone_media[a].saved||i.removeAttachment(i.dropzone_media[a].id),i.dropzone_media.splice(a,1);break}i.dropzone_obj.getAcceptedFiles().length?t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show():(t("#bp-media-uploader-modal-status-text").text(""),t("#bp-media-document-add-more").hide(),t("#bp-media-document-submit").hide())}))},openDocumentMove:function(e){e.preventDefault();t(e.currentTarget).closest(".bb-activity-media-elem").find(".document-title").text();var i,a=t(e.currentTarget).attr("id"),o=t(e.currentTarget).attr("data-type");""!==a&&t.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"document_get_folder_view",id:a,type:o},success:function(a){if(i="#"+t(e.currentTarget).closest("li.activity-item").attr("id")+" .bp-media-move-file",t(i).find(".bp-document-move").attr("id",t(e.currentTarget).closest(".document-activity").attr("data-id")),t(e.currentTarget).closest(".media-folder_items").length>0){var o=t(e.currentTarget).closest(".media-folder_items").find(".media-folder_name").text();t(e.currentTarget).hasClass("ac-document-move")?t(i=".bp-media-move-file").find(".bp-document-move").attr("id",t(e.currentTarget).closest(".media-folder_items").attr("data-id")):t(i=".bp-media-move-folder").find(".bp-folder-move").attr("id",t(e.currentTarget).closest(".media-folder_items").attr("data-id"))}t(i).find(".location-folder-list-wrap .location-folder-list").remove(),t(i).find(".location-folder-list-wrap").append(a.data.html),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(i),t(i).find(".bb-model-header h4 .target_name").text(o),t(i).show()}})},closeDocumentMove:function(e){e.preventDefault();var i=jQuery(e.currentTarget).closest(".has-folderlocationUI");t(e.currentTarget).hasClass("ac-document-close-button")?t(e.currentTarget).closest(".bp-media-move-file").hide().find(".bp-document-move").attr("id",""):t(e.currentTarget).closest(".bp-media-move-folder").hide().find(".bp-folder-move").attr("id",""),i.find(".bp-document-move.loading").removeClass("loading"),this.clearFolderLocationUI(e)},renameDocument:function(e){var i=t(e.currentTarget).closest(".media-folder_items").find(".media-folder_name"),a=i.children("span").text();i.hide().siblings(".media-folder_name_edit_wrap").show().children(".media-folder_name_edit").val(a).focus().select()},editPrivacyDocument:function(e){t(e.currentTarget).closest(".media-folder_items").find(".media-folder_visibility").find(".media-folder_details__bottom span").hide().siblings("select").removeClass("hide")},editPrivacyDocumentSubmit:function(e){var i=t(e.currentTarget);"true"==i.data("mouseup")?(i.data("mouseup","false"),i.addClass("hide").siblings("span").show().text(i.find("option:selected").text())):i.data("mouseup","true")},renameDocumentSubmit:function(e){var i=t(e.currentTarget).closest(".media-folder_items").find(".media-folder_name_edit"),a=t(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > span"),o=t(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-id").attr("data-item-id"),d=t(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-attachment-id").attr("data-item-id"),s=t(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-type").attr("data-item-id"),n=i.val().trim(),r=/^[-\w^&'@{}[\],$=!#().%+~]+$/.exec(n),l=Boolean(r);if(l?i.removeClass("error"):i.addClass("error"),(t(e.currentTarget).hasClass("name_edit_cancel")||27==e.keyCode)&&(i.removeClass("error"),i.parent().hide().siblings(".media-folder_name").show()),t(e.currentTarget).hasClass("name_edit_save")||13==e.keyCode){if(!l)return;i.parent().addClass("submitting").append('<i class="animate-spin bb-icon-loader"></i>'),t.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"document_update_file_name",document_id:o,attachment_document_id:d,document_type:s,name:n},success:function(e){a.text(e.data.response.title),i.removeClass("submitting"),i.parent().find(".animate-spin").remove(),i.parent().hide().siblings(".media-folder_name").show()}})}e.preventDefault()},removeAttachment:function(e){var i={action:"media_delete_attachment",_wpnonce:BP_Nouveau.nonces.media,id:e};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i})},changeUploadModalTab:function(e){e.preventDefault();var i=t(e.currentTarget).data("content");t(".bp-media-upload-tab-content").hide(),t("#"+i).show(),this.current_tab=i,t(e.currentTarget).closest("#bp-media-uploader").find(".bp-media-upload-tab").removeClass("selected"),t(e.currentTarget).addClass("selected"),this.toggleSubmitMediaButton(),jQuery(window).scroll()},openCreateAlbumModal:function(e){e.preventDefault(),this.openUploader(e),t("#bp-media-create-album").show()},openCreateFolderModal:function(e){e.preventDefault(),this.openDocumentFolderUploader(e),this.folderLocationUI("#bp-media-create-folder"),t("#bp-media-create-folder").show()},openCreateFolderChildModal:function(e){e.preventDefault(),this.openDocumentFolderChildUploader(e),this.folderLocationUI("#bp-media-create-child-folder"),t("#bp-media-create-child-folder").show()},openEditFolderChildModal:function(e){e.preventDefault(),this.folderLocationUI("#bp-media-edit-child-folder"),t("#bp-media-edit-child-folder").show()},folderLocationUI:function(e){t(e).find(".bb-folder-destination").length>0&&(t(e).find(".location-folder-list-wrap").hasClass("is_loaded")||(t(document).on("click",e+" .bb-folder-destination",function(){t(this).parent().find(".location-folder-list-wrap").slideToggle()}),t(e).find(".location-folder-list-wrap").addClass("is_loaded"),t(document).on("click",e+" .location-folder-list li i",function(){t(this).closest(".location-folder-list-wrap").find(".location-folder-title").text(t(this).siblings("span").text()).siblings(".location-folder-back").css("display","inline-block"),t(this).siblings("ul").show().siblings("span, i").hide().parent().siblings().hide(),t(this).closest(".is_active").removeClass("is_active"),t(this).parent().addClass("is_active")}),t(document).on("click",e+" .location-folder-back",function(){t(this).siblings(".location-folder-list").find("li.is_active").parent().hasClass("location-folder-list")?(t(this).siblings(".location-folder-list").find("li.is_active").find("ul").hide().siblings("span, i").show().parent().removeClass("is_active").siblings().show(),t(this).siblings(".location-folder-title").text("Documents"),t(this).hide()):(t(this).siblings(".location-folder-list").find("li.is_active").find("ul").hide().siblings("span, i").show().parent().removeClass("is_active").addClass("is_active_old").parent().parent().closest(".has-ul").addClass("is_active"),t(this).siblings(".location-folder-list").find("li.is_active_old").siblings().show(),t(this).siblings(".location-folder-list").find("li.is_active.is_active_old").removeClass("is_active is_active_old"),t(this).siblings(".location-folder-title").text(t(this).parent().find("li.is_active>span").text())),t(this).closest(".has-folderlocationUI").find(".ac_document_search_folder").val("").trigger("change")}),t(e).on("click"," .location-folder-list li span",function(){t(this).hasClass("selected")&&!t(this).hasClass("disabled")?(t(this).removeClass("selected"),t(this).closest(".has-folderlocationUI").find(".bb-model-header h4 span.target_folder").text("..."),t(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(""),t(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val("0")):(t(this).closest(".location-folder-list-wrap-main").find(".location-folder-list li span").removeClass("selected"),t(this).addClass("selected"),t(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(t(this).text()),t(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val(t(this).parent().attr("data-id")),t(this).closest(".has-folderlocationUI").find(".bb-model-header h4 span.target_folder").text(" "+t(this).text()))}),t(document).on("keyup change",e+" .ac_document_search_folder",function(){var e=t(this).val();if(""==e)t(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap .location-folder-list").show().parent().siblings(".ac_document_search_folder_list").hide();else{t(this).closest(".has-folderlocationUI").find(".ac_document_search_folder_list ul").html(" ");var i="";t(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap ul.location-folder-list li.is_active").length>0&&(i=".is_active li"),t(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap ul.location-folder-list li"+i).each(function(){t(this).children("span").text().search(new RegExp(e,"i"))>=0&&t(this).closest(".has-folderlocationUI").find(".ac_document_search_folder_list ul").append('<li data-id="'+t(this).attr("data-id")+'"><span>'+t(this).children("span").text()+"</span></li>")}),t(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap .location-folder-list").hide().parent().siblings(".ac_document_search_folder_list").show(),e=""}}),t(e).find(".location-folder-list li > span.disabled").length&&t(e).find(".target_folder").text(t(e).find(".location-folder-list li > span.disabled").text())),t(e).find(".location-folder-list li").each(function(){t(this).children("ul").parent().addClass("has-ul").append('<i class="bb-icon-angle-right sub-menu-anchor"></i>')}))},clearFolderLocationUI:function(e){var t=jQuery(e.currentTarget).closest(".has-folderlocationUI");t.length>0&&(t.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),t.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").show().children("span, i").show(),t.find(".location-folder-title").text("Documents"),t.find(".location-folder-back").hide().closest(".has-folderlocationUI").find(".bb-folder-selected-id").val("0"),t.find(".ac_document_search_folder").val(""),t.find(".bb-model-header h4 span").text("..."),t.find(".ac_document_search_folder_list ul").html("").parent().hide().siblings(".location-folder-list-wrap").find(".location-folder-list").show())},closeCreateAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),t("#bp-media-create-album").hide(),t("#bb-album-title").val("")},closeCreateFolderModal:function(e){e.preventDefault(),this.closeUploader(e),t("#bp-media-create-folder, #bp-media-create-child-folder").hide(),t("#bb-album-title, #bb-album-child-title").val(""),t("#bp-media-create-folder .bb-folder-selected-id").val("0"),t("#bp-media-create-folder .bb-field-steps-1, #bp-media-create-child-folder .bb-field-steps-1").show().siblings(".bb-field-steps").hide()},closeEditFolderModal:function(e){e.preventDefault();var i=t(e.currentTarget).closest("#bp-media-edit-child-folder");t("#bp-media-edit-child-folder").hide(),i.find(".bb-field-steps-1").show().siblings(".bb-field-steps").hide(),this.clearFolderLocationUI(e)},submitMedia:function(e){var i,a=this,o=t(e.currentTarget),d=t("#bb-media-privacy"),s=0;if(e.preventDefault(),o.hasClass("saving"))return!1;if(o.addClass("saving"),!1===(s=a.album_id)&&(s=t(".bb-folder-selected-id").val()),"bp-dropzone-content"===a.current_tab){var n=t("#bp-media-post-content").val();i={action:"media_save",_wpnonce:BP_Nouveau.nonces.media,medias:a.dropzone_media,content:n,album_id:s,group_id:a.group_id,privacy:d.val()},t("#bp-dropzone-content .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(i){if(i.success){t("#media-stream ul.media-list").length||(t("#media-stream").html(t("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),t(".bb-photos-actions").show()),0===parseInt(s)&&bp.Nouveau.inject("#media-stream ul.media-list",i.data.media,"prepend"),t("#bp-media-post-content").val(""),t(".bb-folder-selected-id").val("0");for(var d=0;d<a.dropzone_media.length;d++)a.dropzone_media[d].saved=!0;a.closeUploader(e),jQuery(window).scroll()}else t("#bp-dropzone-content").prepend(i.data.feedback);o.removeClass("saving")}})}else if("bp-existing-media-content"===a.current_tab){var r=[];t('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){r.push(t(this).val())}),i={action:"media_move_to_album",_wpnonce:BP_Nouveau.nonces.media,medias:r,album_id:s,group_id:a.group_id},t("#bp-existing-media-content .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(i){i.success?(t("#media-stream ul.media-list").length||(t("#media-stream").html(t("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),t(".bb-photos-actions").show()),0===parseInt(s)&&bp.Nouveau.inject("#media-stream ul.media-list",i.data.media,"prepend"),t("#bp-media-post-content").val(""),t(".bb-folder-selected-id").val("0"),t('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){t(this).closest("li").data("id")===t(this).val()&&t(this).closest("li").remove()}),jQuery(window).scroll(),a.closeUploader(e)):t("#bp-existing-media-content").prepend(i.data.feedback),o.removeClass("saving")}})}else a.current_tab||(a.closeUploader(e),o.removeClass("saving"))},submitDocumentMedia:function(e){var i,a=this,o=t(e.currentTarget),d=0,s=t(e.currentTarget).closest("#bp-media-uploader");if(e.preventDefault(),o.hasClass("saving"))return!1;if(o.addClass("saving"),!1===(d=a.album_id)&&(d=t(".bb-folder-selected-id").val()),"bp-dropzone-content"===a.current_tab){var n=t("#bp-media-post-content").val();i={action:"document_document_save",_wpnonce:BP_Nouveau.nonces.media,medias:a.dropzone_media,content:n,folder_id:d,group_id:a.group_id},t("#bp-dropzone-content .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(i){if(i.success){t("#media-stream div#media-folder-document-data-table").length||(t("#media-stream").html(t("<div></div>").addClass("display")),t("#media-stream div").attr("id","media-folder-document-data-table"),t(".bb-photos-actions").show()),0===parseInt(d)&&bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",i.data.media,"prepend"),t("#bp-media-post-content").val(""),t(".bb-folder-selected-id").val("0");for(var n=0;n<a.dropzone_media.length;n++)a.dropzone_media[n].saved=!0;a.closeUploader(e),jQuery(window).scroll()}else t("#bp-dropzone-content").prepend(i.data.feedback);o.removeClass("saving"),s.find(".bb-field-steps").length&&(s.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),s.find("#bp-media-document-prev, #bp-media-document-submit").hide())}})}else if("bp-existing-media-content"===a.current_tab){var r=[];t('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){r.push(t(this).val())}),i={action:"media_move_to_album",_wpnonce:BP_Nouveau.nonces.media,medias:r,album_id:d,group_id:a.group_id},t("#bp-existing-media-content .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(i){i.success?(t("#media-stream ul.media-list").length||(t("#media-stream").html(t("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),t(".bb-photos-actions").show()),0===parseInt(d)&&bp.Nouveau.inject("#media-stream ul.media-list",i.data.media,"prepend"),t("#bp-media-post-content").val(""),t(".bb-folder-selected-id").val("0"),t('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){t(this).closest("li").data("id")===t(this).val()&&t(this).closest("li").remove()}),jQuery(window).scroll(),a.closeUploader(e)):t("#bp-existing-media-content").prepend(i.data.feedback),o.removeClass("saving"),s.find(".bb-field-steps").length&&(s.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),s.find("#bp-media-document-prev, #bp-media-document-submit").hide())}})}else a.current_tab||(a.closeUploader(e),o.removeClass("saving"))},saveAlbum:function(e){var i=t(e.currentTarget),a=this,o=t("#bb-album-title"),d=t("#bb-album-privacy");if(e.preventDefault(),""===t.trim(o.val()))return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===t.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),i.prop("disabled",!0);var s={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val(),medias:a.dropzone_media,privacy:d.val()};a.album_id&&(s.album_id=a.album_id),a.group_id&&(s.group_id=a.group_id),t(".bb-single-album-header .bp-feedback").remove(),t("#boss-media-create-album-popup .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(s){setTimeout(function(){i.prop("disabled",!1)},500),s.success?a.album_id?(t("#bp-single-album-title").text(o.val()),t("#bb-album-privacy").val(d.val()),a.cancelEditAlbumTitle(e)):(t("#buddypress .bb-albums-list").prepend(s.data.album),window.location.href=s.data.redirect_url):a.album_id?t("#bp-media-single-album").prepend(s.data.feedback):t("#boss-media-create-album-popup .bb-model-header").after(s.data.feedback)}})},saveFolder:function(e){var i=t(e.currentTarget),a=this,o=t("#bb-album-title"),d=t("#bb-folder-privacy");if(e.preventDefault(),""===t.trim(o.val()))return o.addClass("error"),!1;o.removeClass("error");var s=t("#boss-media-create-album-popup .bb-folder-selected-id").val();if(!a.group_id&&""===t.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),i.prop("disabled",!0).addClass("loading");var n={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val().trim(),medias:a.dropzone_media,privacy:d.val(),parent:s};a.album_id&&(n.album_id=a.album_id),a.group_id&&(n.group_id=a.group_id),t(".bb-single-album-header .bp-feedback").remove(),t("#boss-media-create-album-popup .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(s){setTimeout(function(){i.prop("disabled",!1)},500),s.success?a.album_id?(t("#bp-single-album-title").text(o.val()),t("#bb-folder-privacy").val(d.val()),a.cancelEditAlbumTitle(e)):(t("#buddypress .bb-albums-list").prepend(s.data.album),window.location.href=s.data.redirect_url):a.album_id?t("#bp-media-single-album").prepend(s.data.feedback):t("#boss-media-create-album-popup .bb-model-header").after(s.data.feedback)}})},saveChildFolder:function(e){var i=t(e.currentTarget),a=this,o=t("#bb-album-child-title"),d=t("#bb-folder-child-privacy"),s=t("#parent_id");if(e.preventDefault(),""===t.trim(o.val()))return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===t.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),i.prop("disabled",!0);var n={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val(),medias:a.dropzone_media,privacy:d.val(),parent:s.val()};a.album_id&&(n.folder_id=a.album_id),a.group_id&&(n.group_id=a.group_id),t(".bb-single-album-header .bp-feedback").remove(),t("#boss-media-create-album-popup .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(e){setTimeout(function(){i.prop("disabled",!1)},500),e.success?window.location.href=e.data.redirect_url:a.album_id?t("#bp-media-single-album").prepend(e.data.feedback):t("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},renameChildFolder:function(e){var i=t(e.currentTarget),a=this,o=t("#bp-media-edit-child-folder #bb-album-child-title"),d=t("#bp-media-edit-child-folder #bb-folder-privacy"),s=t("#bp-media-edit-child-folder #parent_id"),n=t("#bp-media-edit-child-folder .bb-folder-selected-id");if(""===t.trim(o.val()))return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===t.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),i.prop("disabled",!0);var r={action:"document_edit_folder",_wpnonce:BP_Nouveau.nonces.media,title:o.val(),privacy:d.val(),parent:s.val(),moveTo:n.val()};a.album_id&&(r.folder_id=a.album_id),a.group_id&&(r.group_id=a.group_id),t(".bb-single-album-header .bp-feedback").remove(),t("#boss-media-create-album-popup .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:r,success:function(e){setTimeout(function(){i.prop("disabled",!1)},500),e.success?window.location.href=e.data.redirect_url:a.album_id?t("#bp-media-single-album").prepend(e.data.feedback):t("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},deleteAlbum:function(e){if(e.preventDefault(),!this.album_id)return!1;if(!confirm(BP_Nouveau.media.i18n_strings.album_delete_confirm))return!1;t(e.currentTarget).prop("disabled",!0);var i={action:"media_album_delete",_wpnonce:BP_Nouveau.nonces.media,album_id:this.album_id,group_id:this.group_id};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(i){i.success?window.location.href=i.data.redirect_url:(alert(BP_Nouveau.media.i18n_strings.album_delete_error),t(e.currentTarget).prop("disabled",!1))}})},deleteFolder:function(e){if(e.preventDefault(),!this.album_id)return!1;if(!confirm(BP_Nouveau.media.i18n_strings.folder_delete_confirm))return!1;t(e.currentTarget).prop("disabled",!0);var i={action:"media_folder_delete",_wpnonce:BP_Nouveau.nonces.media,album_id:this.album_id,group_id:this.group_id};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(i){i.success?window.location.href=i.data.redirect_url:(alert(BP_Nouveau.media.i18n_strings.folder_delete_error),t(e.currentTarget).prop("disabled",!1))}})},addMediaIdsToGroupMessagesForm:function(){var e=this;t("#bp_group_messages_media").length&&t("#bp_group_messages_media").val(JSON.stringify(e.dropzone_media))},injectMedias:function(e){var i=bp.Nouveau.getStorage("bp-media"),a=i.scope||null,o=i.filter||null;if(t(e.currentTarget).hasClass("load-more")){var d=1*Number(this.current_page)+1,s=this,n="";e.preventDefault(),t(e.currentTarget).find("a").first().addClass("loading"),t("#buddypress .dir-search input[type=search]").length&&(n=t("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:a,filter:o,search_terms:n,page:d,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(i){!0===i.success&&(t(e.currentTarget).remove(),s.current_page=d,jQuery(window).scroll())})}},injectDocuments:function(e){var i=bp.Nouveau.getStorage("bp-media"),a=i.scope||null,o=i.filter||null,d=t(e.currentTarget);if(d.hasClass("load-more")){var s=1*Number(this.current_page)+1,n=this,r="";e.preventDefault(),d.find("a").first().addClass("loading"),t("#buddypress .dir-search input[type=search]").length&&(r=t("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"document",scope:a,filter:o,search_terms:r,page:s,method:"append",target:"#buddypress [data-bp-list] div#media-folder-document-data-table"}).done(function(e){!0===e.success&&(d.parent(".pager").remove(),n.current_page=s,jQuery(window).scroll())})}},sortDocuments:function(e){var i=t(e.currentTarget),a=i.data("target"),o="",d="date_created",s="",n=i.attr("class");switch(a){case"name":d="title";break;case"modified":d="date_created";break;case"visibility":d="privacy"}i.hasClass("asce")?i.removeClass("asce"):i.addClass("asce");var s=i.hasClass("asce")?"DESC":"ASC",r=bp.Nouveau.getStorage("bp-document"),l=r.scope||null,c=r.filter||null;t(e.currentTarget);t("#buddypress .dir-search input[type=search]").length&&(o=t("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"document",scope:l,filter:c,search_terms:o,page:1,order_by:d,sort:s,method:"reset",target:"#buddypress [data-bp-list]"}).done(function(e){setTimeout(function(){currentFilterTarget="."+n.replace(" ","."),t(currentFilterTarget).hasClass("asce")?t(currentFilterTarget).removeClass("asce"):t(currentFilterTarget).addClass("asce")},300)})},documentPopupNavigate:function(e){e.preventDefault();var i=t(e.currentTarget),a=i.closest(".bb-field-steps"),o=0==i.closest(".bp-document-listing").length?"#bb-album-child-title":"#bb-album-title";i.closest(".document-options").length&&(o="#bb-album-title"),i.hasClass("bb-field-steps-next")&&""==a.find(o).val().trim()?a.find(o).addClass("error"):(a.find(o).removeClass("error"),a.slideUp(200).siblings(".bb-field-steps").slideDown(200))},uploadDocumentNavigate:function(e){e.preventDefault();var i=t(e.currentTarget),a=t(i).closest("#bp-media-uploader");t(i).hasClass("bb-field-uploader-next")?(a.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),a.find("#bp-media-document-submit, #bp-media-document-prev").show(),a.find("#bp-media-document-add-more").hide()):(t(i).hide(),a.find("#bp-media-document-submit, #bp-media-document-prev").hide(),a.find("#bp-media-document-add-more").show(),a.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200))},appendMedia:function(e){var i=bp.Nouveau.getStorage("bp-media"),a=i.scope||null,o=i.filter||null;if(t(e.currentTarget).hasClass("load-more")){var d=1*Number(this.current_page_existing_media)+1,s=this,n="";e.preventDefault(),t(e.currentTarget).find("a").first().addClass("loading"),t("#buddypress .dir-search input[type=search]").length&&(n=t("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:a,filter:o,search_terms:n,page:d,method:"append",caller:"bp-existing-media",target:".bp-existing-media-wrap ul.bp-list"}).done(function(i){!0===i.success&&(t(e.currentTarget).remove(),s.current_page_existing_media=d)})}},appendAlbums:function(e){var i=1*Number(this.current_page_albums)+1,a=this;e.preventDefault(),t(e.currentTarget).find("a").first().addClass("loading");var o={action:"media_albums_loader",_wpnonce:BP_Nouveau.nonces.media,page:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(o){!0===o.success&&(t(e.currentTarget).remove(),t("#albums-dir-list ul.bb-albums-list").fadeOut(100,function(){t("#albums-dir-list ul.bb-albums-list").append(o.data.albums),t(this).fadeIn(100)}),a.current_page_albums=i)}})},toggleSubmitMediaButton:function(){var e=t("#bp-media-submit"),i=t("#bp-media-add-more");"bp-dropzone-content"===this.current_tab?this.dropzone_obj.getAcceptedFiles().length?(e.show(),i.show()):(e.hide(),i.hide()):"bp-existing-media-content"===this.current_tab&&(t('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').length?e.show():e.hide(),i.hide())},playVideo:function(e){e.preventDefault();var i=t(e.currentTarget).find("video").get(0),a=t(e.currentTarget).find(".gif-play-button");1==i.paused?(i.play(),a.hide()):(i.pause(),a.show())},autoPlayGifVideos:function(){t(".gif-player").each(function(){var e=t(this).find("video").get(0),i=t(this).find(".gif-play-button");t(this).is(":in-viewport")?(e.play(),i.hide()):(e.pause(),i.show())})},fileActionButton:function(e){t(e.currentTarget).parent().hasClass("download_file")||(e.preventDefault(),t(e.currentTarget).closest(".media-folder_items").toggleClass("is-visible").siblings(".media-folder_items").removeClass("is-visible"))},copyDownloadLink:function(e){var i=e.currentTarget;t("body").append('<textarea style="position:absolute;opacity:0;" id="document_copy_link"></textarea>'),t("#document_copy_link").val(t(i).attr("href")),t("#document_copy_link").select(),document.execCommand("copy"),t("#document_copy_link").remove(),e.preventDefault()},fileActivityActionButton:function(e){e.preventDefault(),t(e.currentTarget).closest(".bb-activity-media-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-media-elem").removeClass("is-visible"),"a"!=e.currentTarget.tagName.toLowerCase()||t(e.currentTarget).hasClass("document-action_more")||t(e.currentTarget).closest(".bb-activity-media-elem").removeClass("is-visible")},toggleFileActivityActionButton:function(e){var i;return(e=e||window.event).target?i=e.target:e.srcElement&&(i=e.srcElement),3===i.nodeType&&(i=i.parentNode),!0===e.altKey||!0===e.metaKey?e:t(i).hasClass("document-action_more")||t(i).parent().hasClass("document-action_more")||t(i).hasClass("media-folder_action__anchor")||t(i).parent().hasClass("media-folder_action__anchor")?e:(t(".bb-activity-media-elem.is-visible").removeClass("is-visible"),void t(".media-folder_items.is-visible").removeClass("is-visible"))},expandCodePreview:function(e){e.preventDefault(),t(e.currentTarget).closest(".document-activity").addClass("code-full-view")},collapseCodePreview:function(e){e.preventDefault(),t(e.currentTarget).closest(".document-activity").removeClass("code-full-view")},documentCodeMirror:function(){t(".document-text:not(.loaded)").each(function(){var e=t(this),i=e.attr("data-extension"),a=e.attr("data-extension");if("html"!=i&&"htm"!=i||(a="text/html"),"js"==i)CodeMirror(e[0],{value:e.find(".document-text-file-data-hidden").val(),lineNumbers:!0,theme:"default",readOnly:!0,lineWrapping:!0});else CodeMirror(e[0],{value:e.find(".document-text-file-data-hidden").val(),mode:a,lineNumbers:!0,theme:"default",readOnly:!0,lineWrapping:!0});e.addClass("loaded"),e.parent().height()>150&&e.closest(".document-text-wrap").addClass("is_large")}),t(".bb-activity-media-elem.document-activity").closest(".activity-inner").hasClass("documemt-activity")||t(".bb-activity-media-elem.document-activity").closest(".activity-content").addClass("documemt-activity")}},bp.Nouveau.Media.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.medias=[],this.current_media=!1,this.current_index=0,this.is_open=!1,this.nextLink=t(".bb-next-media"),this.previousLink=t(".bb-prev-media"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id},addListeners:function(){t(document).on("click",".bb-open-media-theatre",this.openTheatre.bind(this)),t(document).on("click",".bb-open-document-theatre",this.openDocumentTheatre.bind(this)),t(document).on("click",".bb-close-media-theatre",this.closeTheatre.bind(this)),t(document).on("click",".bb-close-document-theatre",this.closeDocumentTheatre.bind(this)),t(document).on("click",".bb-prev-media",this.previous.bind(this)),t(document).on("click",".bb-next-media",this.next.bind(this)),t(document).on("bp_activity_ajax_delete_request",this.activityDeleted.bind(this)),t(document).on("click","#bb-media-model-container .media-privacy>li",this.mediaPrivacyChange.bind(this)),t(document).on("click","#bb-media-model-container .bb-media-section span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),t(document).click(this.togglePopupDropdown)},documentClick:function(e){var t=this;if(t.is_open){var i=e.target,a=document.getElementById("bb-media-model-container");null!=a&&!a.contains(i)&&document.body.contains(i)&&t.closeTheatre(e)}},checkPressedKey:function(e){var t=this;switch((e=e||window.event).keyCode){case 27:t.closeTheatre(e);break;case 37:t.previous(e);break;case 39:t.next(e)}},checkPressedKeyDocuments:function(e){27==(e=e||window.event).keyCode&&bp.Nouveau.Media.Theatre.closeDocumentTheatre(e)},openTheatre:function(e){e.preventDefault();var i,a=t(e.currentTarget),o=this;if(a.closest("#bp-existing-media-content").length)return!1;o.setupGlobals(),o.setMedias(a),i=a.data("id"),o.setCurrentMedia(i),o.showMedia(),o.navigationCommands(),o.getActivity(),t(".bb-media-model-wrapper").show(),o.is_open=!0,document.addEventListener("keyup",o.checkPressedKey.bind(o))},openDocumentTheatre:function(e){e.preventDefault();var i=t(e.currentTarget),a=this,o=t(i).closest(".bb-media-container").length?t(i).closest(".bb-media-container").find(".document-theatre"):t(i).closest(".directory.document").find(".document-theatre");"css"==i.attr("data-extension")||"txt"==i.attr("data-extension")||"js"==i.attr("data-extension")||"html"==i.attr("data-extension")||"htm"==i.attr("data-extension")||"csv"==i.attr("data-extension")?t.get(i.attr("data-text-preview"),function(e){o.find(".bb-media-section").html("<h3>"+i.text()+'</h3><div class="document-text"><textarea class="document-text-file-data-hidden"></textarea></div>'),o.find(".bb-media-section .document-text").attr("data-extension",i.attr("data-extension")),o.find(".bb-media-section .document-text textarea").html(e.replace("n","")),bp.Nouveau.Media.documentCodeMirror()}):o.find(".bb-media-section").html("<h3>"+i.text()+'</h3><div class="img-section"> <img src="'+i.attr("data-preview")+'" /> </div>');var d=i.closest(".media-folder_items").data("activity-id");bp.Nouveau.Media.Theatre.getDocumentActivity(d),a.is_open=!0,t(".document-theatre").show(),document.addEventListener("keyup",bp.Nouveau.Media.Theatre.checkPressedKeyDocuments(e))},getDocumentActivity:function(e){if(e){t(".bb-document-theater .bb-media-info-section").show();var i=this;t(".bb-media-info-section .activity-list").addClass("loading").html('<i class="dashicons dashicons-update animate-spin"></i>'),i.activity_ajax=t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_activity",id:e,nonce:BP_Nouveau.nonces.media},success:function(e){e.success&&(t(".bb-media-info-section .activity-list").removeClass("loading").html(e.data.activity),t(".bb-media-info-section").show(),jQuery(window).scroll())}})}else t(".bb-document-theater .bb-media-info-section").hide()},closeTheatre:function(e){e.preventDefault();var i=this;t(".bb-media-model-wrapper").hide(),i.is_open=!1,document.removeEventListener("keyup",i.checkPressedKey.bind(i))},closeDocumentTheatre:function(e){e.preventDefault();var i=this,a=t(e.currentTarget),o=t(a).closest(".bb-media-container").find(".document-theatre");o.find(".bb-media-section").html(""),o.hide(),i.is_open=!1,document.removeEventListener("keyup",bp.Nouveau.Media.Theatre.checkPressedKeyDocuments(e))},setMedias:function(e){var i=t(".bb-open-media-theatre"),a=0,o=this;if(t("body").hasClass("activity")&&(i=t(e).closest(".bb-activity-media-wrap").find(".bb-open-media-theatre")),void 0!==i)for(o.medias=[],a=0;a<i.length;a++){var d=t(i[a]);if(!d.closest("#bp-existing-media-content").length){var s={id:d.data("id"),attachment:d.data("attachment-full"),activity_id:d.data("activity-id"),privacy:d.data("privacy"),parent_activity_id:d.data("parent-activity-id"),album_id:d.data("album-id"),group_id:d.data("group-id"),is_forum:!1};d.closest(".forums-media-wrap").length&&(s.is_forum=!0),void 0!==s.privacy&&"message"==s.privacy?s.is_message=!0:s.is_message=!1,o.medias.push(s)}}},setCurrentMedia:function(e){var t=this,i=0;for(i=0;i<t.medias.length;i++)if(e===t.medias[i].id){t.current_media=t.medias[i],t.current_index=i;break}},showMedia:function(){var e=this;if(void 0===e.current_media)return!1;t(".bb-media-model-wrapper .bb-media-section").find("img").attr("src",e.current_media.attachment+"?"+(new Date).getTime());var i=t(".bb-media-section .bb-media-privacy-wrap");if(i.length){i.show(),i.find("ul.media-privacy li").removeClass("selected"),i.find(".bp-tooltip").attr("data-bp-tooltip","");var a=i.find("ul.media-privacy").find("li[data-value="+e.current_media.privacy+"]");a.addClass("selected"),i.find(".bp-tooltip").attr("data-bp-tooltip",a.text()),i.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_media.privacy),(void 0!==BP_Nouveau.activity&&void 0!==e.current_media.activity_id&&0!=e.current_media.activity_id||e.group_id||e.current_media.is_forum||e.current_media.group_id||e.current_media.album_id||e.current_media.is_message)&&i.hide()}e.navigationCommands()},next:function(e){e.preventDefault();var t,i=this;void 0!==i.medias[i.current_index+1]?(i.current_index=i.current_index+1,t=i.current_media.activity_id,i.current_media=i.medias[i.current_index],i.showMedia(),t!=i.current_media.activity_id&&i.getActivity()):i.nextLink.hide()},previous:function(e){e.preventDefault();var t,i=this;void 0!==i.medias[i.current_index-1]?(i.current_index=i.current_index-1,t=i.current_media.activity_id,i.current_media=i.medias[i.current_index],i.showMedia(),t!=i.current_media.activity_id&&i.getActivity()):i.previousLink.hide()},navigationCommands:function(){var e=this;0==e.current_index&&e.current_index!=e.medias.length-1?(e.previousLink.hide(),e.nextLink.show()):0==e.current_index&&e.current_index==e.medias.length-1?(e.previousLink.hide(),e.nextLink.hide()):e.current_index==e.medias.length-1?(e.previousLink.show(),e.nextLink.hide()):(e.previousLink.show(),e.nextLink.show())},getActivity:function(){var e=this;t(".bb-media-info-section .activity-list").addClass("loading").html('<i class="dashicons dashicons-update animate-spin"></i>'),void 0!==BP_Nouveau.activity&&e.current_media&&void 0!==e.current_media.activity_id&&0!=e.current_media.activity_id&&!e.current_media.is_forum?(0!=e.activity_ajax&&e.activity_ajax.abort(),e.activity_ajax=t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_activity",id:e.current_media.activity_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success&&(t(".bb-media-info-section .activity-list").removeClass("loading").html(e.data.activity),t(".bb-media-info-section").show(),jQuery(window).scroll())}})):t(".bb-media-info-section").hide()},activityDeleted:function(e,i){var a=this,o=0;if(a.is_open&&void 0!==i&&"delete_activity"===i.action&&a.current_media.activity_id==i.id){for(t(document).find('[data-bp-list="media"] .bb-open-media-theatre[data-id="'+a.current_media.id+'"]').closest("li").remove(),t(document).find('[data-bp-list="activity"] .bb-open-media-theatre[data-id="'+a.current_media.id+'"]').closest(".bb-activity-media-elem").remove(),o=0;o<a.medias.length;o++)if(a.medias[o].activity_id==i.id){a.medias.splice(o,1);break}0==a.current_index&&a.current_index!=a.medias.length?(a.current_index=-1,a.next(e)):0==a.current_index&&a.current_index==a.medias.length?a.closeTheatre(e):a.current_index==a.medias.length?a.previous(e):(a.current_index=-1,a.next(e))}},togglePopupDropdown:function(e){var i;return(e=e||window.event).target?i=e.target:e.srcElement&&(i=e.srcElement),3===i.nodeType&&(i=i.parentNode),!0===e.altKey||!0===e.metaKey?e:t(i).hasClass("privacy-wrap")||t(i).parent().hasClass("privacy-wrap")?e:void t("ul.media-privacy").removeClass("bb-open")},togglePrivacyDropdown:function(e){var i=t(e.target);e.preventDefault(),i.closest(".bb-media-privacy-wrap").find(".media-privacy").toggleClass("bb-open")},mediaPrivacyChange:function(e){var i=t(e.target),a=this,o=i.data("value"),d="public";if(e.preventDefault(),i.hasClass("selected"))return!1;i.closest(".bb-media-privacy-wrap").find(".privacy").addClass("loading"),d=i.closest(".bb-media-privacy-wrap").find("ul.media-privacy li.selected").data("value"),i.closest(".bb-media-privacy-wrap").find("ul.media-privacy li").removeClass("selected"),i.addClass("selected"),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_update_privacy",id:a.current_media.id,_wpnonce:BP_Nouveau.nonces.media,privacy:o},success:function(){i.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading").removeClass(d),i.closest(".bb-media-privacy-wrap").find(".privacy").addClass(o),i.closest(".bb-media-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",i.text())},error:function(){i.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading")}})}},bp.Nouveau.Media.start(),bp.Nouveau.Media.Theatre.start())}(bp,jQuery);