window.bp=window.bp||{},function(u){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Media={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){var e=u("body");this.current_page=1,this.current_page_existing_media=1,this.current_page_albums=1,this.current_tab=!e.hasClass("single-topic")&&!e.hasClass("single-forum")&&"bp-dropzone-content",this.sort_by="",this.order_by="",this.currentTargetParent=BP_Nouveau.media.current_folder,this.moveToIdPopup=BP_Nouveau.media.move_to_id_popup,this.moveToTypePopup=BP_Nouveau.media.current_type,void 0!==window.Dropzone&&(window.Dropzone.autoDiscover=!1),this.documentOptions={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:BP_Nouveau.media.document_type,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,accept:function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()},success:function(e,t){if(t.success)return e.previewElement.classList.add("dz-success");var i,a,o,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],a=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;a<o;a++)i=d[a],s.push(i.textContent=n);return s}},u("#bp-media-uploader").hasClass("bp-media-document-uploader")?this.options={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:BP_Nouveau.media.document_type,autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2,accept:function(e,t){0==e.size?t(BP_Nouveau.media.empty_document_type):t()},success:function(e,t){if(t.success)return e.previewElement.classList.add("dz-success");var i,a,o,d,s,n=t.data.feedback;for(e.previewElement.classList.add("dz-error"),s=[],a=0,o=(d=e.previewElement.querySelectorAll("[data-dz-errormessage]")).length;a<o;a++)i=d[a],s.push(i.textContent=n);return s}}:this.options={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},void 0!==BP_Nouveau.media.dropzone_options&&Object.assign(this.options,BP_Nouveau.media.dropzone_options),this.dropzone_obj=[],this.dropzone_media=[],this.album_id=void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,this.group_id=void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,this.bbp_is_reply_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_reply_edit&&window.BP_Forums_Nouveau.media.bbp_is_reply_edit,this.bbp_is_topic_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_topic_edit&&window.BP_Forums_Nouveau.media.bbp_is_topic_edit,this.bbp_is_forum_edit=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.bbp_is_forum_edit&&window.BP_Forums_Nouveau.media.bbp_is_forum_edit,this.bbp_reply_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_media?window.BP_Forums_Nouveau.media.reply_edit_media:[],this.bbp_reply_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_document?window.BP_Forums_Nouveau.media.reply_edit_document:[],this.bbp_topic_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_media?window.BP_Forums_Nouveau.media.topic_edit_media:[],this.bbp_topic_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_document?window.BP_Forums_Nouveau.media.topic_edit_document:[],this.bbp_forum_edit_media=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_media?window.BP_Forums_Nouveau.media.forum_edit_media:[],this.bbp_forum_edit_document=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_document?window.BP_Forums_Nouveau.media.forum_edit_document:[],this.bbp_reply_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.reply_edit_gif_data?window.BP_Forums_Nouveau.media.reply_edit_gif_data:[],this.bbp_topic_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.topic_edit_gif_data?window.BP_Forums_Nouveau.media.topic_edit_gif_data:[],this.bbp_forum_edit_gif_data=void 0!==window.BP_Forums_Nouveau&&void 0!==window.BP_Forums_Nouveau.media.forum_edit_gif_data?window.BP_Forums_Nouveau.media.forum_edit_gif_data:[],this.giphy=null,this.gif_offset=0,this.gif_q=null,this.gif_limit=20,this.gif_requests=[],this.gif_data=[],this.gif_container_key=!1,bp.Nouveau.Media.documentCodeMirror(),u(window).on("scroll resize",function(){bp.Nouveau.Media.documentCodeMirror()})},addListeners:function(){var e=u(".bp-nouveau"),t=u(".bp-existing-media-wrap");e.on("click","#bp-add-media",this.openUploader.bind(this)),e.on("click","#bp-add-document",this.openDocumentUploader.bind(this)),e.on("click","#bp-media-submit",this.submitMedia.bind(this)),e.on("click","#bp-media-document-submit",this.submitDocumentMedia.bind(this)),e.on("click","#bp-media-uploader-close",this.closeUploader.bind(this)),e.on("click","#bb-delete-media",this.deleteMedia.bind(this)),e.on("click","#bb-select-deselect-all-media",this.toggleSelectAllMedia.bind(this)),u('#buddypress [data-bp-list="media"]').on("bp_ajax_request",this.bp_ajax_media_request),e.on("click","#bb-create-album",this.openCreateAlbumModal.bind(this)),e.on("click","#bb-create-folder",this.openCreateFolderModal.bind(this)),e.on("click","#bb-create-folder-child",this.openCreateFolderChildModal.bind(this)),e.on("click","#bp-edit-folder-open",this.openEditFolderChildModal.bind(this)),e.on("click","#bp-media-create-album-submit",this.saveAlbum.bind(this)),e.on("click","#bp-media-create-folder-submit",this.saveFolder.bind(this)),e.on("click","#bp-media-create-child-folder-submit",this.saveChildFolder.bind(this)),e.on("click","#bp-media-create-album-close",this.closeCreateAlbumModal.bind(this)),e.on("click","#bp-media-create-folder-close",this.closeCreateFolderModal.bind(this)),e.on("click","#bp-media-edit-folder-close",this.closeEditFolderModal.bind(this)),e.on("click","#bp-media-add-more",this.triggerDropzoneSelectFileDialog.bind(this)),u("#bp-media-uploader").on("click",".bp-media-upload-tab",this.changeUploadModalTab.bind(this)),u('.bp-nouveau [data-bp-list="media"]').on("click","li.load-more",this.injectMedias.bind(this)),u(".bp-nouveau #albums-dir-list").on("click","li.load-more",this.appendAlbums.bind(this)),t.on("click","li.load-more",this.appendMedia.bind(this)),e.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.addSelectedClassToWrapper.bind(this)),t.on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.toggleSubmitMediaButton.bind(this)),e.on("click","#bp-edit-album-title",this.editAlbumTitle.bind(this)),e.on("click","#bp-edit-folder-title",this.editFolderTitle.bind(this)),e.on("click","#bp-cancel-edit-album-title",this.cancelEditAlbumTitle.bind(this)),e.on("click","#bp-save-album-title",this.saveAlbum.bind(this)),e.on("click","#bp-save-folder-title",this.saveFolder.bind(this)),e.on("change","#bp-media-single-album select#bb-album-privacy",this.saveAlbum.bind(this)),e.on("change","#media-stream select#bb-folder-privacy",this.savePrivacy.bind(this)),e.on("click","#bb-delete-album",this.deleteAlbum.bind(this)),e.on("click","#bb-delete-folder",this.deleteFolder.bind(this)),u(document).on("click","#forums-media-button",this.openForumsUploader.bind(this)),u(document).on("click","#forums-document-button",this.openForumsDocumentUploader.bind(this)),u(document).on("click","#forums-gif-button",this.toggleGifSelector.bind(this)),u(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("keyup",".search-query-input",this.searchGif.bind(this)),u(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),u(document).find("form #whats-new-toolbar .gif-search-results, .forum form #whats-new-toolbar .gif-search-results").scroll(this.loadMoreGif.bind(this)),u(".buddypress.groups.messages").length||u(document).find("form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),u(document).find("form #whats-new-attachments .forums-attached-gif-container .gif-search-results, .forum form #whats-new-attachments .forums-attached-gif-container .gif-search-results").scroll(this.loadMoreGif.bind(this)),u(document).find("form #whats-new-attachments .forums-attached-gif-container, .forum form #whats-new-attachments .forums-attached-gif-container").on("click",".gif-image-remove",this.removeSelectedGif.bind(this)),u(document).on("click",".gif-image-container",this.playVideo.bind(this)),u(document).on("click",".directory.document  .media-folder_action__anchor, .directory.document  .media-folder_action__anchor li a, .bb-media-container .media-folder_action__anchor, .bb-media-container  .media-folder_action__list li a",this.fileActionButton.bind(this)),u(document).on("click",".media-folder_action__list .copy_download_file_url a",this.copyDownloadLink.bind(this)),u(document).on("click",".bb-activity-media-elem.document-activity .document-action-wrap .document-action_more, .bb-activity-media-elem.document-activity .document-action-wrap .document-action_list li a",this.fileActivityActionButton.bind(this)),u(document).click(this.toggleFileActivityActionButton),u(document).on("click",".bb-activity-media-elem.document-activity .document-expand .document-expand-anchor",this.expandCodePreview.bind(this)),u(document).on("click",".bb-activity-media-elem.document-activity .document-action-wrap .document-action_collapse",this.collapseCodePreview.bind(this)),u(document).on("click",".activity .bp-document-move-activity, #media-stream .bp-document-move-activity",this.moveDocumentIntoFolder.bind(this)),u(document).on("click",'.bp-nouveau [data-bp-list="document"] .pager .dt-more-container.load-more',this.injectDocuments.bind(this)),u(document).on("click",'.bp-nouveau [data-bp-list="document"] .data-head',this.sortDocuments.bind(this)),u(document).on("click",".modal-container .bb-field-steps-actions",this.documentPopupNavigate.bind(this)),u(document).on("click",".modal-container .bb-field-uploader-actions",this.uploadDocumentNavigate.bind(this)),u(document).on("click",".modal-container #bp-media-edit-child-folder-submit",this.renameChildFolder.bind(this));var i=u("#bb-media-model-container .activity-list, #media-stream");u('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream').on("click",".ac-document-move, .ac-folder-move",this.openDocumentMove.bind(this)),u('#buddypress .activity-list, #buddypress [data-bp-list="activity"], #bb-media-model-container .activity-list, #media-stream').on("click",".ac-document-close-button, .ac-folder-close-button",this.closeDocumentMove.bind(this)),i.on("click",".ac-document-rename",this.renameDocument.bind(this)),i.on("click",".ac-document-privacy",this.editPrivacyDocument.bind(this)),i.on("mouseup","#bb-folder-privacy",this.editPrivacyDocumentSubmit.bind(this)),i.on("keyup",".media-folder_name_edit",this.renameDocumentSubmit.bind(this)),i.on("click",".name_edit_cancel, .name_edit_save",this.renameDocumentSubmit.bind(this)),u(document).on("click",".document-file-delete",this.deleteDocument.bind(this)),u(document).on("click",".bp-folder-move",this.folderMove.bind(this)),u(document).on("click",".bp-document-open-create-popup-folder",this.createFolderInPopup.bind(this)),u(document).on("click",".close-create-popup-folder",this.closeCreateFolderInPopup.bind(this)),u(document).on("click",".bp-document-create-popup-folder-submit",this.submitCreateFolderInPopup.bind(this));var a=u(".buddypress.groups.messages"),o=u(".buddypress.groups.messages form#send_group_message_form #whats-new-toolbar"),d=u(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container .gif-search-results"),s=u(".buddypress.groups.messages form#send_group_message_form #whats-new-attachments .bp-group-messages-attached-gif-container");a.on("click","#bp-group-messages-media-button",this.openGroupMessagesUploader.bind(this)),a.on("click","#bp-group-messages-document-button",this.openGroupMessagesDocumentUploader.bind(this)),a.on("click","#bp-group-messages-gif-button",this.toggleGroupMessagesGifSelector.bind(this)),o.on("keyup",".search-query-input",this.searchGroupMessagesGif.bind(this)),o.on("click",".found-media-item",this.selectGroupMessagesGif.bind(this)),d.scroll(this.loadMoreGroupMessagesGif.bind(this)),u(".groups.messages form#send_group_message_form #whats-new-toolbar .bp-group-messages-attached-gif-container .gif-search-results").scroll(this.loadMoreGroupMessagesGif.bind(this)),s.on("click",".gif-image-remove",this.removeGroupMessagesSelectedGif.bind(this)),u(document).on("click",".gif-image-container",this.playVideo.bind(this)),_.isUndefined(BP_Nouveau.media.gif_api_key)||(window.addEventListener("scroll",this.autoPlayGifVideos,!1),window.addEventListener("resize",this.autoPlayGifVideos,!1)),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&u("#forums-media-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&u("#forums-document-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(Object.keys(this.bbp_reply_edit_gif_data).length||Object.keys(this.bbp_topic_edit_gif_data).length||Object.keys(this.bbp_forum_edit_gif_data).length)&&this.editGifPreview()},submitCreateFolderInPopup:function(e){e.preventDefault();var t=this.currentTargetParent,i=0,a=u(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-folder-title").val(),o="",d=u(e.currentTarget).closest(".modal-container");if("group"===this.moveToTypePopup?(o="grouponly",i=this.moveToIdPopup):o=u(e.currentTarget).closest(".modal-container").find(".popup-on-fly-create-folder .bb-folder-child-privacy").val(),""===a)return alert(BP_Nouveau.media.create_folder_error_title),!1;var s={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:a,privacy:o,parent:t,group_id:i};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){e.success&&(u(".document-data-table-head").length&&(0!==t&&"0"!==t&&t!==parseInt(BP_Nouveau.media.current_folder)||(bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"),jQuery(window).scroll())),d.find(".location-folder-list-wrap .location-folder-list").remove(),d.find(".location-folder-list-wrap").append(e.data.tree_view),bp.Nouveau.Media.folderLocationUI&&(console.log("come"),console.log(d),console.log(t),bp.Nouveau.Media.folderLocationUI(d,t)),d.find(".bb-model-footer").show(),d.find(".bb-field-wrap-search").show(),d.find(".bp-document-open-create-popup-folder").show(),d.find(".location-folder-list-wrap-main").show(),d.find(".create-popup-folder-wrap").hide())}})},closeCreateFolderInPopup:function(e){e.preventDefault(),u(".modal-container .bb-model-footer").show(),u(".bb-field-wrap-search").show(),u(".bp-document-open-create-popup-folder").show(),u(".location-folder-list-wrap-main").show(),u(".create-popup-folder-wrap").hide()},createFolderInPopup:function(e){e.preventDefault(),u(".modal-container .bb-model-footer").hide(),u(".bb-field-wrap-search").hide(),u(".bp-document-open-create-popup-folder").hide(),u(".location-folder-list-wrap-main").hide(),u(".create-popup-folder-wrap").show()},savePrivacy:function(e){var t,i,a,o,d=u(e.currentTarget);e.preventDefault(),t=parseInt(d.data("item-id")),i=d.data("item-type"),a=d.val(),0<t&&(o={action:"document_save_privacy",itemId:t,type:i,value:a},u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(e){e.success}}))},folderMove:function(e){var t=u(e.currentTarget);e.preventDefault();var i=t.attr("id"),a=u("#media-folder-document-data-table #bp-media-move-folder .modal-mask .modal-wrapper #boss-media-create-album-popup .bb-field-wrap .bb-folder-selected-id").val();if(""===i||""===a)return alert(BP_Nouveau.media.i18n_strings.folder_move_error),!1;var o={action:"document_folder_move",currentFolderId:i,folderMoveToId:a};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(e){var t;e.success&&((t=u("#media-stream")).html(""),t.html(e.data.html))}})},deleteDocument:function(e){var t=u(e.currentTarget);e.preventDefault();var i=t.attr("data-type"),a=t.attr("data-item-id"),o=t.attr("data-item-attachment-id"),d=t.attr("data-item-preview-attachment-id"),s=[];if("activity"!==t.attr("data-item-from")){if("folder"===i){if(!confirm(BP_Nouveau.media.i18n_strings.folder_delete_confirm))return!1}else if("document"===i&&!confirm(BP_Nouveau.media.i18n_strings.document_delete_confirm))return!1;s={action:"document_delete",id:a,preview_attachment_id:d,type:i,attachment_id:o},u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){var t;e.success&&((t=u("#media-stream")).html(""),t.html(e.data.html))}})}else{if(!confirm(BP_Nouveau.media.i18n_strings.document_delete_confirm))return!1;var n=t.attr("data-item-activity-id"),s={action:"document_activity_delete",id:a,preview_attachment_id:d,type:i,activity_id:n,attachment_id:o};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){e.success&&(u("body #buddypress .activity-list li#activity-"+n+" .documemt-activity .activity-inner .bb-activity-media-wrap .document-activity."+a).remove(),!0===e.data.delete_activity&&(u("body #buddypress .activity-list li#activity-"+n).remove(),u("body .bb-activity-media-elem.document-activity."+a).remove()))}})}},bp_ajax_media_request:function(e,t){void 0!==t&&void 0!==t.response.scopes.personal&&0===t.response.scopes.personal&&u(".bb-photos-actions").hide()},addSelectedClassToWrapper:function(e){var t,i=e.currentTarget;u(i).is(":checked")?(u(i).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),u(i).closest(".bb-photo-thumb").addClass("selected")):(u(i).closest(".bb-photo-thumb").removeClass("selected"),u(i).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select),(t=u(".bp-nouveau #bb-select-deselect-all-media")).hasClass("selected")&&t.removeClass("selected"))},moveDocumentIntoFolder:function(e){var i=u(e.currentTarget);e.preventDefault();var t=i.attr("id"),a=i.closest(".bp-media-move-file").find(".bb-folder-selected-id").val();if(""===t||""===a)return i.closest(".modal-container").find(".location-folder-list").addClass("has-error"),!1;i.closest(".modal-container").find(".location-folder-list").removeClass("has-error"),i.addClass("loading");var o={action:"document_move",_wpnonce:BP_Nouveau.nonces.media,document_id:t,folder_id:a};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(e){var t;e.success&&((t=u("#media-stream")).html(""),t.html(e.data.html),i.closest(".bp-media-move-file").find(".ac-document-close-button").trigger("click"))}})},deleteMedia:function(e){var i=u(e.currentTarget);e.preventDefault();var t=[],a=u("#buddypress");if(a.find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){u(this).closest(".bb-photo-thumb").addClass("loading deleting"),t.push(u(this).val())}),0==t.length)return!1;i.prop("disabled",!0),u("#buddypress .media-list .bp-feedback").remove();var o={action:"media_delete",_wpnonce:BP_Nouveau.nonces.media,media:t};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:o,success:function(e){var t;setTimeout(function(){i.prop("disabled",!1)},500),e.success?(a.find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){u(this).closest("li").remove()}),0==u("#buddypress").find(".media-list:not(.existing-media-list)").find("li:not(.load-more)").length&&(u(".bb-photos-actions").hide(),t='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.media.i18n_strings.no_photos_found+"</p>\n\t</aside>",u('#buddypress [data-bp-list="media"]').html(t))):u("#buddypress .media-list").prepend(e.data.feedback)}})},toggleSelectAllMedia:function(e){e.preventDefault(),u(e.currentTarget).hasClass("selected")?(u(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllMedia(e)):(u(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllMedia(e)),u(e.currentTarget).toggleClass("selected")},selectAllMedia:function(e){e.preventDefault(),u("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){u(this).prop("checked",!0),u(this).closest(".bb-photo-thumb").addClass("selected"),u(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllMedia:function(e){e.preventDefault(),u("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){u(this).prop("checked",!1),u(this).closest(".bb-photo-thumb").removeClass("selected"),u(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},editAlbumTitle:function(e){e.preventDefault(),u("#bb-album-title").show(),u("#bp-save-album-title").show(),u("#bp-cancel-edit-album-title").show(),u("#bp-edit-album-title").hide(),u("#bp-media-single-album #bp-single-album-title").hide()},editFolderTitle:function(e){e.preventDefault(),u("#bb-album-title").show(),u("#bp-save-folder-title").show(),u("#bp-cancel-edit-album-title").show(),u("#bp-edit-folder-title").hide(),u("#bp-media-single-album #bp-single-album-title").hide()},cancelEditAlbumTitle:function(e){e.preventDefault(),u("#bb-album-title").hide(),u("#bp-save-album-title,#bp-save-folder-title").hide(),u("#bp-cancel-edit-album-title").hide(),u("#bp-edit-album-title,#bp-edit-folder-title").show(),u("#bp-media-single-album #bp-single-album-title").show()},triggerDropzoneSelectFileDialog:function(){this.dropzone_obj.hiddenFileInput.click()},closeUploader:function(e){e.preventDefault(),u("#bp-media-uploader").hide(),u("#bp-media-add-more").hide(),u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload),u("#bp-media-uploader-modal-status-text").text(""),this.dropzone_obj.destroy(),this.dropzone_media=[];var t=u(e.currentTarget).closest("#bp-media-uploader");t.find(".bb-field-steps").length&&(t.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),t.find("#bp-media-document-prev, #bp-media-document-submit, .bp-document-open-create-popup-folder").hide()),this.clearFolderLocationUI(e)},closeChildFolderUploader:function(e){e.preventDefault(),u("#bb-album-child-title").val(""),u("#bp-media-create-child-folder").hide(),u("#bb-album-title").text(""),u("#bp-media-create-folder").hide(),this.dropzone_obj.destroy(),this.dropzone_media=[];var t=u(e.currentTarget).closest("#bp-media-create-child-folder");t.find(".bb-field-steps").length&&(t.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),t.find("#bp-media-document-prev, #bp-media-document-submit, .bp-document-open-create-popup-folder").hide()),this.clearFolderLocationUI(e)},closeFolderUploader:function(e){e.preventDefault(),u("#bp-media-create-folder").hide(),u("#bb-album-title").val(""),this.dropzone_obj.destroy(),this.dropzone_media=[];var t=u(e.currentTarget).closest("#bp-media-create-folder");t.find("#bp-media-create-folder-submit").removeClass("loading"),t.find(".bb-field-steps").length&&(t.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),t.find("#bp-media-document-prev, #bp-media-document-submit, .bp-document-open-create-popup-folder").hide()),this.clearFolderLocationUI(e)},loadMoreGif:function(e){var t,i,a=e.target,o=this,d=u(e.target).closest("form").find(".forums-attached-gif-container"),s=d.data("key");o.gif_container_key=s,a.scrollTop+a.offsetHeight>=a.scrollHeight&&!d.hasClass("loading")&&0<o.gif_data[s].total_count&&o.gif_data[s].offset<=o.gif_data[s].total_count&&(t={offset:o.gif_data[s].offset,fmt:"json",limit:o.gif_data[s].limit},d.addClass("loading"),i=null,i=_.isNull(o.gif_data[s].q)?o.giphy.trending(t,_.bind(o.loadMoreGifResponse,o)):o.giphy.search(_.extend({q:o.gif_data[s].q},t),_.bind(o.loadMoreGifResponse,o)),o.gif_data[s].requests.push(i),o.gif_data[s].offset=o.gif_data[s].offset+o.gif_data[s].limit)},loadMoreGroupMessagesGif:function(e){var t,i,a=e.target,o=this,d=u(e.target).closest("form").find(".bp-group-messages-attached-gif-container").data("key");o.gif_container_key=d,a.scrollTop+a.offsetHeight>=a.scrollHeight&&!u(e.target).closest(".bp-group-messages-attached-gif-container").hasClass("loading")&&0<o.gif_total_count&&o.gif_offset<=o.gif_total_count&&(t={offset:o.gif_offset,fmt:"json",limit:o.gif_limit},u(e.target).closest(".bp-group-messages-attached-gif-container").addClass("loading"),i=null,i=_.isNull(o.gif_q)?o.giphy.trending(t,_.bind(o.loadMoreGroupMessagesGifResponse,o)):o.giphy.search(_.extend({q:o.gif_q},t),_.bind(o.loadMoreGroupMessagesGifResponse,o)),o.gif_requests.push(i),o.gif_offset=o.gif_offset+o.gif_limit,o.gif_data[d].requests.push(i),o.gif_data[d].offset=o.gif_data[d].offset+o.gif_data[d].limit)},loadMoreGroupMessagesGifResponse:function(e){var t=0;if(u(".bp-group-messages-attached-gif-container").removeClass("loading"),void 0!==e.data&&e.data.length){for(var i="",t=0;t<e.data.length;t++){i+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[t].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[t].images.original.url+'" data-id="'+e.data[t].id+'">\n\t\t<img src="'+e.data[t].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[t].saved=!1,this.gif_data.push(e.data[t])}u(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(i)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(this.gif_total_count=e.pagination.total_count)},loadMoreGifResponse:function(e){var t=this,i=0;if(u('div.forums-attached-gif-container[data-key="'+t.gif_container_key+'"]').removeClass("loading"),void 0!==e.data&&e.data.length){for(var a="",i=0;i<e.data.length;i++){a+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[i].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[i].images.original.url+'" data-id="'+e.data[i].id+'">\n\t\t<img src="'+e.data[i].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[i].saved=!1,t.gif_data[t.gif_container_key].data.push(e.data[i])}u('div.forums-attached-gif-container[data-key="'+t.gif_container_key+'"]').closest("form").find(".gif-search-results-list").append(a)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(t.gif_data[t.gif_container_key].total_count=e.pagination.total_count)},editGifPreview:function(){var e=this,t={};if(e.bbp_is_reply_edit&&Object.keys(e.bbp_reply_edit_gif_data).length?t=e.bbp_reply_edit_gif_data.gif_raw_data:e.bbp_is_topic_edit&&Object.keys(e.bbp_topic_edit_gif_data).length?t=e.bbp_topic_edit_gif_data.gif_raw_data:e.bbp_is_forum_edit&&Object.keys(e.bbp_forum_edit_gif_data).length&&(t=e.bbp_forum_edit_gif_data.gif_raw_data),void 0===t.images)return!1;var i=u("#whats-new-attachments .forums-attached-gif-container");i[0].style.backgroundImage="url("+t.images.fixed_width.url+")",i[0].style.backgroundSize="contain",i[0].style.height=t.images.original.height+"px",i[0].style.width=t.images.original.width+"px",i.find(".gif-image-container img").attr("src",t.images.original.url),i.removeClass("closed"),u("#bbp_media_gif").length&&u("#bbp_media_gif").val(JSON.stringify(t))},selectGif:function(e){var t=this,i=0,a=u(e.currentTarget),o=a.closest("form").find(".forums-attached-gif-container");e.preventDefault(),o.closest("form").find(".gif-media-search-dropdown").removeClass("open");var d=o.data("key");if(void 0!==t.gif_data[d]&&void 0!==t.gif_data[d].data&&t.gif_data[d].data.length){for(i=0;i<t.gif_data[d].data.length;i++)if(t.gif_data[d].data[i].id==e.currentTarget.dataset.id){a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+t.gif_data[d].data[i].images.fixed_width.url+")",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.height=t.gif_data[d].data[i].images.original.height+"px",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container")[0].style.width=t.gif_data[d].data[i].images.original.width+"px",a.closest("form").find("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",t.gif_data[d].data[i].images.original.url),a.closest("form").find("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),a.closest("form").find("#bbp_media_gif").length&&a.closest("form").find("#bbp_media_gif").val(JSON.stringify(t.gif_data[d].data[i]));break}var s=a.closest("form");s.find("#forums-document-button")&&s.find("#forums-document-button").addClass("disable"),s.find("#forums-media-button")&&s.find("#forums-media-button").addClass("disable")}},selectGroupMessagesGif:function(e){var t=this,i=0;e.preventDefault();var a=u("#whats-new-attachments .bp-group-messages-attached-gif-container"),o=u("#bp_group_messages_gif");if(u("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),t.gif_data.length){for(i=0;i<t.gif_data.length;i++)if(t.gif_data[i].id==e.currentTarget.dataset.id){a[0].style.backgroundImage="url("+t.gif_data[i].images.fixed_width.url+")",a[0].style.backgroundSize="contain",a[0].style.height=t.gif_data[i].images.original.height+"px",a[0].style.width=t.gif_data[i].images.original.width+"px",a.find(".gif-image-container img").attr("src",t.gif_data[i].images.original.url),a.removeClass("closed"),o.length&&o.val(JSON.stringify(t.gif_data[i]));break}var d=u("#send_group_message_form");d.find("#bp-group-messages-media-button")&&d.find("#bp-group-messages-media-button").addClass("disable"),d.find("#bp-group-messages-document-button")&&d.find("#bp-group-messages-document-button").addClass("disable")}},removeSelectedGif:function(e){e.preventDefault(),this.resetForumsGifComponent(e)},removeGroupMessagesSelectedGif:function(e){e.preventDefault(),this.resetGroupMessagesGifComponent()},resetForumsGifComponent:function(e){var t=u(e.target);t.closest("form").find(".gif-media-search-dropdown").removeClass("open"),t.closest("form").find("#whats-new-toolbar #forums-gif-button").removeClass("active");var i=t.closest("form").find("#whats-new-attachments .forums-attached-gif-container");i&&(i.addClass("closed"),i.find(".gif-image-container img").attr("src",""),i[0].style=""),t.closest("form").find("#bbp_media_gif").length&&t.closest("form").find("#bbp_media_gif").val("");var a=t.closest("form");a.find("#forums-document-button")&&a.find("#forums-document-button").removeClass("disable").removeClass("active"),a.find("#forums-media-button")&&a.find("#forums-media-button").removeClass("disable").removeClass("active")},resetGroupMessagesGifComponent:function(){var e=u("#whats-new-attachments .bp-group-messages-attached-gif-container"),t=u("#bp_group_messages_gif");u("#whats-new-toolbar .bp-group-messages-attached-gif-container").parent().removeClass("open"),u("#whats-new-toolbar #bp-group-messages-gif-button").removeClass("active"),e.addClass("closed"),e.find(".gif-image-container img").attr("src",""),e[0].style="",t.length&&t.val("");var i=u("#send_group_message_form");i.find("#bp-group-messages-media-button")&&i.find("#bp-group-messages-media-button").removeClass("disable").removeClass("active"),i.find("#bp-group-messages-document-button")&&i.find("#bp-group-messages-document-button").removeClass("disable").removeClass("active")},searchGif:function(e){var t=this;null!=t.gif_timeout&&clearTimeout(this.gif_timeout),t.gif_timeout=setTimeout(function(){t.gif_timeout=null,t.searchGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGif:function(e){var t=this;null!=t.gif_timeout&&clearTimeout(this.gif_timeout),t.gif_timeout=setTimeout(function(){t.gif_timeout=null,t.searchGroupMessagesGifRequest(e,e.target.value)},1e3)},searchGroupMessagesGifRequest:function(i){var a=this;a.gif_q=i.target.value;var o=a.gif_offset=0;a.clearGifRequests(),u(i.target).closest(".bp-group-messages-attached-gif-container").addClass("loading");var e=a.giphy.search({q:a.gif_q,offset:a.gif_offset,fmt:"json",limit:a.gif_limit},function(e){if(void 0!==e.data&&e.data.length){var t="";for(o=0;o<e.data.length;o++){t+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[o].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[o].images.original.url+'" data-id="'+e.data[o].id+'">\n\t\t<img src="'+e.data[o].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[o].saved=!1,a.gif_data.push(e.data[o])}u(i.target).closest(".bp-group-messages-attached-gif-container").find(".gif-search-results-list").append(t)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(a.gif_total_count=e.pagination.total_count),u(i.target).closest(".bp-group-messages-attached-gif-container").removeClass("loading")});a.gif_requests.push(e),a.gif_offset=a.gif_offset+a.gif_limit},searchGifRequest:function(i){var a=this,o=0,d=u(i.target).closest("form").find(".forums-attached-gif-container");d.addClass("loading");var s=d.data("key");a.clearGifRequests(s),a.gif_data[s].q=i.target.value,a.gif_data[s].offset=0;var e=a.giphy.search({q:a.gif_data[s].q,offset:a.gif_data[s].offset,fmt:"json",limit:a.gif_data[s].limit},function(e){if(void 0!==e.data&&e.data.length){var t="";for(o=0;o<e.data.length;o++){t+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[o].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[o].images.original.url+'" data-id="'+e.data[o].id+'">\n\t\t<img src="'+e.data[o].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[o].saved=!1,a.gif_data[s].data.push(e.data[o])}u(i.target).closest(".gif-search-content").find(".gif-search-results-list").append(t)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(a.gif_data[s].total_count=e.pagination.total_count),d.removeClass("loading")});a.gif_data[s].requests.push(e),a.gif_data[s].offset=a.gif_data[s].offset+a.gif_data[s].limit},clearGifRequests:function(e){var t=this;if(void 0!==t.gif_data[e]&&void 0!==t.gif_data[e].requests){for(var i=0;i<t.gif_data[e].requests.length;i++)t.gif_data[e].requests[i].abort();u('[data-key="'+e+'"]').closest("form").find(".gif-search-results-list li").remove(),t.gif_data[e].requests=[],t.gif_data[e].data=[],t.gif_data.splice(e,1)}},toggleGifSelector:function(e){var i,a,t,o=this,d=u(e.currentTarget),s=d.closest("form").find(".gif-media-search-dropdown"),n=0;e.preventDefault(),void 0!==window.Giphy&&void 0!==BP_Nouveau.media.gif_api_key&&(o.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key),(i=d.closest("form").find(".forums-attached-gif-container")).addClass("loading"),a=i.data("key"),o.clearGifRequests(a),o.gif_data[a]={q:null,offset:0,limit:20,requests:[],total_count:0,data:[]},t=o.giphy.trending({offset:o.gif_data[a].offset,fmt:"json",limit:o.gif_data[a].limit},function(e){if(void 0!==e.data&&e.data.length){var t="";for(n=0;n<e.data.length;n++){t+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[n].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[n].images.original.url+'" data-id="'+e.data[n].id+'">\n\t\t<img src="'+e.data[n].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[n].saved=!1,o.gif_data[a].data.push(e.data[n])}d.closest("form").find(".gif-search-results-list").append(t)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(o.gif_data[a].total_count=e.pagination.total_count),i.removeClass("loading")}),o.gif_data[a].requests.push(t),o.gif_data[a].offset=o.gif_data[a].offset+o.gif_data[a].limit),s.toggleClass("open"),d.toggleClass("active");var r=d.closest("form").find("#forums-post-media-uploader");r.length&&o.resetForumsMediaComponent(r.data("key"));var l=d.closest("form").find("#forums-post-document-uploader");l.length&&o.resetForumsDocumentComponent(l.data("key"))},toggleGroupMessagesGifSelector:function(e){var t,i=this,a=u(e.currentTarget),o=a.closest("form").find(".gif-media-search-dropdown"),d=0;e.preventDefault(),void 0!==window.Giphy&&void 0!==BP_Nouveau.media.gif_api_key&&null==i.giphy&&(i.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key),i.gif_offset=0,i.gif_q=null,i.gif_limit=20,i.gif_requests=[],i.gif_data=[],i.clearGifRequests(),u(".gif-search-query").closest(".bp-group-messages-attached-gif-container").addClass("loading"),t=i.giphy.trending({offset:i.gif_offset,fmt:"json",limit:i.gif_limit},function(e){if(void 0!==e.data&&e.data.length){var t="";for(d=0;d<e.data.length;d++){t+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[d].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[d].images.original.url+'" data-id="'+e.data[d].id+'">\n\t\t<img src="'+e.data[d].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[d].saved=!1,i.gif_data.push(e.data[d])}a.closest("form").find(".gif-search-results-list").append(t)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(i.gif_total_count=e.pagination.total_count),u(".gif-search-query").closest(".bp-group-messages-attached-gif-container").removeClass("loading")}),i.gif_requests.push(t),i.gif_offset=i.gif_offset+i.gif_limit),o.toggleClass("open"),a.toggleClass("active"),i.resetGroupMessagesMediaComponent(),i.resetGroupMessagesDocumentComponent()},resetGroupMessagesMediaComponent:function(){void 0!==this.dropzone_obj&&this.dropzone_obj.destroy(),this.dropzone_media=[],u("div#bp-group-messages-post-media-uploader").html(""),u("div#bp-group-messages-post-media-uploader").addClass("closed").removeClass("open"),u("#bp-group-messages-media-button").removeClass("active"),u("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_media").val("")},resetGroupMessagesDocumentComponent:function(){void 0!==this.document_dropzone_obj&&this.document_dropzone_obj.destroy(),this.dropzone_media=[],u("div#bp-group-messages-post-document-uploader").html(""),u("div#bp-group-messages-post-document-uploader").addClass("closed").removeClass("open"),u("#bp-group-messages-document-button").removeClass("active"),u("#item-body #group-messages-container .bb-groups-messages-right #send_group_message_form .bb-groups-messages-right-bottom #bp_group_messages_document").val("")},resetForumsMediaComponent:function(e){var t;u("#forums-media-button").removeClass("active"),void 0!==e&&(void 0!==this.dropzone_obj[e]&&(this.dropzone_obj[e].destroy(),this.dropzone_obj.splice(e,1),this.dropzone_media.splice(e,1)),(t=u('div#forums-post-media-uploader[data-key="'+e+'"]')).html(""),t.addClass("closed").removeClass("open"))},resetForumsDocumentComponent:function(e){var t;u("#forums-document-button").removeClass("active"),void 0!==e&&(void 0!==this.dropzone_obj[e]&&(this.dropzone_obj[e].destroy(),this.dropzone_obj.splice(e,1),this.dropzone_media.splice(e,1)),(t=u('div#forums-post-document-uploader[data-key="'+e+'"]')).html(""),t.addClass("closed").removeClass("open"))},openForumsUploader:function(e){var a=this,o=u(e.currentTarget),d=o.closest("form").find("#forums-post-media-uploader"),t=o.closest("form").find("#forums-post-document-uploader"),i=[];e.preventDefault(),o.toggleClass("active");var s=t.data("key");if(a.resetForumsDocumentComponent(s),void 0!==window.Dropzone&&d.length){var n=d.data("key");if(d.hasClass("closed")){if(a.dropzone_obj[n]=new Dropzone(d[0],a.options),a.dropzone_media[n]=[],a.dropzone_obj[n].on("sending",function(e,t,i){i.append("action","media_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),a.dropzone_obj[n].on("error",function(e,t){e.accepted&&void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(t.data.feedback)}),a.dropzone_obj[n].on("success",function(e,t){var i;t.data.id&&(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=u(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=a.album_id,t.data.group_id=a.group_id,t.data.saved=!1,a.dropzone_media[n].push(t.data),a.addMediaIdsToForumsForm(d)),!_.isNull(a.dropzone_obj[n].files)&&0<a.dropzone_obj[n].files.length&&((i=o.closest("form")).find("#forums-document-button")&&i.find("#forums-document-button").addClass("disable"),i.find("#forums-gif-button")&&i.find("#forums-gif-button").addClass("disable"))}),a.dropzone_obj[n].on("removedfile",function(e){if(a.dropzone_media[n].length)for(var t in a.dropzone_media[n])if(e.upload.uuid==a.dropzone_media[n][t].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===a.dropzone_media[n][t].saved||a.dropzone_media[n][t].saved||a.removeAttachment(a.dropzone_media[n][t].id),a.dropzone_media[n].splice(t,1),a.addMediaIdsToForumsForm(d);break}var i;_.isNull(a.dropzone_obj[n].files)||0!==a.dropzone_obj[n].files.length||((i=o.closest("form")).find("#forums-document-button")&&i.find("#forums-document-button").removeClass("disable").removeClass("active"),i.find("#forums-gif-button")&&i.find("#forums-gif-button").removeClass("disable").removeClass("active"))}),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&(this.bbp_reply_edit_media.length?i=this.bbp_reply_edit_media:this.bbp_topic_edit_media.length?i=this.bbp_topic_edit_media:this.bbp_forum_edit_media.length&&(i=this.bbp_forum_edit_media),i.length)){for(var r=!1,l=0;l<i.length;l++)r=!1,a.dropzone_media[n].push({id:i[l].attachment_id,media_id:i[l].id,name:i[l].title,thumb:i[l].thumb,url:i[l].full,uuid:i[l].id,menu_order:l,saved:!0}),r={name:i[l].title,accepted:!0,kind:"image",upload:{filename:i[l].title,uuid:i[l].id},dataURL:i[l].url,id:i[l].id},a.dropzone_obj[n].files.push(r),a.dropzone_obj[n].emit("addedfile",r),a.createThumbnailFromUrl(r,d);a.addMediaIdsToForumsForm(d)}d.removeClass("closed").addClass("open"),a.resetForumsGifComponent(e)}else a.resetForumsMediaComponent(n)}},openGroupMessagesUploader:function(e){var a=this,t=u("div#bp-group-messages-post-media-uploader"),i=u(e.currentTarget);e.preventDefault(),i.toggleClass("active"),void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(a.dropzone_obj=new Dropzone("div#bp-group-messages-post-media-uploader",a.options),a.dropzone_obj.on("sending",function(e,t,i){i.append("action","media_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),a.dropzone_obj.on("error",function(e,t){e.accepted&&void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(t.data.feedback)}),a.dropzone_obj.on("success",function(e,t){var i;t.data.id&&(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=u(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=a.album_id,t.data.group_id=a.group_id,t.data.saved=!1,a.dropzone_media.push(t.data),a.addMediaIdsToGroupMessagesForm()),!_.isNull(a.dropzone_obj.files)&&0<a.dropzone_obj.files.length&&((i=u("#send_group_message_form")).find("#bp-group-messages-document-button")&&i.find("#bp-group-messages-document-button").addClass("disable"),i.find("#bp-group-messages-gif-button")&&i.find("#bp-group-messages-gif-button").addClass("disable"))}),a.dropzone_obj.on("removedfile",function(e){if(a.dropzone_media.length)for(var t in a.dropzone_media)if(e.upload.uuid==a.dropzone_media[t].uuid){void 0===a.dropzone_media[t].saved||a.dropzone_media[t].saved||a.removeAttachment(a.dropzone_media[t].id),a.dropzone_media.splice(t,1),a.addMediaIdsToGroupMessagesForm();break}var i;_.isNull(a.dropzone_obj.files)||0!==a.dropzone_obj.files.length||((i=u("#send_group_message_form")).find("#bp-group-messages-document-button")&&i.find("#bp-group-messages-document-button").removeClass("disable").removeClass("active"),i.find("#bp-group-messages-gif-button")&&i.find("#bp-group-messages-gif-button").removeClass("disable").removeClass("active"))}),t.removeClass("closed").addClass("open"),a.resetGroupMessagesGifComponent(),a.resetGroupMessagesDocumentComponent()):a.resetGroupMessagesMediaComponent())},openGroupMessagesDocumentUploader:function(e){var a=this,t=u("div#bp-group-messages-post-document-uploader"),i=u(e.currentTarget);e.preventDefault(),i.toggleClass("active"),void 0!==window.Dropzone&&t.length&&(t.hasClass("closed")?(a.document_dropzone_obj=new Dropzone("div#bp-group-messages-post-document-uploader",a.documentOptions),a.document_dropzone_obj.on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),a.document_dropzone_obj.on("error",function(e,t){e.accepted&&void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(t.data.feedback)}),a.document_dropzone_obj.on("success",function(e,t){var i;t.data.id&&(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=u(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=a.album_id,t.data.group_id=a.group_id,t.data.saved=!1,a.dropzone_media.push(t.data),a.addDocumentIdsToGroupMessagesForm()),!_.isNull(a.document_dropzone_obj.files)&&0<a.document_dropzone_obj.files.length&&((i=u("#send_group_message_form")).find("#bp-group-messages-media-button")&&i.find("#bp-group-messages-media-button").addClass("disable"),i.find("#bp-group-messages-gif-button")&&i.find("#bp-group-messages-gif-button").addClass("disable"))}),a.document_dropzone_obj.on("removedfile",function(e){if(a.dropzone_media.length)for(var t in a.dropzone_media)if(e.upload.uuid==a.dropzone_media[t].uuid){void 0===a.dropzone_media[t].saved||a.dropzone_media[t].saved||a.removeAttachment(a.dropzone_media[t].id),a.dropzone_media.splice(t,1),a.addDocumentIdsToGroupMessagesForm();break}var i;_.isNull(a.document_dropzone_obj.files)||0!==a.document_dropzone_obj.files.length||((i=u("#send_group_message_form")).find("#bp-group-messages-media-button")&&i.find("#bp-group-messages-media-button").removeClass("disable").removeClass("active"),i.find("#bp-group-messages-gif-button")&&i.find("#bp-group-messages-gif-button").removeClass("disable").removeClass("active"))}),t.removeClass("closed").addClass("open"),a.resetGroupMessagesGifComponent(),a.resetGroupMessagesMediaComponent()):a.resetGroupMessagesDocumentComponent())},openForumsDocumentUploader:function(e){var a=this,o=u(e.currentTarget),d=o.closest("form").find("#forums-post-document-uploader"),t=o.closest("form").find("#forums-post-media-uploader"),i=[];e.preventDefault(),o.toggleClass("active");var s=t.data("key");if(a.resetForumsMediaComponent(s),void 0!==window.Dropzone&&d.length){var n=d.data("key");if(d.hasClass("closed")){if(a.dropzone_obj[n]=new Dropzone(d[0],a.documentOptions),a.dropzone_media[n]=[],a.dropzone_obj[n].on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),a.dropzone_obj[n].on("error",function(e,t){e.accepted&&void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(t.data.feedback)}),a.dropzone_obj[n].on("success",function(e,t){var i;t.data.id&&(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=u(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,t.data.album_id=a.album_id,t.data.group_id=a.group_id,t.data.saved=!1,a.dropzone_media[n].push(t.data),a.addDocumentIdsToForumsForm(d)),!_.isNull(a.dropzone_obj[n].files)&&0<a.dropzone_obj[n].files.length&&((i=o.closest("form")).find("#forums-media-button")&&i.find("#forums-media-button").addClass("disable"),i.find("#forums-gif-button")&&i.find("#forums-gif-button").addClass("disable"))}),a.dropzone_obj[n].on("removedfile",function(e){if(a.dropzone_media[n].length)for(var t in a.dropzone_media[n])if(e.upload.uuid==a.dropzone_media[n][t].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===a.dropzone_media[n][t].saved||a.dropzone_media[n][t].saved||a.removeAttachment(a.dropzone_media[n][t].id),a.dropzone_media[n].splice(t,1),a.addDocumentIdsToForumsForm(d);break}var i;_.isNull(a.dropzone_obj[n].files)||0!==a.dropzone_obj[n].files.length||((i=o.closest("form")).find("#forums-media-button")&&i.find("#forums-media-button").removeClass("disable").removeClass("active"),i.find("#forums-gif-button")&&i.find("#forums-gif-button").removeClass("disable").removeClass("active"))}),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_document.length||this.bbp_topic_edit_document.length||this.bbp_forum_edit_document.length)&&(this.bbp_reply_edit_document.length?i=this.bbp_reply_edit_document:this.bbp_topic_edit_document.length?i=this.bbp_topic_edit_document:this.bbp_forum_edit_document.length&&(i=this.bbp_forum_edit_document),i.length)){for(var r=!1,l=0;l<i.length;l++)r=!1,a.dropzone_media[n].push({id:i[l].attachment_id,media_id:i[l].id,name:i[l].name,title:i[l].name,size:i[l].size,url:i[l].url,uuid:i[l].id,menu_order:l,saved:!0}),r={name:i[l].name,size:i[l].size,accepted:!0,kind:"document",upload:{name:i[l].name,title:i[l].name,size:i[l].size,uuid:i[l].id},dataURL:i[l].url,id:i[l].id},a.dropzone_obj[n].files.push(r),a.dropzone_obj[n].emit("addedfile",r),a.dropzone_obj[n].emit("complete",r);a.addDocumentIdsToForumsForm(d)}d.removeClass("closed").addClass("open"),a.resetForumsGifComponent(e)}else a.resetForumsDocumentComponent(n)}},addMediaIdsToForumsForm:function(e){var t=e.data("key");e.closest("#whats-new-attachments").find("#bbp_media").length&&e.closest("#whats-new-attachments").find("#bbp_media").val(JSON.stringify(this.dropzone_media[t]))},addDocumentIdsToForumsForm:function(e){var t=e.data("key");e.closest("#whats-new-attachments").find("#bbp_document").length&&e.closest("#whats-new-attachments").find("#bbp_document").val(JSON.stringify(this.dropzone_media[t]))},createThumbnailFromUrl:function(t,e){var i=this,a=e.data("key");i.dropzone_obj[a].createThumbnailFromUrl(t,i.dropzone_obj[a].options.thumbnailWidth,i.dropzone_obj[a].options.thumbnailHeight,i.dropzone_obj[a].options.thumbnailMethod,!0,function(e){i.dropzone_obj[a].emit("thumbnail",t,e),i.dropzone_obj[a].emit("complete",t)})},openUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&u("div#media-uploader").length&&(u("#bp-media-uploader").show(),i.dropzone_obj=new Dropzone("div#media-uploader",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","media_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("addedfile",function(){setTimeout(function(){i.dropzone_obj.getAcceptedFiles().length&&u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.dropzone_obj.on("error",function(e,t){e.accepted&&void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(t.data.feedback)}),i.dropzone_obj.on("queuecomplete",function(){u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),i.dropzone_obj.on("processing",function(){u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),i.dropzone_obj.on("success",function(e,t){t.data.id&&(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=i.dropzone_media.length,t.data.album_id=i.album_id,t.data.group_id=i.group_id,t.data.saved=!1,i.dropzone_media.push(t.data)),u("#bp-media-add-more").show(),u("#bp-media-submit").show(),u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var t in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[t].uuid){void 0===i.dropzone_media[t].saved||i.dropzone_media[t].saved||i.removeAttachment(i.dropzone_media[t].id),i.dropzone_media.splice(t,1);break}i.dropzone_obj.getAcceptedFiles().length?u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show():(u("#bp-media-uploader-modal-status-text").text(""),u("#bp-media-add-more").hide(),u("#bp-media-submit").hide())}))},openDocumentUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&u("div#media-uploader").length&&(u("#bp-media-uploader").hasClass("bp-media-document-uploader")&&(this.currentTargetParent=u(e.currentTarget).closest("#bp-media-single-folder").find("#media-folder-document-data-table .media-folder_items").attr("data-parent-id"),this.currentTargetParent||(this.currentTargetParent=0),this.folderLocationUI("#bp-media-uploader",this.currentTargetParent)),u("#bp-media-uploader").show(),i.dropzone_obj=new Dropzone("div#media-uploader",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("addedfile",function(){setTimeout(function(){i.dropzone_obj.getAcceptedFiles().length&&u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.dropzone_obj.on("error",function(e,t){e.accepted&&void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(t.data.feedback)}),i.dropzone_obj.on("queuecomplete",function(){u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),i.dropzone_obj.on("processing",function(){u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),i.dropzone_obj.on("success",function(e,t){t.data.id&&(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=i.dropzone_media.length,t.data.folder_id=i.album_id,t.data.group_id=i.group_id,t.data.saved=!1,i.dropzone_media.push(t.data)),u("#bp-media-document-add-more").show(),u("#bp-media-document-next").show(),u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var t in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[t].uuid){void 0===i.dropzone_media[t].saved||i.dropzone_media[t].saved||i.removeAttachment(i.dropzone_media[t].id),i.dropzone_media.splice(t,1);break}i.dropzone_obj.getAcceptedFiles().length?u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show():(u("#bp-media-uploader-modal-status-text").text(""),u("#bp-media-document-add-more").hide(),u("#bp-media-document-next").hide())}))},openDocumentFolderUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&u("div#bp-media-create-folder").length&&(u("#bp-media-create-folder").show(),i.dropzone_obj=new Dropzone("div#media-uploader-folder",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("addedfile",function(){setTimeout(function(){i.dropzone_obj.getAcceptedFiles().length&&u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.dropzone_obj.on("error",function(e,t){e.accepted&&void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(t.data.feedback)}),i.dropzone_obj.on("queuecomplete",function(){u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),i.dropzone_obj.on("processing",function(){u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),i.dropzone_obj.on("success",function(e,t){t.data.id&&(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=i.dropzone_media.length,t.data.folder_id=i.album_id,t.data.group_id=i.group_id,t.data.saved=!1,i.dropzone_media.push(t.data)),u("#bp-media-document-add-more").show(),u("#bp-media-document-submit").show(),u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var t in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[t].uuid){void 0===i.dropzone_media[t].saved||i.dropzone_media[t].saved||i.removeAttachment(i.dropzone_media[t].id),i.dropzone_media.splice(t,1);break}i.dropzone_obj.getAcceptedFiles().length?u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show():(u("#bp-media-uploader-modal-status-text").text(""),u("#bp-media-document-add-more").hide(),u("#bp-media-document-submit").hide())}))},openDocumentFolderChildUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&u("div#bp-media-create-child-folder").length&&(u("#bp-media-create-child-folder").show(),i.dropzone_obj=new Dropzone("div#media-uploader-child-folder",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","document_document_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("addedfile",function(){setTimeout(function(){i.dropzone_obj.getAcceptedFiles().length&&u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.dropzone_obj.on("error",function(e,t){e.accepted&&void 0!==t&&void 0!==t.data&&void 0!==t.data.feedback&&u(e.previewElement).find(".dz-error-message span").text(t.data.feedback)}),i.dropzone_obj.on("queuecomplete",function(){u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),i.dropzone_obj.on("processing",function(){u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),i.dropzone_obj.on("success",function(e,t){t.data.id&&(e.id=t.id,t.data.uuid=e.upload.uuid,t.data.menu_order=i.dropzone_media.length,t.data.folder_id=i.album_id,t.data.group_id=i.group_id,t.data.saved=!1,i.dropzone_media.push(t.data)),u("#bp-media-document-add-more").show(),u("#bp-media-document-submit").show(),u("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var t in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[t].uuid){void 0===i.dropzone_media[t].saved||i.dropzone_media[t].saved||i.removeAttachment(i.dropzone_media[t].id),i.dropzone_media.splice(t,1);break}i.dropzone_obj.getAcceptedFiles().length?u("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show():(u("#bp-media-uploader-modal-status-text").text(""),u("#bp-media-document-add-more").hide(),u("#bp-media-document-submit").hide())}))},openDocumentMove:function(e){var t;e.preventDefault();var i=u(e.currentTarget).closest(".bb-activity-media-elem").find(".document-title").text();this.moveToIdPopup=u(e.currentTarget).attr("id"),this.moveToTypePopup=u(e.currentTarget).attr("data-type"),t="#"+u(e.currentTarget).closest("li.activity-item").attr("id")+" .bp-media-move-file",u(t).find(".bp-document-move").attr("id",u(e.currentTarget).closest(".document-activity").attr("data-id")),this.currentTargetParent=u(e.currentTarget).closest(".bb-activity-media-elem").attr("data-parent-id"),0<u(e.currentTarget).closest(".media-folder_items").length&&(i=u(e.currentTarget).closest(".media-folder_items").find(".media-folder_name").text(),this.currentTargetParent=u(e.currentTarget).closest(".media-folder_items").attr("data-parent-id"),u(e.currentTarget).hasClass("ac-document-move")?u(t=".bp-media-move-file").find(".bp-document-move").attr("id",u(e.currentTarget).closest(".media-folder_items").attr("data-id")):u(t=".bp-media-move-folder").find(".bp-folder-move").attr("id",u(e.currentTarget).closest(".media-folder_items").attr("data-id"))),u(t).find(".location-folder-list-wrap .location-folder-list").remove(),u(t).find(".location-folder-list-wrap").append('<ul class="location-folder-list is-loading"><li><i class="bb-icon-loader animate-spin"></i></li></ul>'),u(t).find(".bb-model-header h4 .target_name").text(i),u(t).show();var a=this.currentTargetParent;""!==this.moveToIdPopup&&u.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"document_get_folder_view",id:this.moveToIdPopup,type:this.moveToTypePopup},success:function(e){u(t).find(".location-folder-list-wrap .location-folder-list").remove(),u(t).find(".location-folder-list-wrap").append(e.data.html),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI(t,a)}})},closeDocumentMove:function(e){e.preventDefault();var t=jQuery(e.currentTarget).closest(".has-folderlocationUI");u(e.currentTarget).hasClass("ac-document-close-button")?u(e.currentTarget).closest(".bp-media-move-file").hide().find(".bp-document-move").attr("id",""):u(e.currentTarget).closest(".bp-media-move-folder").hide().find(".bp-folder-move").attr("id",""),t.find(".bp-document-move.loading").removeClass("loading"),this.clearFolderLocationUI(e)},renameDocument:function(e){var t=u(e.currentTarget).closest(".media-folder_items").find(".media-folder_name"),i=t.children("span").text();t.hide().siblings(".media-folder_name_edit_wrap").show().children(".media-folder_name_edit").val(i).focus().select(),e.preventDefault()},editPrivacyDocument:function(e){u(e.currentTarget).closest(".media-folder_items").find(".media-folder_visibility").find(".media-folder_details__bottom span").hide().siblings("select").removeClass("hide")},editPrivacyDocumentSubmit:function(e){var t=u(e.currentTarget);"true"==t.attr("data-mouseup")?(t.attr("data-mouseup","false"),t.addClass("hide").siblings("span").show().text(t.find("option:selected").text())):t.attr("data-mouseup","true")},renameDocumentSubmit:function(e){var t=u(e.currentTarget).closest(".media-folder_items").find(".media-folder_name_edit"),i=u(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > span"),a=u(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-id").attr("data-item-id"),o=u(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-attachment-id").attr("data-item-id"),d=u(e.currentTarget).closest(".media-folder_items").find(".media-folder_name > i.media-document-type").attr("data-item-id"),s=t.val().trim(),n="";u(e.currentTarget).closest(".ac-document-list").length?n=/^[-\w^&'@{}[\],$=!#().%+~]+$/:u(e.currentTarget).closest(".ac-folder-list").length&&(n=/^[-\w^&'@{}[\],$=!#().%+~ ]+$/);var r=n.exec(s),l=Boolean(r);if(l?t.removeClass("error"):t.addClass("error"),!u(e.currentTarget).hasClass("name_edit_cancel")&&27!=e.keyCode||(t.removeClass("error"),t.parent().hide().siblings(".media-folder_name").show()),u(e.currentTarget).hasClass("name_edit_save")||13==e.keyCode){if(!l)return;t.parent().addClass("submitting").append('<i class="animate-spin bb-icon-loader"></i>'),u.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"document_update_file_name",document_id:a,attachment_document_id:o,document_type:d,name:s},success:function(e){i.text(e.data.response.title),t.removeClass("submitting"),t.parent().find(".animate-spin").remove(),t.parent().hide().siblings(".media-folder_name").show()}})}e.preventDefault()},removeAttachment:function(e){var t={action:"media_delete_attachment",_wpnonce:BP_Nouveau.nonces.media,id:e};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t})},changeUploadModalTab:function(e){e.preventDefault();var t=u(e.currentTarget).data("content");u(".bp-media-upload-tab-content").hide(),u("#"+t).show(),this.current_tab=t,u(e.currentTarget).closest("#bp-media-uploader").find(".bp-media-upload-tab").removeClass("selected"),u(e.currentTarget).addClass("selected"),this.toggleSubmitMediaButton(),jQuery(window).scroll()},openCreateAlbumModal:function(e){e.preventDefault(),this.openUploader(e),u("#bp-media-create-album").show()},openCreateFolderModal:function(e){e.preventDefault(),this.openDocumentFolderUploader(e),this.folderLocationUI("#bp-media-create-folder"),u("#bp-media-create-folder").show()},openCreateFolderChildModal:function(e){e.preventDefault(),this.currentTargetParent=u(e.currentTarget).closest("#bp-media-single-folder").find("#media-folder-document-data-table .media-folder_items").attr("data-parent-id"),this.currentTargetParent||(this.currentTargetParent=0),this.openDocumentFolderChildUploader(e),this.folderLocationUI("#bp-media-create-child-folder",this.currentTargetParent),u("#bp-media-create-child-folder").show()},openEditFolderChildModal:function(e){e.preventDefault();var t=BP_Nouveau.media.current_user_id,i=BP_Nouveau.media.current_group_id,a=BP_Nouveau.media.current_type,o=0,o="group"===a?i:t;u.ajax({url:BP_Nouveau.ajaxurl,type:"post",data:{action:"document_get_folder_view",id:o,type:a},success:function(e){u(".location-folder-list-wrap .location-folder-list").remove(),u(".location-folder-list-wrap").append(e.data.html),bp.Nouveau.Media.folderLocationUI&&bp.Nouveau.Media.folderLocationUI("#bp-media-edit-child-folder",BP_Nouveau.media.current_folder)}}),u("#bp-media-edit-child-folder").show()},folderLocationUI:function(e,t){0<u(e).find(".bb-folder-destination").length&&(u(e).find(".location-folder-list-wrap").hasClass("is_loaded")||(u(document).on("click",e+" .bb-folder-destination",function(){u(this).parent().find(".location-folder-list-wrap").slideToggle()}),u(e).find(".location-folder-list-wrap").addClass("is_loaded"),u(document).on("click",e+" .location-folder-list li i",function(){u(this).closest(".location-folder-list-wrap").find(".location-folder-title").text(u(this).siblings("span").text()).siblings(".location-folder-back").css("display","inline-block"),u(this).siblings("ul").show().siblings("span, i").hide().parent().siblings().hide(),u(this).siblings("ul").children("li").show(),u(this).closest(".is_active").removeClass("is_active"),u(this).parent().addClass("is_active"),u(e).find(".bb-folder-selected-id").val(u(e).find(".location-folder-list li.is_active").attr("data-id")),u(e).find(".target_folder").text(u(e).find(".location-folder-list li.is_active").children("span").text())}),u(document).on("click",e+" .location-folder-back",function(){u(this).siblings(".location-folder-list").find("li.is_active").parent().hasClass("location-folder-list")?(u(this).siblings(".location-folder-list").find("li.is_active").find("ul").hide().siblings("span, i").show().parent().removeClass("is_active").siblings().show(),u(this).siblings(".location-folder-title").text(BP_Nouveau.media.target_text),u(this).hide(),u(e).find(".bb-folder-selected-id").val("0"),u(e).find(".target_folder").text(BP_Nouveau.media.target_text)):(u(this).siblings(".location-folder-list").find("li.is_active").find("ul").hide().siblings("span, i").show().parent().removeClass("is_active").addClass("is_active_old").parent().parent().closest(".has-ul").addClass("is_active"),u(this).siblings(".location-folder-list").find("li.is_active_old").siblings().show(),u(this).siblings(".location-folder-list").find("li.is_active.is_active_old").removeClass("is_active is_active_old"),u(this).siblings(".location-folder-title").text(u(this).parent().find("li.is_active>span").text()),u(e).find(".bb-folder-selected-id").val(u(e).find(".location-folder-list li.is_active").attr("data-id")),u(e).find(".target_folder").text(u(e).find(".location-folder-list li.is_active").children("span").text())),u(this).closest(".has-folderlocationUI").find(".ac_document_search_folder").val("").trigger("change")}),u(e).on("click"," .location-folder-list li span",function(){u(this).hasClass("selected")&&!u(this).hasClass("disabled")?(u(this).removeClass("selected"),u(this).closest(".has-folderlocationUI").find(".bb-model-header h4 span.target_folder").text("..."),u(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(""),u(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val("0"),u(e).find(".location-folder-list li.is_active").length?(u(e).find(".bb-folder-selected-id").val(u(e).find(".location-folder-list li.is_active").attr("data-id")),u(e).find(".target_folder").text(u(e).find(".location-folder-list li.is_active").children("span").text())):(u(e).find(".bb-folder-selected-id").val("0"),u(e).find(".target_folder").text(BP_Nouveau.media.target_text))):(u(this).closest(".location-folder-list-wrap-main").find(".location-folder-list li span").removeClass("selected"),u(this).addClass("selected"),u(this).closest(".location-folder-list-wrap-main").find(".bb-folder-destination").val(u(this).text()),u(this).closest(".location-folder-list-wrap-main").find(".bb-folder-selected-id").val(u(this).parent().attr("data-id")),u(this).closest(".has-folderlocationUI").find(".bb-model-header h4 span.target_folder").text(" "+u(this).text()))}),u(document).on("keyup change",e+" .ac_document_search_folder",function(){var e,t=u(this).val();""==t?u(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap .location-folder-list").show().parent().siblings(".ac_document_search_folder_list").hide():(u(this).closest(".has-folderlocationUI").find(".ac_document_search_folder_list ul").html(" "),e="",0<u(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap ul.location-folder-list li.is_active").length&&(e=".is_active li"),u(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap ul.location-folder-list li"+e).each(function(){0<=u(this).children("span").text().search(new RegExp(t,"i"))&&u(this).closest(".has-folderlocationUI").find(".ac_document_search_folder_list ul").append('<li data-id="'+u(this).attr("data-id")+'"><span>'+u(this).children("span").text()+"</span></li>")}),u(this).closest(".has-folderlocationUI").find(".location-folder-list-wrap .location-folder-list").hide().parent().siblings(".ac_document_search_folder_list").show(),t="")}),u(e).find(".location-folder-list li > span.disabled").length&&u(e).find(".target_folder").text(u(e).find(".location-folder-list li > span.disabled").text())),u(e).find(".location-folder-list li").each(function(){u(this).children("ul").parent().addClass("has-ul").append('<i class="bb-icon-angle-right sub-menu-anchor"></i>')}),t&&(u(e).find(".location-folder-list li").hide(),u(e).find(".location-folder-list li.is_active").removeClass("is_active"),u(e).find('.location-folder-list li[data-id="'+t+'"]').addClass("is_active"),u(e).find(".location-folder-list li.is_active").parents(".has-ul").show().children("ul").show().siblings("span,i").hide(),u(e).find(".location-folder-list li.is_active").addClass("is_active").children("ul").length?u(e).find(".location-folder-list li.is_active").addClass("is_active").show().children("ul").show().children("li").show().parent().siblings("span, i").hide():u(e).find(".location-folder-list li.is_active").removeClass("is_active").closest(".has-ul").addClass("is_active").children("span,i").hide().parent().children("ul").show().children("li").show(),u(e).find(".location-folder-list-wrap").find(".location-folder-title").text(u(e).find(".location-folder-list li.is_active").closest(".has-ul").children("span").text()).siblings(".location-folder-back").css("display","inline-block"),u(e).find(".bb-folder-selected-id").val(u(e).find(".location-folder-list li.is_active").attr("data-id")),u(e).find(".target_folder").text(u(e).find(".location-folder-list li.is_active").children("span").text())),"0"===t&&(u(e).find(".location-folder-list").children("li").show(),u(e).find(".location-folder-list-wrap").find(".location-folder-title").text(BP_Nouveau.media.target_text),u(e).find(".location-folder-back").hide(),u(e).find(".target_folder").text(BP_Nouveau.media.target_text)))},clearFolderLocationUI:function(e){var t=jQuery(e.currentTarget).closest(".has-folderlocationUI");0<t.length&&(t.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").each(function(){jQuery(this).removeClass("is_active").find("span.selected:not(.disabled)").removeClass("selected"),jQuery(this).find("ul").hide()}),t.find(".location-folder-list-wrap-main .location-folder-list-wrap .location-folder-list li").show().children("span, i").show(),t.find(".location-folder-title").text(BP_Nouveau.media.target_text),t.find(".location-folder-back").hide().closest(".has-folderlocationUI").find(".bb-folder-selected-id").val("0"),t.find(".ac_document_search_folder").val(""),t.find(".bb-model-header h4 span").text("..."),t.find(".ac_document_search_folder_list ul").html("").parent().hide().siblings(".location-folder-list-wrap").find(".location-folder-list").show())},closeCreateAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),u("#bp-media-create-album").hide(),u("#bb-album-title").val("")},closeCreateFolderModal:function(e){e.preventDefault(),this.closeUploader(e),u("#bp-media-create-folder, #bp-media-create-child-folder").hide(),u("#bb-album-title, #bb-album-child-title").val(""),u("#bp-media-create-folder .bb-folder-selected-id").val("0"),u("#bp-media-create-folder .bb-field-steps-1, #bp-media-create-child-folder .bb-field-steps-1").show().siblings(".bb-field-steps").hide(),u("#bp-media-create-child-folder-submit").removeClass("loading")},closeEditFolderModal:function(e){e.preventDefault();var t=u(e.currentTarget).closest("#bp-media-edit-child-folder");u("#bp-media-edit-child-folder").hide(),t.find(".bb-field-steps-1").show().siblings(".bb-field-steps").hide(),this.clearFolderLocationUI(e)},submitMedia:function(i){var e,t,a,o=this,d=u(i.currentTarget),s=u("#bb-media-privacy"),n=0;if(i.preventDefault(),d.hasClass("saving"))return!1;d.addClass("saving"),!1===(n=o.album_id)&&(n=u(".bb-folder-selected-id").val()),"bp-dropzone-content"===o.current_tab?(e=u("#bp-media-post-content").val(),t={action:"media_save",_wpnonce:BP_Nouveau.nonces.media,medias:o.dropzone_media,content:e,album_id:n,group_id:o.group_id,privacy:s.val()},u("#bp-dropzone-content .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(e){if(e.success){u("#media-stream ul.media-list").length||(u("#media-stream").html(u("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),u(".bb-photos-actions").show()),0===parseInt(n)&&bp.Nouveau.inject("#media-stream ul.media-list",e.data.media,"prepend"),u("#bp-media-post-content").val(""),u(".bb-folder-selected-id").val("0");for(var t=0;t<o.dropzone_media.length;t++)o.dropzone_media[t].saved=!0;o.closeUploader(i),jQuery(window).scroll()}else u("#bp-dropzone-content").prepend(e.data.feedback);d.removeClass("saving")}})):"bp-existing-media-content"===o.current_tab?(a=[],u('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){a.push(u(this).val())}),t={action:"media_move_to_album",_wpnonce:BP_Nouveau.nonces.media,medias:a,album_id:n,group_id:o.group_id},u("#bp-existing-media-content .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(e){e.success?(u("#media-stream ul.media-list").length||(u("#media-stream").html(u("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),u(".bb-photos-actions").show()),0===parseInt(n)&&bp.Nouveau.inject("#media-stream ul.media-list",e.data.media,"prepend"),u("#bp-media-post-content").val(""),u(".bb-folder-selected-id").val("0"),u('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){u(this).closest("li").data("id")===u(this).val()&&u(this).closest("li").remove()}),jQuery(window).scroll(),o.closeUploader(i)):u("#bp-existing-media-content").prepend(e.data.feedback),d.removeClass("saving")}})):o.current_tab||(o.closeUploader(i),d.removeClass("saving"))},submitDocumentMedia:function(i){var e,t,a,o=this,d=u(i.currentTarget),s=0,n=u(i.currentTarget).closest("#bp-media-uploader");if(i.preventDefault(),d.hasClass("saving"))return!1;d.addClass("saving"),!1===(s=o.album_id)&&(s=u(".bb-folder-selected-id").val()),"bp-dropzone-content"===o.current_tab?(e=u("#bp-media-post-content").val(),t={action:"document_document_save",_wpnonce:BP_Nouveau.nonces.media,documents:o.dropzone_media,content:e,folder_id:s,group_id:o.group_id},u("#bp-dropzone-content .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(e){if(e.success){u("#media-stream div#media-folder-document-data-table").length||(u("#media-stream").html(u("<div></div>").addClass("display")),u("#media-stream div").attr("id","media-folder-document-data-table"),u(".bb-photos-actions").show()),u(".document-data-table-head").length?bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"):location.reload(!0),u("#bp-media-post-content").val(""),u(".bb-folder-selected-id").val("0");for(var t=0;t<o.dropzone_media.length;t++)o.dropzone_media[t].saved=!0;o.closeUploader(i),jQuery(window).scroll()}else u("#bp-dropzone-content").prepend(e.data.feedback);d.removeClass("saving"),n.find(".bb-field-steps").length&&(n.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),n.find("#bp-media-document-prev, #bp-media-document-submit, .bp-document-open-create-popup-folder").hide())}})):"bp-existing-media-content"===o.current_tab?(a=[],u('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){a.push(u(this).val())}),t={action:"media_move_to_album",_wpnonce:BP_Nouveau.nonces.media,medias:a,album_id:s,group_id:o.group_id},u("#bp-existing-media-content .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:t,success:function(e){e.success?(u("#media-stream ul.media-list").length||(u("#media-stream").html(u("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),u(".bb-photos-actions").show()),0===parseInt(s)&&bp.Nouveau.inject("#media-stream ul.media-list",e.data.media,"prepend"),u("#bp-media-post-content").val(""),u(".bb-folder-selected-id").val("0"),u('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){u(this).closest("li").data("id")===u(this).val()&&u(this).closest("li").remove()}),jQuery(window).scroll(),o.closeUploader(i)):u("#bp-existing-media-content").prepend(e.data.feedback),d.removeClass("saving"),n.find(".bb-field-steps").length&&(n.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),n.find("#bp-media-document-prev, #bp-media-document-submit, .bp-document-open-create-popup-folder").hide())}})):o.current_tab||(o.closeUploader(i),d.removeClass("saving"))},saveAlbum:function(t){var i=u(t.currentTarget),a=this,o=u("#bb-album-title"),d=u("#bb-album-privacy");if(t.preventDefault(),""===u.trim(o.val()))return o.addClass("error"),!1;if(o.removeClass("error"),!a.group_id&&""===u.trim(d.val()))return d.addClass("error"),!1;d.removeClass("error"),i.prop("disabled",!0);var e={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:o.val(),medias:a.dropzone_media,privacy:d.val()};a.album_id&&(e.album_id=a.album_id),a.group_id&&(e.group_id=a.group_id),u(".bb-single-album-header .bp-feedback").remove(),u("#boss-media-create-album-popup .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){setTimeout(function(){i.prop("disabled",!1)},500),e.success?a.album_id?(u("#bp-single-album-title").text(o.val()),u("#bb-album-privacy").val(d.val()),a.cancelEditAlbumTitle(t)):(u("#buddypress .bb-albums-list").prepend(e.data.album),window.location.href=e.data.redirect_url):a.album_id?u("#bp-media-single-album").prepend(e.data.feedback):u("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},saveFolder:function(i){var a=u(i.currentTarget),o=this,e=u("#bb-album-title"),t=u("#bb-folder-privacy");if(i.preventDefault(),""===u.trim(e.val()))return e.addClass("error"),!1;e.removeClass("error");var d=parseInt(u("#boss-media-create-album-popup .bb-folder-selected-id").val());if(!o.group_id&&""===u.trim(t.val()))return t.addClass("error"),!1;t.removeClass("error"),a.prop("disabled",!0).addClass("loading");var s={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:e.val().trim(),document:o.dropzone_media,privacy:t.val(),parent:d};o.album_id&&(s.album_id=o.album_id),o.group_id&&(s.group_id=o.group_id),u(".bb-single-album-header .bp-feedback").remove(),u("#boss-media-create-album-popup .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(e){if(setTimeout(function(){a.prop("disabled",!1)},500),e.success){for(var t=0;t<o.dropzone_media.length;t++)o.dropzone_media[t].saved=!0;u("#bp-media-create-child-folder-submit").removeClass("loading"),o.closeFolderUploader(i),u(".document-data-table-head").length?0!==d&&"0"!==d&&d!==parseInt(BP_Nouveau.media.current_folder)||(bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"),jQuery(window).scroll()):location.reload(!0)}else o.album_id?u("#bp-media-single-album").prepend(e.data.feedback):u("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},saveChildFolder:function(i){var a=u(i.currentTarget),o=this,e=u("#bp-media-create-child-folder #bb-album-child-title"),t=u("#bp-media-create-child-folder #bb-folder-child-privacy"),d=u("#bp-media-create-child-folder #parent_id");if(i.preventDefault(),""===u.trim(e.val()))return e.addClass("error"),!1;if(e.removeClass("error"),!o.group_id&&""===u.trim(t.val()))return t.addClass("error"),!1;t.removeClass("error");var s=parseInt(u("#bp-media-create-child-folder .bb-folder-selected-id").val()),t=t.val(),s=s||d.val();a.prop("disabled",!0).addClass("loading");var n={action:"document_folder_save",_wpnonce:BP_Nouveau.nonces.media,title:e.val(),document:o.dropzone_media,privacy:t,parent:s};o.album_id&&(n.folder_id=o.album_id),o.group_id&&(n.group_id=o.group_id),u(".bb-single-album-header .bp-feedback").remove(),u("#boss-media-create-album-popup .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(e){if(setTimeout(function(){a.prop("disabled",!1)},500),e.success){for(var t=0;t<o.dropzone_media.length;t++)o.dropzone_media[t].saved=!0;u("#bp-media-create-child-folder-submit").removeClass("loading"),o.closeChildFolderUploader(i),u(".document-data-table-head").length?0!==s&&"0"!==s&&s!==parseInt(BP_Nouveau.media.current_folder)||(bp.Nouveau.inject("#media-stream div#media-folder-document-data-table",e.data.document,"prepend"),jQuery(window).scroll()):location.reload(!0)}else o.album_id?u("#bp-media-single-album").prepend(e.data.feedback):u("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},renameChildFolder:function(i){var a=u(i.currentTarget),o=this,e=u("#bp-media-edit-child-folder #bb-album-child-title"),t=u("#bp-media-edit-child-folder #bb-folder-privacy"),d=u("#bp-media-edit-child-folder #parent_id"),s=u("#bp-media-edit-child-folder .bb-folder-selected-id");if(""===u.trim(e.val()))return e.addClass("error"),!1;if(e.removeClass("error"),!o.group_id&&""===u.trim(t.val()))return t.addClass("error"),!1;t.removeClass("error"),a.prop("disabled",!0).addClass("loading");var n={action:"document_edit_folder",_wpnonce:BP_Nouveau.nonces.media,title:e.val(),privacy:t.val(),parent:d.val(),moveTo:s.val()};o.album_id&&(n.folder_id=o.album_id),o.group_id&&(n.group_id=o.group_id),u(".bb-single-album-header .bp-feedback").remove(),u("#boss-media-create-album-popup .bp-feedback").remove(),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:n,success:function(e){var t;setTimeout(function(){a.prop("disabled",!1)},500),e.success?(window.location.href=e.data.redirect_url,(t=u(i.currentTarget).closest("#bp-media-create-child-folder")).find("#bp-media-edit-child-folder-submit").removeClass("loading"),t.find(".bb-field-steps").length&&(t.find(".bb-field-steps-1").show().siblings(".bb-field-steps-2").hide(),t.find("#bp-media-document-prev, #bp-media-document-submit, .bp-document-open-create-popup-folder").hide()),this.clearFolderLocationUI(i),t.hide()):o.album_id?u("#bp-media-single-album").prepend(e.data.feedback):u("#boss-media-create-album-popup .bb-model-header").after(e.data.feedback)}})},deleteAlbum:function(t){if(t.preventDefault(),!this.album_id)return!1;if(!confirm(BP_Nouveau.media.i18n_strings.album_delete_confirm))return!1;u(t.currentTarget).prop("disabled",!0);var e={action:"media_album_delete",_wpnonce:BP_Nouveau.nonces.media,album_id:this.album_id,group_id:this.group_id};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?window.location.href=e.data.redirect_url:(alert(BP_Nouveau.media.i18n_strings.album_delete_error),u(t.currentTarget).prop("disabled",!1))}})},deleteFolder:function(t){if(t.preventDefault(),!this.album_id)return!1;if(!confirm(BP_Nouveau.media.i18n_strings.folder_delete_confirm))return!1;u(t.currentTarget).prop("disabled",!0);var e={action:"document_folder_delete",_wpnonce:BP_Nouveau.nonces.media,album_id:this.album_id,group_id:this.group_id};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){e.success?window.location.href=e.data.redirect_url:(alert(BP_Nouveau.media.i18n_strings.folder_delete_error),u(t.currentTarget).prop("disabled",!1))}})},addMediaIdsToGroupMessagesForm:function(){u("#bp_group_messages_media").length&&u("#bp_group_messages_media").val(JSON.stringify(this.dropzone_media))},addDocumentIdsToGroupMessagesForm:function(){u("#bp_group_messages_document").length&&u("#bp_group_messages_document").val(JSON.stringify(this.dropzone_media))},injectMedias:function(t){var i,a,e,o=bp.Nouveau.getStorage("bp-media"),d=o.scope||null,s=o.filter||null;u(t.currentTarget).hasClass("load-more")&&(i=+Number(this.current_page)+1,a=this,e="",t.preventDefault(),u(t.currentTarget).find("a").first().addClass("loading"),u("#buddypress .dir-search input[type=search]").length&&(e=u("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:d,filter:s,search_terms:e,page:i,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(e){!0===e.success&&(u(t.currentTarget).remove(),a.current_page=i,jQuery(window).scroll())}))},injectDocuments:function(e){var t,i,a,o,d=bp.Nouveau.getStorage("bp-document"),s=d.scope||null,n=d.filter||null,r=u(e.currentTarget);r.hasClass("load-more")&&(t=+Number(this.current_page)+1,i=this,a="",e.preventDefault(),r.find("a").first().addClass("loading"),u("#buddypress .dir-search input[type=search]").length&&(a=u("#buddypress .dir-search input[type=search]").val()),o=this.sort_by&&this.order_by?{object:"document",scope:s,filter:n,search_terms:a,page:t,method:"append",target:"#buddypress [data-bp-list] div#media-folder-document-data-table",order_by:this.order_by,sort:this.sort_by}:{object:"document",scope:s,filter:n,search_terms:a,page:t,method:"append",target:"#buddypress [data-bp-list] div#media-folder-document-data-table"},bp.Nouveau.objectRequest(o).done(function(e){!0===e.success&&(r.parent(".pager").remove(),i.current_page=t,jQuery(window).scroll())}))},sortDocuments:function(e){var t=u(e.currentTarget),i=t.data("target"),a="",o="date_created",d=t.attr("class");switch(i){case"name":o="title";break;case"modified":o="date_modified";break;case"visibility":o="privacy";break;case"group":o="group_id"}t.hasClass("asce")?t.removeClass("asce"):t.addClass("asce");var s=t.hasClass("asce")?"DESC":"ASC",n=(bp.Nouveau.getStorage("bp-document"),{});n.orderby=o,n.sort=s,"group"!==o&&bp.Nouveau.setStorage("bp-document","extras",n);var r=bp.Nouveau.getStorage("bp-document"),l=r.scope||null,c=r.filter||null;u(e.currentTarget);u("#buddypress .dir-search input[type=search]").length&&(a=u("#buddypress .dir-search input[type=search]").val()),this.sort_by=s,this.order_by=o,this.current_page=1,bp.Nouveau.objectRequest({object:"document",scope:l,filter:c,search_terms:a,page:1,order_by:o,sort:s,method:"reset",target:"#buddypress [data-bp-list]"}).done(function(e){setTimeout(function(){currentFilterTarget="."+d.replace(" ","."),u(currentFilterTarget).hasClass("asce")?u(currentFilterTarget).removeClass("asce"):u(currentFilterTarget).addClass("asce")},300)})},documentPopupNavigate:function(e){e.preventDefault();var t=u(e.currentTarget),i=t.closest(".bb-field-steps"),a=0==t.closest(".bp-document-listing").length?"#bb-album-child-title":"#bb-album-title";t.closest(".document-options").length&&(a="#bb-album-title"),t.hasClass("bb-field-steps-next")&&""==i.find(a).val().trim()?i.find(a).addClass("error"):(i.find(a).removeClass("error"),i.slideUp(200).siblings(".bb-field-steps").slideDown(200))},uploadDocumentNavigate:function(e){e.preventDefault();var t=u(e.currentTarget),i=u(t).closest("#bp-media-uploader");u(t).hasClass("bb-field-uploader-next")?(i.find(".bb-field-steps-1").slideUp(200).siblings(".bb-field-steps").slideDown(200),i.find("#bp-media-document-submit, #bp-media-document-prev, .bp-document-open-create-popup-folder").show()):(u(t).hide(),i.find("#bp-media-document-submit, #bp-media-document-prev, .bp-document-open-create-popup-folder").hide(),i.find(".bb-field-steps-2").slideUp(200).siblings(".bb-field-steps").slideDown(200))},appendMedia:function(t){var i,a,e,o=bp.Nouveau.getStorage("bp-media"),d=o.scope||null,s=o.filter||null;u(t.currentTarget).hasClass("load-more")&&(i=+Number(this.current_page_existing_media)+1,a=this,e="",t.preventDefault(),u(t.currentTarget).find("a").first().addClass("loading"),u("#buddypress .dir-search input[type=search]").length&&(e=u("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:d,filter:s,search_terms:e,page:i,method:"append",caller:"bp-existing-media",target:".bp-existing-media-wrap ul.bp-list"}).done(function(e){!0===e.success&&(u(t.currentTarget).remove(),a.current_page_existing_media=i)}))},appendAlbums:function(t){var i=+Number(this.current_page_albums)+1,a=this;t.preventDefault(),u(t.currentTarget).find("a").first().addClass("loading");var e={action:"media_albums_loader",_wpnonce:BP_Nouveau.nonces.media,page:i};u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:e,success:function(e){!0===e.success&&(u(t.currentTarget).remove(),u("#albums-dir-list ul.bb-albums-list").fadeOut(100,function(){u("#albums-dir-list ul.bb-albums-list").append(e.data.albums),u(this).fadeIn(100)}),a.current_page_albums=i)}})},toggleSubmitMediaButton:function(){var e=u("#bp-media-submit"),t=u("#bp-media-add-more");"bp-dropzone-content"===this.current_tab?this.dropzone_obj.getAcceptedFiles().length?(e.show(),t.show()):(e.hide(),t.hide()):"bp-existing-media-content"===this.current_tab&&(u('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').length?e.show():e.hide(),t.hide())},playVideo:function(e){e.preventDefault();var t=u(e.currentTarget).find("video").get(0),i=u(e.currentTarget).find(".gif-play-button");1==t.paused?(t.play(),i.hide()):(t.pause(),i.show())},autoPlayGifVideos:function(){u(".gif-player").each(function(){var e=u(this).find("video").get(0),t=u(this).find(".gif-play-button");u(this).is(":in-viewport")?(e.play(),t.hide()):(e.pause(),t.show())})},fileActionButton:function(e){u(e.currentTarget).parent().hasClass("download_file")||(e.preventDefault(),u(e.currentTarget).closest(".media-folder_items").toggleClass("is-visible").siblings(".media-folder_items").removeClass("is-visible"))},copyDownloadLink:function(e){var t=e.currentTarget,i="document_copy_link";u("body").append('<textarea style="position:absolute;opacity:0;" id="'+i+'"></textarea>'),u("#"+i).val(u(t).attr("href")),u("#"+i).select(),document.execCommand("copy"),u("#"+i).remove(),e.preventDefault()},fileActivityActionButton:function(e){e.preventDefault(),u(e.currentTarget).closest(".bb-activity-media-elem").toggleClass("is-visible").siblings().removeClass("is-visible").closest(".activity-item").siblings().find(".bb-activity-media-elem").removeClass("is-visible"),"a"!=e.currentTarget.tagName.toLowerCase()||u(e.currentTarget).hasClass("document-action_more")||u(e.currentTarget).closest(".bb-activity-media-elem").removeClass("is-visible")},toggleFileActivityActionButton:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||u(t).hasClass("document-action_more")||u(t).parent().hasClass("document-action_more")||u(t).hasClass("media-folder_action__anchor")||u(t).parent().hasClass("media-folder_action__anchor")?e:(u(".bb-activity-media-elem.is-visible").removeClass("is-visible"),void u(".media-folder_items.is-visible").removeClass("is-visible"))},expandCodePreview:function(e){e.preventDefault(),u(e.currentTarget).closest(".document-activity").addClass("code-full-view")},collapseCodePreview:function(e){e.preventDefault(),u(e.currentTarget).closest(".document-activity").removeClass("code-full-view")},documentCodeMirror:function(){u(".document-text:not(.loaded)").each(function(){var e=u(this),t=e.attr("data-extension"),i=e.attr("data-extension");"html"!=t&&"htm"!=t||(i="text/html"),"js"==t?CodeMirror(e[0],{value:e.find(".document-text-file-data-hidden").val(),lineNumbers:!0,theme:"default",readOnly:!0,lineWrapping:!0}):CodeMirror(e[0],{value:e.find(".document-text-file-data-hidden").val(),mode:i,lineNumbers:!0,theme:"default",readOnly:!0,lineWrapping:!0}),e.addClass("loaded"),150<e.parent().height()&&e.closest(".document-text-wrap").addClass("is_large")}),u(".bb-activity-media-elem.document-activity").closest(".activity-inner").hasClass("documemt-activity")||u(".bb-activity-media-elem.document-activity").closest(".activity-content").addClass("documemt-activity")}},bp.Nouveau.Media.Theatre={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.medias=[],this.current_media=!1,this.current_index=0,this.is_open=!1,this.nextLink=u(".bb-next-media"),this.previousLink=u(".bb-prev-media"),this.activity_ajax=!1,this.group_id=void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id},addListeners:function(){u(document).on("click",".bb-open-media-theatre",this.openTheatre.bind(this)),u(document).on("click",".bb-open-document-theatre",this.openDocumentTheatre.bind(this)),u(document).on("click",".bb-close-media-theatre",this.closeTheatre.bind(this)),u(document).on("click",".bb-close-document-theatre",this.closeDocumentTheatre.bind(this)),u(document).on("click",".bb-prev-media",this.previous.bind(this)),u(document).on("click",".bb-next-media",this.next.bind(this)),u(document).on("bp_activity_ajax_delete_request",this.activityDeleted.bind(this)),u(document).on("click","#bb-media-model-container .media-privacy>li",this.mediaPrivacyChange.bind(this)),u(document).on("click","#bb-media-model-container .bb-media-section span.privacy",bp.Nouveau,this.togglePrivacyDropdown.bind(this)),u(document).click(this.togglePopupDropdown)},documentClick:function(e){var t,i;this.is_open&&(t=e.target,null!=(i=document.getElementById("bb-media-model-container"))&&!i.contains(t)&&document.body.contains(t)&&this.closeTheatre(e))},checkPressedKey:function(e){switch((e=e||window.event).keyCode){case 27:this.closeTheatre(e);break;case 37:this.previous(e);break;case 39:this.next(e)}},checkPressedKeyDocuments:function(e){27==(e=e||window.event).keyCode&&bp.Nouveau.Media.Theatre.closeDocumentTheatre(e)},openTheatre:function(e){e.preventDefault();var t,i=u(e.currentTarget),a=this;if(i.closest("#bp-existing-media-content").length)return!1;a.setupGlobals(),a.setMedias(i),t=i.data("id"),a.setCurrentMedia(t),a.showMedia(),a.navigationCommands(),a.getActivity(),u(".bb-media-model-wrapper").show(),a.is_open=!0,document.addEventListener("keyup",a.checkPressedKey.bind(a))},openDocumentTheatre:function(e){e.preventDefault();var t=u(e.currentTarget),i=u(t).closest(".bb-media-container").length?u(t).closest(".bb-media-container").find(".document-theatre"):u(t).closest(".directory.document").find(".document-theatre");"css"==t.attr("data-extension")||"txt"==t.attr("data-extension")||"js"==t.attr("data-extension")||"html"==t.attr("data-extension")||"htm"==t.attr("data-extension")||"csv"==t.attr("data-extension")?u.get(t.attr("data-text-preview"),function(e){i.find(".bb-media-section").removeClass("bb-media-no-preview").html("<h3>"+t.text()+'</h3><div class="document-text"><textarea class="document-text-file-data-hidden"></textarea></div>'),i.find(".bb-media-section .document-text").attr("data-extension",t.attr("data-extension")),i.find(".bb-media-section .document-text textarea").html(e.replace("n","")),bp.Nouveau.Media.documentCodeMirror()}):t.attr("data-preview")?i.find(".bb-media-section").removeClass("bb-media-no-preview").html("<h3>"+t.text()+'</h3><div class="img-section"> <img src="'+t.attr("data-preview")+'" /> </div>'):i.find(".bb-media-section").addClass("bb-media-no-preview").html('<div class="img-section"> <i class="'+t.closest(".media-folder_items").find(".media-folder_icon > a > i").attr("class")+'"></i><p>'+t.text()+"</p> </div>");var a=t.closest(".media-folder_items").data("activity-id");bp.Nouveau.Media.Theatre.getDocumentActivity(a),this.is_open=!0,u(".document-theatre").show(),document.addEventListener("keyup",bp.Nouveau.Media.Theatre.checkPressedKeyDocuments(e))},getDocumentActivity:function(e){e?(u(".bb-document-theater .bb-media-info-section").show(),u(".bb-media-info-section .activity-list").addClass("loading").html('<i class="dashicons dashicons-update animate-spin"></i>'),this.activity_ajax=u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"document_get_activity",id:e,nonce:BP_Nouveau.nonces.media},success:function(e){e.success&&(u(".bb-media-info-section .activity-list").removeClass("loading").html(e.data.activity),u(".bb-media-info-section").show(),jQuery(window).scroll())}})):u(".bb-document-theater .bb-media-info-section").hide()},closeTheatre:function(e){e.preventDefault();u(".bb-media-model-wrapper").hide(),this.is_open=!1,document.removeEventListener("keyup",this.checkPressedKey.bind(this))},closeDocumentTheatre:function(e){e.preventDefault();var t=u(e.currentTarget),i=u(t).closest(".bb-media-container").find(".document-theatre");i.find(".bb-media-section").removeClass("bb-media-no-preview").html(""),i.hide(),this.is_open=!1,document.removeEventListener("keyup",bp.Nouveau.Media.Theatre.checkPressedKeyDocuments(e))},setMedias:function(e){var t=u(".bb-open-media-theatre"),i=0;if(u("body").hasClass("activity")&&(t=u(e).closest(".bb-activity-media-wrap").find(".bb-open-media-theatre")),void 0!==t)for(this.medias=[],i=0;i<t.length;i++){var a,o=u(t[i]);o.closest("#bp-existing-media-content").length||(a={id:o.data("id"),attachment:o.data("attachment-full"),activity_id:o.data("activity-id"),privacy:o.data("privacy"),parent_activity_id:o.data("parent-activity-id"),album_id:o.data("album-id"),group_id:o.data("group-id"),is_forum:!1},o.closest(".forums-media-wrap").length&&(a.is_forum=!0),void 0!==a.privacy&&"message"==a.privacy?a.is_message=!0:a.is_message=!1,this.medias.push(a))}},setCurrentMedia:function(e){for(var t=this,i=0,i=0;i<t.medias.length;i++)if(e===t.medias[i].id){t.current_media=t.medias[i],t.current_index=i;break}},showMedia:function(){var e=this;if(void 0===e.current_media)return!1;u(".bb-media-model-wrapper .bb-media-section").find("img").attr("src",e.current_media.attachment+"?"+(new Date).getTime());var t,i=u(".bb-media-section .bb-media-privacy-wrap");i.length&&(i.show(),i.find("ul.media-privacy li").removeClass("selected"),i.find(".bp-tooltip").attr("data-bp-tooltip",""),(t=i.find("ul.media-privacy").find("li[data-value="+e.current_media.privacy+"]")).addClass("selected"),i.find(".bp-tooltip").attr("data-bp-tooltip",t.text()),i.find(".privacy").removeClass("public").removeClass("loggedin").removeClass("onlyme").removeClass("friends").addClass(e.current_media.privacy),(void 0!==BP_Nouveau.activity&&void 0!==e.current_media.activity_id&&0!=e.current_media.activity_id||e.group_id||e.current_media.is_forum||e.current_media.group_id||e.current_media.album_id||e.current_media.is_message)&&i.hide()),e.navigationCommands()},next:function(e){e.preventDefault();var t,i=this;void 0!==i.medias[i.current_index+1]?(i.current_index=i.current_index+1,t=i.current_media.activity_id,i.current_media=i.medias[i.current_index],i.showMedia(),t!=i.current_media.activity_id&&i.getActivity()):i.nextLink.hide()},previous:function(e){e.preventDefault();var t,i=this;void 0!==i.medias[i.current_index-1]?(i.current_index=i.current_index-1,t=i.current_media.activity_id,i.current_media=i.medias[i.current_index],i.showMedia(),t!=i.current_media.activity_id&&i.getActivity()):i.previousLink.hide()},navigationCommands:function(){var e=this;0==e.current_index&&e.current_index!=e.medias.length-1?(e.previousLink.hide(),e.nextLink.show()):0==e.current_index&&e.current_index==e.medias.length-1?(e.previousLink.hide(),e.nextLink.hide()):e.current_index==e.medias.length-1?(e.previousLink.show(),e.nextLink.hide()):(e.previousLink.show(),e.nextLink.show())},getActivity:function(){var e=this;u(".bb-media-info-section .activity-list").addClass("loading").html('<i class="dashicons dashicons-update animate-spin"></i>'),void 0!==BP_Nouveau.activity&&e.current_media&&void 0!==e.current_media.activity_id&&0!=e.current_media.activity_id&&!e.current_media.is_forum?(0!=e.activity_ajax&&e.activity_ajax.abort(),e.activity_ajax=u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_get_activity",id:e.current_media.activity_id,nonce:BP_Nouveau.nonces.media},success:function(e){e.success&&(u(".bb-media-info-section .activity-list").removeClass("loading").html(e.data.activity),u(".bb-media-info-section").show(),jQuery(window).scroll())}})):u(".bb-media-info-section").hide()},activityDeleted:function(e,t){var i=this,a=0;if(i.is_open&&void 0!==t&&"delete_activity"===t.action&&i.current_media.activity_id==t.id){for(u(document).find('[data-bp-list="media"] .bb-open-media-theatre[data-id="'+i.current_media.id+'"]').closest("li").remove(),u(document).find('[data-bp-list="activity"] .bb-open-media-theatre[data-id="'+i.current_media.id+'"]').closest(".bb-activity-media-elem").remove(),a=0;a<i.medias.length;a++)if(i.medias[a].activity_id==t.id){i.medias.splice(a,1);break}0==i.current_index&&i.current_index!=i.medias.length?(i.current_index=-1,i.next(e)):0==i.current_index&&i.current_index==i.medias.length?i.closeTheatre(e):i.current_index==i.medias.length?i.previous(e):(i.current_index=-1,i.next(e))}},togglePopupDropdown:function(e){var t;return(e=e||window.event).target?t=e.target:e.srcElement&&(t=e.srcElement),3===t.nodeType&&(t=t.parentNode),!0===e.altKey||!0===e.metaKey||u(t).hasClass("privacy-wrap")||u(t).parent().hasClass("privacy-wrap")?e:void u("ul.media-privacy").removeClass("bb-open")},togglePrivacyDropdown:function(e){var t=u(e.target);e.preventDefault(),t.closest(".bb-media-privacy-wrap").find(".media-privacy").toggleClass("bb-open")},mediaPrivacyChange:function(e){var t,i=u(e.target),a=i.data("value");if(e.preventDefault(),i.hasClass("selected"))return!1;i.closest(".bb-media-privacy-wrap").find(".privacy").addClass("loading"),t=i.closest(".bb-media-privacy-wrap").find("ul.media-privacy li.selected").data("value"),i.closest(".bb-media-privacy-wrap").find("ul.media-privacy li").removeClass("selected"),i.addClass("selected"),u.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:{action:"media_update_privacy",id:this.current_media.id,_wpnonce:BP_Nouveau.nonces.media,privacy:a},success:function(){i.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading").removeClass(t),i.closest(".bb-media-privacy-wrap").find(".privacy").addClass(a),i.closest(".bb-media-privacy-wrap").find(".bp-tooltip").attr("data-bp-tooltip",i.text())},error:function(){i.closest(".bb-media-privacy-wrap").find(".privacy").removeClass("loading")}})}},bp.Nouveau.Media.start(),bp.Nouveau.Media.Theatre.start())}((bp,jQuery));