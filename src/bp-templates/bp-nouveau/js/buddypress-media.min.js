window.bp=window.bp||{},function(e,t){"undefined"!=typeof BP_Nouveau&&(bp.Nouveau=bp.Nouveau||{},bp.Nouveau.Media={start:function(){this.setupGlobals(),this.addListeners()},setupGlobals:function(){this.current_page=1,this.current_page_existing_media=1,this.current_page_albums=1,this.current_tab=!t("body").hasClass("single-topic")&&!t("body").hasClass("single-forum")&&"bp-dropzone-content",window.Dropzone.autoDiscover=!1,this.options={url:BP_Nouveau.ajaxurl,timeout:108e5,acceptedFiles:"image/*",autoProcessQueue:!0,addRemoveLinks:!0,uploadMultiple:!1,maxFilesize:void 0!==BP_Nouveau.media.max_upload_size?BP_Nouveau.media.max_upload_size:2},this.dropzone_obj=null,this.dropzone_media=[],this.album_id=void 0!==BP_Nouveau.media.album_id&&BP_Nouveau.media.album_id,this.group_id=void 0!==BP_Nouveau.media.group_id&&BP_Nouveau.media.group_id,this.bbp_is_reply_edit=void 0!==BP_Nouveau.media.bbp_is_reply_edit&&BP_Nouveau.media.bbp_is_reply_edit,this.bbp_is_topic_edit=void 0!==BP_Nouveau.media.bbp_is_topic_edit&&BP_Nouveau.media.bbp_is_topic_edit,this.bbp_is_forum_edit=void 0!==BP_Nouveau.media.bbp_is_forum_edit&&BP_Nouveau.media.bbp_is_forum_edit,this.bbp_reply_edit_media=void 0!==BP_Nouveau.media.reply_edit_media?BP_Nouveau.media.reply_edit_media:[],this.bbp_topic_edit_media=void 0!==BP_Nouveau.media.topic_edit_media?BP_Nouveau.media.topic_edit_media:[],this.bbp_forum_edit_media=void 0!==BP_Nouveau.media.forum_edit_media?BP_Nouveau.media.forum_edit_media:[],this.bbp_reply_edit_gif_data=void 0!==BP_Nouveau.media.reply_edit_gif_data?BP_Nouveau.media.reply_edit_gif_data:[],this.bbp_topic_edit_gif_data=void 0!==BP_Nouveau.media.topic_edit_gif_data?BP_Nouveau.media.topic_edit_gif_data:[],this.bbp_forum_edit_gif_data=void 0!==BP_Nouveau.media.forum_edit_gif_data?BP_Nouveau.media.forum_edit_gif_data:[],this.giphy=null,this.gif_offset=0,this.gif_q=null,this.gif_limit=20,this.gif_requests=[],this.gif_data=[]},addListeners:function(){t(".bp-nouveau").on("click","#bp-add-media",this.openUploader.bind(this)),t(".bp-nouveau").on("click","#bp-media-submit",this.submitMedia.bind(this)),t(".bp-nouveau").on("click","#bp-media-uploader-close",this.closeUploader.bind(this)),t(".bp-nouveau").on("click","#bb-delete-media",this.deleteMedia.bind(this)),t(".bp-nouveau").on("click","#bb-select-deselect-all-media",this.toggleSelectAllMedia.bind(this)),t('#buddypress [data-bp-list="media"]').on("bp_ajax_request",this.bp_ajax_media_request),t(".bp-nouveau").on("click","#bb-create-album",this.openCreateAlbumModal.bind(this)),t(".bp-nouveau").on("click","#bp-media-create-album-submit",this.saveAlbum.bind(this)),t(".bp-nouveau").on("click","#bp-media-create-album-close",this.closeCreateAlbumModal.bind(this)),t(".bp-nouveau").on("click","#bp-media-add-more",this.triggerDropzoneSelectFileDialog.bind(this)),t("#bp-media-uploader").on("click",".bp-media-upload-tab",this.changeUploadModalTab.bind(this)),t('.bp-nouveau [data-bp-list="media"]').on("click","li.load-more",this.injectMedias.bind(this)),t(".bp-nouveau #albums-dir-list").on("click","li.load-more",this.appendAlbums.bind(this)),t(".bp-existing-media-wrap").on("click","li.load-more",this.appendMedia.bind(this)),t(".bp-nouveau").on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.addSelectedClassToWrapper.bind(this)),t(".bp-existing-media-wrap").on("change",'.bb-media-check-wrap [name="bb-media-select"]',this.toggleSubmitMediaButton.bind(this)),t(".bp-nouveau").on("click","#bp-edit-album-title",this.editAlbumTitle.bind(this)),t(".bp-nouveau").on("click","#bp-cancel-edit-album-title",this.cancelEditAlbumTitle.bind(this)),t(".bp-nouveau").on("click","#bp-save-album-title",this.saveAlbum.bind(this)),t(".bp-nouveau").on("change","#bp-media-single-album select#bb-album-privacy",this.saveAlbum.bind(this)),t(".bp-nouveau").on("click","#bb-delete-album",this.deleteAlbum.bind(this)),t(".bbpress,.buddypress").on("click","#forums-media-button",this.openForumsUploader.bind(this)),t(".bbpress,.buddypress").on("click","#forums-gif-button",this.toggleGifSelector.bind(this)),t(".bbpress form #whats-new-toolbar, .forum form #whats-new-toolbar").on("keyup",".search-query-input",this.searchGif.bind(this)),t(".bbpress form #whats-new-toolbar, .forum form #whats-new-toolbar").on("click",".found-media-item",this.selectGif.bind(this)),t(".bbpress form #whats-new-attachments .forums-attached-gif-container .gif-search-results, .forum form #whats-new-attachments .forums-attached-gif-container .gif-search-results").scroll(this.loadMoreGif.bind(this)),t(".bbpress form #whats-new-attachments .forums-attached-gif-container, .forum form #whats-new-attachments .forums-attached-gif-container").on("click",".gif-image-remove",this.removeSelectedGif.bind(this)),t(document).on("click",".gif-image-container",this.playVideo.bind(this)),_.isUndefined(BP_Nouveau.media.gif_api_key)||(window.addEventListener("scroll",this.autoPlayGifVideos,!1),window.addEventListener("resize",this.autoPlayGifVideos,!1)),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&t("#forums-media-button").trigger("click"),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(Object.keys(this.bbp_reply_edit_gif_data).length||Object.keys(this.bbp_topic_edit_gif_data).length||Object.keys(this.bbp_forum_edit_gif_data).length)&&this.editGifPreview()},bp_ajax_media_request:function(e,i){void 0!==i&&void 0!==i.response.scopes.personal&&0===i.response.scopes.personal&&t(".bb-photos-actions").hide()},addSelectedClassToWrapper:function(e){var i=e.currentTarget;t(i).is(":checked")?(t(i).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect),t(i).closest(".bb-photo-thumb").addClass("selected")):(t(i).closest(".bb-photo-thumb").removeClass("selected"),t(i).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select),t(".bp-nouveau #bb-select-deselect-all-media").hasClass("selected")&&t(".bp-nouveau #bb-select-deselect-all-media").removeClass("selected"))},deleteMedia:function(e){var i=t(e.currentTarget);e.preventDefault();var a=[];if(t("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){t(this).closest(".bb-photo-thumb").addClass("loading deleting"),a.push(t(this).val())}),0==a.length)return!1;i.prop("disabled",!0),t("#buddypress .media-list .bp-feedback").remove();var d={action:"media_delete",_wpnonce:BP_Nouveau.nonces.media,media:a};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,success:function(e){if(setTimeout(function(){i.prop("disabled",!1)},500),e.success){if(t("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){t(this).closest("li").remove()}),0==t("#buddypress").find(".media-list:not(.existing-media-list)").find("li:not(.load-more)").length){t(".bb-photos-actions").hide();var a='<aside class="bp-feedback bp-messages info">\n\t<span class="bp-icon" aria-hidden="true"></span>\n\t<p>'+BP_Nouveau.media.i18n_strings.np_photos_found+"</p>\n\t</aside>";t('#buddypress [data-bp-list="media"]').html(a)}}else t("#buddypress .media-list").prepend(e.data.feedback)}})},toggleSelectAllMedia:function(e){e.preventDefault(),t(e.currentTarget).hasClass("selected")?(t(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.selectall),this.deselectAllMedia(e)):(t(e.currentTarget).data("bp-tooltip",BP_Nouveau.media.i18n_strings.unselectall),this.selectAllMedia(e)),t(e.currentTarget).toggleClass("selected")},selectAllMedia:function(e){e.preventDefault(),t("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){t(this).prop("checked",!0),t(this).closest(".bb-photo-thumb").addClass("selected"),t(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.unselect)})},deselectAllMedia:function(e){e.preventDefault(),t("#buddypress").find(".media-list:not(.existing-media-list)").find('.bb-media-check-wrap [name="bb-media-select"]').each(function(){t(this).prop("checked",!1),t(this).closest(".bb-photo-thumb").removeClass("selected"),t(this).closest(".bb-media-check-wrap").find(".bp-tooltip").attr("data-bp-tooltip",BP_Nouveau.media.i18n_strings.select)})},editAlbumTitle:function(e){e.preventDefault(),t("#bb-album-title").show(),t("#bp-save-album-title").show(),t("#bp-cancel-edit-album-title").show(),t("#bp-edit-album-title").hide(),t("#bp-media-single-album #bp-single-album-title").hide()},cancelEditAlbumTitle:function(e){e.preventDefault(),t("#bb-album-title").hide(),t("#bp-save-album-title").hide(),t("#bp-cancel-edit-album-title").hide(),t("#bp-edit-album-title").show(),t("#bp-media-single-album #bp-single-album-title").show()},triggerDropzoneSelectFileDialog:function(){this.dropzone_obj.hiddenFileInput.click()},closeUploader:function(e){e.preventDefault(),t("#bp-media-uploader").hide(),t("#bp-media-add-more").hide(),t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload),t("#bp-media-uploader-modal-status-text").text(""),this.dropzone_obj.destroy(),this.dropzone_media=[]},loadMoreGif:function(e){var i=e.target,a=this;if(i.scrollTop+i.offsetHeight>=i.scrollHeight&&!t(e.target).closest(".forums-attached-gif-container").hasClass("loading")&&a.gif_total_count>0&&a.gif_offset<=a.gif_total_count){var d={offset:a.gif_offset,fmt:"json",limit:a.gif_limit};t(e.target).closest(".forums-attached-gif-container").addClass("loading");var o=null;o=_.isNull(a.gif_q)?a.giphy.trending(d,_.bind(a.loadMoreGifResponse,a)):a.giphy.search(_.extend({q:a.gif_q},d),_.bind(a.loadMoreGifResponse,a)),a.gif_requests.push(o),a.gif_offset=a.gif_offset+a.gif_limit}},loadMoreGifResponse:function(e){var i=this,a=0;if(t(".forums-attached-gif-container").removeClass("loading"),void 0!==e.data&&e.data.length){var d="";for(a=0;a<e.data.length;a++)d+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[a].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[a].images.original.url+'" data-id="'+e.data[a].id+'">\n\t\t<img src="'+e.data[a].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[a].saved=!1,i.gif_data.push(e.data[a]);t(".forums-attached-gif-container").find(".gif-search-results-list").append(d)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(i.gif_total_count=e.pagination.total_count)},editGifPreview:function(){var e=this,i={};if(e.bbp_is_reply_edit&&Object.keys(e.bbp_reply_edit_gif_data).length?i=e.bbp_reply_edit_gif_data.gif_raw_data:e.bbp_is_topic_edit&&Object.keys(e.bbp_topic_edit_gif_data).length?i=e.bbp_topic_edit_gif_data.gif_raw_data:e.bbp_is_forum_edit&&Object.keys(e.bbp_forum_edit_gif_data).length&&(i=e.bbp_forum_edit_gif_data.gif_raw_data),void 0===i.images)return!1;t("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+i.images.fixed_width.url+")",t("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",t("#whats-new-attachments .forums-attached-gif-container")[0].style.height=i.images.original.height+"px",t("#whats-new-attachments .forums-attached-gif-container")[0].style.width=i.images.original.width+"px",t("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",i.images.original.url),t("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),t("#bbp_media_gif").length&&t("#bbp_media_gif").val(JSON.stringify(i))},selectGif:function(e){var i=this,a=0;if(e.preventDefault(),t("#whats-new-toolbar .forums-attached-gif-container").parent().removeClass("open"),i.gif_data.length)for(a=0;a<i.gif_data.length;a++)if(i.gif_data[a].id==e.currentTarget.dataset.id){t("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundImage="url("+i.gif_data[a].images.fixed_width.url+")",t("#whats-new-attachments .forums-attached-gif-container")[0].style.backgroundSize="contain",t("#whats-new-attachments .forums-attached-gif-container")[0].style.height=i.gif_data[a].images.original.height+"px",t("#whats-new-attachments .forums-attached-gif-container")[0].style.width=i.gif_data[a].images.original.width+"px",t("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",i.gif_data[a].images.original.url),t("#whats-new-attachments .forums-attached-gif-container").removeClass("closed"),t("#bbp_media_gif").length&&t("#bbp_media_gif").val(JSON.stringify(i.gif_data[a]));break}},removeSelectedGif:function(e){e.preventDefault(),this.resetForumsGifComponent()},resetForumsGifComponent:function(){t("#whats-new-toolbar .forums-attached-gif-container").parent().removeClass("open"),t("#whats-new-toolbar #forums-gif-button").removeClass("active"),t("#whats-new-attachments .forums-attached-gif-container").addClass("closed"),t("#whats-new-attachments .forums-attached-gif-container").find(".gif-image-container img").attr("src",""),t("#whats-new-attachments .forums-attached-gif-container")[0].style="",t("#bbp_media_gif").length&&t("#bbp_media_gif").val("")},searchGif:function(e){var t=this;null!=t.gif_timeout&&clearTimeout(this.gif_timeout),t.gif_timeout=setTimeout(function(){t.gif_timeout=null,t.searchGifRequest(e,e.target.value)},1e3)},searchGifRequest:function(e){var i=this;i.gif_q=e.target.value,i.gif_offset=0;var a=0;i.clearGifRequests(),t(e.target).closest(".forums-attached-gif-container").addClass("loading");var d=i.giphy.search({q:i.gif_q,offset:i.gif_offset,fmt:"json",limit:i.gif_limit},function(d){if(void 0!==d.data&&d.data.length){var o="";for(a=0;a<d.data.length;a++)o+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+d.data[a].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+d.data[a].images.original.url+'" data-id="'+d.data[a].id+'">\n\t\t<img src="'+d.data[a].images.fixed_width.url+'">\n\t</a>\n</li>',d.data[a].saved=!1,i.gif_data.push(d.data[a]);t(e.target).closest(".forums-attached-gif-container").find(".gif-search-results-list").append(o)}void 0!==d.pagination&&void 0!==d.pagination.total_count&&(i.gif_total_count=d.pagination.total_count),t(e.target).closest(".forums-attached-gif-container").removeClass("loading")});i.gif_requests.push(d),i.gif_offset=i.gif_offset+i.gif_limit},clearGifRequests:function(){t(".gif-search-results-list li").remove();for(var e=0;e<this.gif_requests.length;e++)this.gif_requests[e].abort();this.gif_requests=[],this.gif_data=[]},toggleGifSelector:function(e){var i=this,a=t(e.currentTarget),d=a.closest("form").find(".gif-media-search-dropdown"),o=0;if(e.preventDefault(),void 0!==window.Giphy&&void 0!==BP_Nouveau.media.gif_api_key&&null==i.giphy){i.giphy=new window.Giphy(BP_Nouveau.media.gif_api_key),i.gif_offset=0,i.gif_q=null,i.gif_limit=20,i.gif_requests=[],i.gif_data=[],i.clearGifRequests(),t(".gif-search-query").closest(".forums-attached-gif-container").addClass("loading");var s=i.giphy.trending({offset:i.gif_offset,fmt:"json",limit:i.gif_limit},function(e){if(void 0!==e.data&&e.data.length){var d="";for(o=0;o<e.data.length;o++)d+='<li class="bg'+(Math.floor(6*Math.random())+1)+'" style="height: '+e.data[o].images.fixed_width.height+'px;">\n\t<a class="found-media-item" href="'+e.data[o].images.original.url+'" data-id="'+e.data[o].id+'">\n\t\t<img src="'+e.data[o].images.fixed_width.url+'">\n\t</a>\n</li>',e.data[o].saved=!1,i.gif_data.push(e.data[o]);a.closest("form").find(".gif-search-results-list").append(d)}void 0!==e.pagination&&void 0!==e.pagination.total_count&&(i.gif_total_count=e.pagination.total_count),t(".gif-search-query").closest(".forums-attached-gif-container").removeClass("loading")});i.gif_requests.push(s),i.gif_offset=i.gif_offset+i.gif_limit}d.toggleClass("open"),a.toggleClass("active"),i.resetForumsMediaComponent()},resetForumsMediaComponent:function(){var e=this;e.dropzone_obj&&e.dropzone_obj.destroy(),e.dropzone_media=[],t("div#forums-post-media-uploader").html(""),t("div#forums-post-media-uploader").addClass("closed").removeClass("open")},openForumsUploader:function(e){var i=this,a=t("div#forums-post-media-uploader"),d=[];if(e.preventDefault(),void 0!==window.Dropzone&&a.length)if(a.hasClass("closed")){if(i.dropzone_obj=new Dropzone("div#forums-post-media-uploader",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","media_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):i.dropzone_obj.removeFile(e)}),i.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=t(e.previewElement).closest(".dropzone").find(e.previewElement).index()-1,a.data.album_id=i.album_id,a.data.group_id=i.group_id,a.data.saved=!1,i.dropzone_media.push(a.data),i.addMediaIdsToForumsForm())}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var t in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[t].uuid){this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit||void 0===i.dropzone_media[t].saved||i.dropzone_media[t].saved||i.removeAttachment(i.dropzone_media[t].id),i.dropzone_media.splice(t,1),i.addMediaIdsToForumsForm();break}}),(this.bbp_is_reply_edit||this.bbp_is_topic_edit||this.bbp_is_forum_edit)&&(this.bbp_reply_edit_media.length||this.bbp_topic_edit_media.length||this.bbp_forum_edit_media.length)&&(this.bbp_reply_edit_media.length?d=this.bbp_reply_edit_media:this.bbp_topic_edit_media.length?d=this.bbp_topic_edit_media:this.bbp_forum_edit_media.length&&(d=this.bbp_forum_edit_media),d.length)){for(var o=!1,s=0;s<d.length;s++)o=!1,i.dropzone_media.push({id:d[s].attachment_id,media_id:d[s].id,name:d[s].title,thumb:d[s].thumb,url:d[s].full,uuid:d[s].id,menu_order:s,saved:!0}),o={name:d[s].title,accepted:!0,kind:"image",upload:{filename:d[s].title,uuid:d[s].id},dataURL:d[s].url,id:d[s].id},i.dropzone_obj.files.push(o),i.dropzone_obj.emit("addedfile",o),i.createThumbnailFromUrl(o);i.addMediaIdsToForumsForm()}a.removeClass("closed").addClass("open"),i.resetForumsGifComponent()}else i.resetForumsMediaComponent()},createThumbnailFromUrl:function(e){var t=this;t.dropzone_obj.createThumbnailFromUrl(e,t.dropzone_obj.options.thumbnailWidth,t.dropzone_obj.options.thumbnailHeight,t.dropzone_obj.options.thumbnailMethod,!0,function(i){t.dropzone_obj.emit("thumbnail",e,i),t.dropzone_obj.emit("complete",e)})},openUploader:function(e){var i=this;e.preventDefault(),void 0!==window.Dropzone&&t("div#media-uploader").length&&(t("#bp-media-uploader").show(),i.dropzone_obj=new Dropzone("div#media-uploader",i.options),i.dropzone_obj.on("sending",function(e,t,i){i.append("action","media_upload"),i.append("_wpnonce",BP_Nouveau.nonces.media)}),i.dropzone_obj.on("addedfile",function(){setTimeout(function(){i.dropzone_obj.getAcceptedFiles().length&&t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()},1e3)}),i.dropzone_obj.on("error",function(e,a){e.accepted?void 0!==a&&void 0!==a.data&&void 0!==a.data.feedback&&t(e.previewElement).find(".dz-error-message span").text(a.data.feedback):i.dropzone_obj.removeFile(e)}),i.dropzone_obj.on("queuecomplete",function(){t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.upload)}),i.dropzone_obj.on("processing",function(){t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"...")}),i.dropzone_obj.on("success",function(e,a){a.data.id&&(e.id=a.id,a.data.uuid=e.upload.uuid,a.data.menu_order=i.dropzone_media.length,a.data.album_id=i.album_id,a.data.group_id=i.group_id,a.data.saved=!1,i.dropzone_media.push(a.data)),t("#bp-media-add-more").show(),t("#bp-media-submit").show(),t("#bp-media-uploader-modal-title").text(BP_Nouveau.media.i18n_strings.uploading+"..."),t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show()}),i.dropzone_obj.on("removedfile",function(e){if(i.dropzone_media.length)for(var a in i.dropzone_media)if(e.upload.uuid==i.dropzone_media[a].uuid){void 0===i.dropzone_media[a].saved||i.dropzone_media[a].saved||i.removeAttachment(i.dropzone_media[a].id),i.dropzone_media.splice(a,1);break}i.dropzone_obj.getAcceptedFiles().length?t("#bp-media-uploader-modal-status-text").text(wp.i18n.sprintf(BP_Nouveau.media.i18n_strings.upload_status,i.dropzone_media.length,i.dropzone_obj.getAcceptedFiles().length)).show():(t("#bp-media-uploader-modal-status-text").text(""),t("#bp-media-add-more").hide(),t("#bp-media-submit").hide())}))},removeAttachment:function(e){var i={action:"media_delete_attachment",_wpnonce:BP_Nouveau.nonces.media,id:e};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i})},changeUploadModalTab:function(e){e.preventDefault();var i=t(e.currentTarget).data("content");t(".bp-media-upload-tab-content").hide(),t("#"+i).show(),this.current_tab=i,t(e.currentTarget).closest("#bp-media-uploader").find(".bp-media-upload-tab").removeClass("selected"),t(e.currentTarget).addClass("selected"),this.toggleSubmitMediaButton()},openCreateAlbumModal:function(e){e.preventDefault(),this.openUploader(e),t("#bp-media-create-album").show()},closeCreateAlbumModal:function(e){e.preventDefault(),this.closeUploader(e),t("#bp-media-create-album").hide(),t("#bb-album-title").val("")},submitMedia:function(e){e.preventDefault();var i,a=this;if("bp-dropzone-content"===a.current_tab){var d=t("#bp-media-post-content").val();i={action:"media_save",_wpnonce:BP_Nouveau.nonces.media,medias:a.dropzone_media,content:d},t("#bp-dropzone-content .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(i){if(i.success){t("#media-stream ul.media-list").length||(t("#media-stream").html(t("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),t(".bb-photos-actions").show()),bp.Nouveau.inject("#media-stream ul.media-list",i.data.media,"prepend");for(var d=0;d<a.dropzone_media.length;d++)a.dropzone_media[d].saved=!0;a.closeUploader(e)}else t("#bp-dropzone-content").prepend(i.data.feedback)}})}else if("bp-existing-media-content"===a.current_tab){var o=[];t('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){o.push(t(this).val())}),i={action:"media_move_to_album",_wpnonce:BP_Nouveau.nonces.media,medias:o,album_id:a.album_id,group_id:a.group_id},t("#bp-existing-media-content .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(i){i.success?(t("#media-stream ul.media-list").length||(t("#media-stream").html(t("<ul></ul>").addClass("media-list item-list bp-list bb-photo-list grid")),t(".bb-photos-actions").show()),bp.Nouveau.inject("#media-stream ul.media-list",i.data.media,"prepend"),t('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').each(function(){t(this).closest("li").data("id")===t(this).val()&&t(this).closest("li").remove()}),a.closeUploader(e)):t("#bp-existing-media-content").prepend(i.data.feedback)}})}else a.current_tab||a.closeUploader(e)},saveAlbum:function(e){var i=t(e.currentTarget),a=this,d=t("#bb-album-title"),o=t("#bb-album-privacy");if(e.preventDefault(),""===t.trim(d.val()))return d.addClass("error"),!1;if(d.removeClass("error"),!a.group_id&&""===t.trim(o.val()))return o.addClass("error"),!1;o.removeClass("error"),i.prop("disabled",!0);var s={action:"media_album_save",_wpnonce:BP_Nouveau.nonces.media,title:d.val(),medias:a.dropzone_media,privacy:o.val()};a.album_id&&(s.album_id=a.album_id),a.group_id&&(s.group_id=a.group_id),t(".bb-single-album-header .bp-feedback").remove(),t("#boss-media-create-album-popup .bp-feedback").remove(),t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:s,success:function(s){setTimeout(function(){i.prop("disabled",!1)},500),s.success?a.album_id?(t("#bp-single-album-title").text(d.val()),t("#bb-album-privacy").val(o.val()),a.cancelEditAlbumTitle(e)):(t("#buddypress .bb-albums-list").prepend(s.data.album),window.location.href=s.data.redirect_url):a.album_id?t("#bp-media-single-album").prepend(s.data.feedback):t("#boss-media-create-album-popup .bb-model-header").after(s.data.feedback)}})},deleteAlbum:function(e){if(e.preventDefault(),!this.album_id)return!1;if(!confirm(BP_Nouveau.media.i18n_strings.album_delete_confirm))return!1;t(e.currentTarget).prop("disabled",!0);var i={action:"media_album_delete",_wpnonce:BP_Nouveau.nonces.media,album_id:this.album_id,group_id:this.group_id};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:i,success:function(i){i.success?window.location.href=i.data.redirect_url:(alert(BP_Nouveau.media.i18n_strings.album_delete_error),t(e.currentTarget).prop("disabled",!1))}})},addMediaIdsToForumsForm:function(){var e=this;t("#bbp_media").length&&t("#bbp_media").val(JSON.stringify(e.dropzone_media))},injectMedias:function(e){var i=bp.Nouveau.getStorage("bp-media"),a=i.scope||null,d=i.filter||null;if(t(e.currentTarget).hasClass("load-more")){var o=1*Number(this.current_page)+1,s=this,n="";e.preventDefault(),t(e.currentTarget).find("a").first().addClass("loading"),t("#buddypress .dir-search input[type=search]").length&&(n=t("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:a,filter:d,search_terms:n,page:o,method:"append",target:"#buddypress [data-bp-list] ul.bp-list"}).done(function(i){!0===i.success&&(t(e.currentTarget).remove(),s.current_page=o)})}},appendMedia:function(e){var i=bp.Nouveau.getStorage("bp-media"),a=i.scope||null,d=i.filter||null;if(t(e.currentTarget).hasClass("load-more")){var o=1*Number(this.current_page_existing_media)+1,s=this,n="";e.preventDefault(),t(e.currentTarget).find("a").first().addClass("loading"),t("#buddypress .dir-search input[type=search]").length&&(n=t("#buddypress .dir-search input[type=search]").val()),bp.Nouveau.objectRequest({object:"media",scope:a,filter:d,search_terms:n,page:o,method:"append",caller:"bp-existing-media",target:".bp-existing-media-wrap ul.bp-list"}).done(function(i){!0===i.success&&(t(e.currentTarget).remove(),s.current_page_existing_media=o)})}},appendAlbums:function(e){var i=1*Number(this.current_page_albums)+1,a=this;e.preventDefault(),t(e.currentTarget).find("a").first().addClass("loading");var d={action:"media_albums_loader",_wpnonce:BP_Nouveau.nonces.media,page:i};t.ajax({type:"POST",url:BP_Nouveau.ajaxurl,data:d,success:function(d){!0===d.success&&(t(e.currentTarget).remove(),t("#albums-dir-list ul.bb-albums-list").fadeOut(100,function(){t("#albums-dir-list ul.bb-albums-list").append(d.data.albums),t(this).fadeIn(100)}),a.current_page_albums=i)}})},toggleSubmitMediaButton:function(){var e=t("#bp-media-submit"),i=t("#bp-media-add-more");"bp-dropzone-content"===this.current_tab?this.dropzone_obj.getAcceptedFiles().length?(e.show(),i.show()):(e.hide(),i.hide()):"bp-existing-media-content"===this.current_tab&&(t('.bp-existing-media-wrap .bb-media-check-wrap [name="bb-media-select"]:checked').length?e.show():e.hide(),i.hide())},playVideo:function(e){e.preventDefault();var i=t(e.currentTarget).find("video").get(0),a=t(e.currentTarget).find(".gif-play-button");1==i.paused?(i.play(),a.hide()):(i.pause(),a.show())},autoPlayGifVideos:function(){t(".gif-player").each(function(){var e=t(this).find("video").get(0),i=t(this).find(".gif-play-button");t(this).is(":in-viewport")?(e.play(),i.hide()):(e.pause(),i.show())})}},bp.Nouveau.Media.start())}(bp,jQuery);