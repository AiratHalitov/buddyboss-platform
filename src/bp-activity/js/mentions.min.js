window.bp=window.bp||{},function(t,e,i){var n,s=[];t.mentions=t.mentions||{},t.mentions.users=window.bp.mentions.users||[],"object"==typeof window.BP_Suggestions&&(t.mentions.users=window.BP_Suggestions.friends||t.mentions.users),e.fn.bp_mentions=function(t,i,o){e.isArray(t)&&(t={data:t}),i||(i={}),o||(o={});var r=e.extend(!0,{},{delay:200,hideWithoutSuffix:!0,insertTpl:BP_Mentions_Options.insert_tpl,limit:10,startWithSpace:!1,suffix:"",callbacks:{filter:function(t,e,i){var n,s,o,r=[],a=new RegExp("^"+t+"| "+t,"ig");for(s=0,o=e.length;s<o;s++)(n=e[s])[i].toLowerCase().match(a)&&r.push(n);return r},highlighter:function(t,e){if(!e)return t;var i=new RegExp(">(\\s*|[\\w\\s]*)("+this.at.replace("+","\\+")+"?"+e.replace("+","\\+")+")([\\w ]*)\\s*<","ig");return t.replace(i,function(t,e,i,n){return">"+e+"<strong>"+i+"</strong>"+n+"<"})},before_reposition:function(t){var i,n,s,o,r=e("#atwho-ground-"+this.id+" .atwho-view"),a=e("body"),u=this.$inputor.data("atwho");"undefined"!==u&&"undefined"!==u.iframe&&null!==u.iframe?(i=this.$inputor.caret("offset",{iframe:u.iframe}),"undefined"!==(s=e(u.iframe).offset())&&(i.left+=s.left,i.top+=s.top)):i=this.$inputor.caret("offset"),i.left>a.width()/2?(r.addClass("right"),o=i.left-t.left-this.view.$el.width()):(r.removeClass("right"),o=i.left-t.left+1),a.width()<=400&&e(document).scrollTop(i.top-6),(!(n=parseInt(this.$inputor.css("line-height").substr(0,this.$inputor.css("line-height").length-2),10))||n<5)&&(n=19),t.top=i.top+n,t.left+=o},inserting_wrapper:function(t,e,i){return""+e+i}}},i),a=e.extend(!0,{},{callbacks:{remoteFilter:function(t,i){var o=e(this),r={};"object"!=typeof(n=s[t])?(o.xhr&&o.xhr.abort(),r={action:"bp_get_suggestions",term:t,type:"members"},void 0!==window.BP_Nouveau&&void 0!==window.BP_Nouveau.messages&&void 0!==window.BP_Nouveau.messages.force_friendship_to_message&&window.BP_Nouveau.messages.force_friendship_to_message&&(r.only_friends=1),e.isNumeric(this.$inputor.data("suggestions-group-id"))&&(r["group-id"]=parseInt(this.$inputor.data("suggestions-group-id"),10)),o.xhr=e.getJSON(ajaxurl,r).done(function(n){if(n.success){var o=e.map(n.data,function(t){return t.search=t.search||t.ID+" "+t.name,t});s[t]=o,i(o)}})):i(n)}},data:e.map(t.data,function(t){return t.search=t.search||t.ID+" "+t.name,t}),at:"@",searchKey:"search",displayTpl:BP_Mentions_Options.display_tpl},o),u=e.extend(!0,{},r,a,t);return e.fn.atwho.call(this,u)},e(document).ready(function(){e(document).on("focus",BP_Mentions_Options.selectors.join(","),function(){e(this).data("bp_mentions_activated")||void 0!==t&&(e(this).bp_mentions(t.mentions.users),e(this).data("bp_mentions_activated",!0))})}),t.mentions.tinyMCEinit=function(){void 0!==window.tinyMCE&&null!==window.tinyMCE.activeEditor&&void 0!==window.tinyMCE.activeEditor&&e(window.tinyMCE.activeEditor.contentDocument.activeElement).atwho("setIframe",e(".wp-editor-wrap iframe")[0]).bp_mentions(t.mentions.users)}}(bp,jQuery);